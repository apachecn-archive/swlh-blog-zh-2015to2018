# AllenNLP è®©æ–‡æœ¬æ·±åº¦å­¦ä¹ å˜å¾—ç®€å•

> åŸæ–‡ï¼š<https://medium.com/swlh/deep-learning-for-text-made-easy-with-allennlp-62bc79d41f31>

![](img/591c3faa673123fa9d042ce233984ff8.png)

ä¸€ä¸ªå¥½çš„å­¦ä¹ è¿‡ç¨‹çš„å…³é”®åŸåˆ™ä¹‹ä¸€æ˜¯ä¿æŒå­¦ä¹ æ¯”ä½ ç›®å‰çš„ç†è§£ç¨å¾®å¤šä¸€ç‚¹çš„ä¸œè¥¿ã€‚å¦‚æœä¸»é¢˜ä¸ä½ å·²ç»çŸ¥é“çš„å¤ªç›¸ä¼¼ï¼Œä½ æœ€ç»ˆ**ä¸ä¼šå–å¾—å¤ªå¤§è¿›å±•**ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä¸»é¢˜å¤ªéš¾ï¼Œä½ ä¼š**åœæ»ä¸å‰ï¼Œå–å¾—å¾ˆå°‘æˆ–æ²¡æœ‰è¿›å±•**ã€‚

æ·±åº¦å­¦ä¹ æ¶‰åŠè®¸å¤šä¸åŒçš„ä¸»é¢˜å’Œæˆ‘ä»¬éœ€è¦å­¦ä¹ çš„ä¸œè¥¿ï¼Œæ‰€ä»¥ä¸€ä¸ªå¥½çš„ç­–ç•¥æ˜¯å¼€å§‹ç ”ç©¶äººä»¬å·²ç»ä¸ºæˆ‘ä»¬å»ºç«‹çš„ä¸œè¥¿ã€‚è¿™å°±æ˜¯æ¡†æ¶ä¼Ÿå¤§çš„åŸå› ã€‚å®ƒä»¬è®©æˆ‘ä»¬ä¸å¿…å¤ªåœ¨æ„å¦‚ä½•æ„å»ºæ¨¡å‹çš„ç»†èŠ‚ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ›´ä¸“æ³¨äº**æˆ‘ä»¬æƒ³è¦å®Œæˆçš„**(è€Œä¸æ˜¯ä¸“æ³¨äºå¦‚ä½•å»åš)ã€‚

[**AllenNLP**](http://allennlp.org/) æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œå®ƒä½¿å¾—ä¸ºè‡ªç„¶è¯­è¨€å¤„ç†å»ºç«‹æ·±åº¦å­¦ä¹ æ¨¡å‹çš„ä»»åŠ¡**å˜å¾—çœŸæ­£ä»¤äººæ„‰å¿«**ã€‚è¿™å¯¹æˆ‘æ¥è¯´æ˜¯ä¸€ä¸ªæƒŠå–œï¼Œå› ä¸ºæˆ‘ä¹‹å‰åœ¨ NLP æ·±åº¦å­¦ä¹ æ–¹é¢çš„æ‰€æœ‰ç»å†éƒ½æ˜¯æŸç§ç—›è‹¦ã€‚

å¤„ç† NLP ä»»åŠ¡éœ€è¦ä¸åŒç±»å‹çš„ç¥ç»ç½‘ç»œç»†èƒï¼Œå› æ­¤åœ¨å¼€å§‹ä½¿ç”¨ AllenNLP æ¡†æ¶ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å¿«é€Ÿæ¦‚è¿°ä¸€ä¸‹è¿™äº›ç»†èƒèƒŒåçš„ç†è®ºã€‚

# ğŸ™†å½“ç®€å•çš„ç¥ç»ç½‘ç»œä¸å¤Ÿæ—¶

åœ¨ç®€å•çš„ä½œå“ä¸­ï¼Œé˜…è¯»æ–‡æœ¬çš„ä»»åŠ¡æ˜¯å»ºç«‹åœ¨æˆ‘ä»¬ä»¥å‰è¯»è¿‡çš„ä¸œè¥¿ä¸Šã€‚æ¯”å¦‚è¿™å¥è¯ï¼Œå¦‚æœä½ ä¹‹å‰æ²¡æœ‰è¯»è¿‡ï¼Œå¯èƒ½å°±æ²¡æœ‰æ„ä¹‰äº†ã€‚æ‰€ä»¥åˆ›é€ è¿™äº›ç¥ç»ç½‘ç»œç»†èƒèƒŒåçš„æƒ³æ³•æ˜¯:

> *â€œå¦‚æœäººç±»åˆ©ç”¨ä»–ä»¬ä¹‹å‰è¯»è¿‡çš„ä¸œè¥¿æ¥ç†è§£æ¥ä¸‹æ¥çš„å†…å®¹ï¼Œä¹Ÿè®¸å¦‚æœæˆ‘ä»¬åœ¨æ¨¡å‹ä¸­ä½¿ç”¨è¿™ç§æœºåˆ¶ï¼Œä»–ä»¬å¯ä»¥æ›´å¥½åœ°ç†è§£æ–‡æœ¬ï¼Œå¯¹å—ï¼Ÿâ€*

## ğŸ¥é€’å½’ç¥ç»ç½‘ç»œ

ä¸ºäº†ä½¿ç”¨ä¸€ä¸ªè€ƒè™‘æ—¶é—´çš„ç½‘ç»œï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§è¡¨ç¤ºæ—¶é—´çš„æ–¹æ³•ã€‚ä½†æ˜¯æˆ‘ä»¬æ€ä¹ˆåšå‘¢ï¼Ÿ

> å¤„ç†å…·æœ‰æ—¶é—´èŒƒå›´çš„æ¨¡å¼çš„ä¸€ä¸ªæ˜¾è€Œæ˜“è§çš„æ–¹æ³•æ˜¯é€šè¿‡å°†æ¨¡å¼çš„åºåˆ—é¡ºåºä¸æ¨¡å¼å‘é‡çš„ç»´åº¦ç›¸å…³è”æ¥æ˜¾å¼åœ°è¡¨ç¤ºæ—¶é—´ã€‚**ç¬¬ä¸€ä¸ªæ—¶é—´äº‹ä»¶ç”±æ¨¡å¼å‘é‡ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ è¡¨ç¤ºï¼Œç¬¬äºŒä¸ªæ—¶é—´äº‹ä»¶ç”±æ¨¡å¼å‘é‡ä¸­çš„ç¬¬äºŒä¸ªä½ç½®è¡¨ç¤ºï¼Œä¾æ­¤ç±»æ¨ã€‚**â€”â€”[æ°å¼—é‡ŒÂ·åŸƒå°”æ›¼](http://psych.colorado.edu/~kimlab/Elman1990.pdf)

é—®é¢˜æ˜¯è¿™ç§æ–¹æ³•æœ‰å‡ ä¸ªç¼ºç‚¹ã€‚ä¾‹å¦‚:

> [â€¦]ã€T1]ç§»ä½å¯„å­˜å™¨å¯¹æ¨¡å¼çš„æŒç»­æ—¶é—´æ–½åŠ äº†ä¸¥æ ¼çš„é™åˆ¶(å› ä¸ºè¾“å…¥å±‚å¿…é¡»æä¾›å¯èƒ½çš„æœ€é•¿æ¨¡å¼)ï¼Œæ­¤å¤–ï¼Œè¿˜å»ºè®®æ‰€æœ‰è¾“å…¥å‘é‡é•¿åº¦ç›¸åŒã€‚**è¿™äº›é—®é¢˜åœ¨è¯­è¨€ç­‰é¢†åŸŸç‰¹åˆ«éº»çƒ¦ï¼Œåœ¨è¿™äº›é¢†åŸŸä¸­ï¼Œäººä»¬å¸Œæœ›å¯¹å¯å˜é•¿åº¦çš„æ¨¡å¼è¿›è¡Œå¯æ¯”è¾ƒçš„è¡¨ç¤ºã€‚**å¯¹äºè¯­éŸ³çš„åŸºæœ¬å•ä½(è¯­éŸ³ç‰‡æ®µ)å’Œå¥å­æ¥è¯´éƒ½æ˜¯å¦‚æ­¤ã€‚

[Jeffrey L. Elman](https://en.wikipedia.org/wiki/Jeffrey_Elman) è°ˆåˆ°è®ºæ–‡ä¸­çš„å…¶ä»–ç¼ºç‚¹[åŠæ—¶å‘ç°ç»“æ„](http://psych.colorado.edu/~kimlab/Elman1990.pdf)ã€‚æœ¬æ–‡ä»‹ç»äº† Elman ç½‘ç»œï¼Œè¿™æ˜¯ä¸€ä¸ªæ·»åŠ äº†ä¸€ç»„â€œä¸Šä¸‹æ–‡å•å…ƒâ€çš„ä¸‰å±‚ç½‘ç»œã€‚

å¦‚æœä½ å¯¹ç¥ç»ç½‘ç»œå®Œå…¨é™Œç”Ÿï¼Œä¹Ÿè®¸é˜…è¯»æˆ‘å†™çš„å¦ä¸€ç¯‡æ–‡ç« æ˜¯ä¸ªå¥½ä¸»æ„ã€‚ä½†ç®€å•åœ°è¯´ï¼Œç¥ç»ç½‘ç»œæ˜¯ä¸€ç§å…·æœ‰è¢«è¾“å…¥æ¿€æ´»æˆ–ä¸è¢«è¾“å…¥æ¿€æ´»çš„å•å…ƒçš„ä¸œè¥¿ã€‚

Elman æ ¹æ® Jordan (1986)å»ºè®®çš„æ–¹æ³•å¼€å§‹äº†ä»–çš„å·¥ä½œã€‚ä¹”ä¸¹æ¨å‡º**å¾ªç¯è¿æ¥**ã€‚

> å¾ªç¯è¿æ¥å…è®¸ç½‘ç»œçš„éšè—å•å…ƒçœ‹åˆ°å®ƒè‡ªå·±å…ˆå‰çš„è¾“å‡ºï¼Œå› æ­¤éšåçš„è¡Œä¸ºå¯ä»¥ç”±å…ˆå‰çš„å“åº”æ¥å†³å®šã€‚è¿™äº›å¾ªç¯è¿æ¥èµ‹äºˆäº†ç½‘ç»œå†…å­˜ã€‚

Elman ç„¶åæ·»åŠ **ä¸Šä¸‹æ–‡å•å…ƒ**ã€‚è¿™äº›ä¸Šä¸‹æ–‡å•å…ƒå°±åƒä¸€ä¸ªæ—¶é’Ÿï¼Œå‘Šè¯‰æˆ‘ä»¬ä»€ä¹ˆæ—¶å€™åº”è¯¥â€œæ”¾ä¸‹â€ä¹‹å‰çš„è¾“å…¥ã€‚ä½†æ˜¯æ€ä¹ˆåšå‘¢ï¼Ÿä¸å…¶ä»–ç¥ç»ç½‘ç»œå•å…ƒä¸€æ ·ï¼Œä¸Šä¸‹æ–‡å•å…ƒä¹Ÿæœ‰è°ƒæ•´æƒé‡çš„æœºåˆ¶ã€‚

ä¸Šä¸‹æ–‡å•å…ƒå’Œè¾“å…¥éƒ½æ¿€æ´»ç¥ç»ç½‘ç»œéšè—å•å…ƒã€‚**å½“ç¥ç»ç½‘ç»œâ€œå­¦ä¹ â€æ—¶ï¼Œæ„å‘³ç€å®ƒå…·æœ‰ç½‘ç»œå¤„ç†çš„æ‰€æœ‰è¾“å…¥æ¨¡å¼çš„è¡¨ç¤ºã€‚ä¸Šä¸‹æ–‡å•å…ƒè®°ä½å…ˆå‰çš„å†…éƒ¨çŠ¶æ€ã€‚**

å¦‚æœè¿™äº›éƒ½æ²¡æœ‰å¤šå¤§æ„ä¹‰ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªç¥ç»ç½‘ç»œç»†èƒï¼Œå®ƒæŠŠå‰ä¸€ä¸ªçŠ¶æ€è€ƒè™‘è¿›å»ï¼Œäº§ç”Ÿä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚

> â€œç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªç¥ç»ç½‘ç»œç»†èƒï¼Œå®ƒå¯ä»¥è€ƒè™‘å‰ä¸€ä¸ªçŠ¶æ€æ¥äº§ç”Ÿä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚â€

## ğŸ“¹å½“ rnn ä¸å¤Ÿç”¨æ—¶:LSTM

æ­£å¦‚ Christopher Ola åœ¨è¿™é‡Œè§£é‡Šçš„(å¦‚æœä½ æƒ³äº†è§£ LSTMs çš„æ›´å¤šä¿¡æ¯ï¼Œè¿™ç¯‡æ–‡ç« å¾ˆæ£’)æœ‰æ—¶æˆ‘ä»¬éœ€è¦æ›´å¤šçš„ä¸Šä¸‹æ–‡ï¼Œä¾‹å¦‚ï¼Œæœ‰æ—¶æˆ‘ä»¬**éœ€è¦å­˜å‚¨å¾ˆä¹…ä»¥å‰çœ‹åˆ°çš„ä¿¡æ¯**ã€‚

> è€ƒè™‘å°è¯•é¢„æµ‹æ–‡æœ¬ä¸­çš„æœ€åä¸€ä¸ªå•è¯â€œæˆ‘åœ¨æ³•å›½é•¿å¤§â€¦â€¦æˆ‘è¯´ä¸€å£æµåˆ©çš„æ³•è¯­â€æœ€è¿‘çš„ä¿¡æ¯è¡¨æ˜ï¼Œä¸‹ä¸€ä¸ªå•è¯å¯èƒ½æ˜¯ä¸€ç§è¯­è¨€çš„åç§°ï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³ç¼©å°è¯­è¨€çš„èŒƒå›´ï¼Œæˆ‘ä»¬éœ€è¦æ³•å›½çš„ä¸Šä¸‹æ–‡ï¼Œä»æ›´è¿œçš„åœ°æ–¹ã€‚**ç›¸å…³ä¿¡æ¯å’Œéœ€è¦ä¿¡æ¯çš„åœ°æ–¹ä¹‹é—´çš„å·®è·å®Œå…¨æœ‰å¯èƒ½å˜å¾—éå¸¸å¤§** â€” [å…‹é‡Œæ–¯æ‰˜å¼—Â·å¥¥æ‹‰](http://colah.github.io/posts/2015-08-Understanding-LSTMs/)

LSTM ç»†èƒè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ä»–ä»¬æ˜¯ä¸€ç§ç‰¹æ®Šçš„ RNNï¼Œèƒ½å¤Ÿå­¦ä¹ é•¿æœŸä¾èµ–æ€§ã€‚æˆ‘ä»¬å°†åªä½¿ç”¨ LSTM ç»†èƒï¼Œè€Œä¸æ˜¯æ„å»ºå®ƒä»¬ï¼Œæ‰€ä»¥ä¸ºäº†æˆ‘ä»¬çš„ç›®çš„ï¼Œä½ å¯ä»¥è®¤ä¸º LSTM ç»†èƒæ˜¯å…·æœ‰ä¸åŒç»“æ„çš„ç»†èƒï¼Œèƒ½å¤Ÿå­¦ä¹ é•¿æœŸä¾èµ–æ€§ã€‚

# âœ¨ ä¸ºæ–‡æœ¬åˆ†ç±»å»ºç«‹ä¸€ä¸ªå¥‡ç‰¹çš„æ¨¡å‹

å¥½äº†ï¼Œç†è®ºåˆ°æ­¤ä¸ºæ­¢ï¼Œè®©æˆ‘ä»¬è¿›å…¥æœ‰è¶£çš„éƒ¨åˆ†ï¼Œå»ºç«‹æ¨¡å‹ã€‚

![](img/1d6bbf1500df363311f92bef8664a097.png)

The training process

ä¸Šé¢çš„å›¾ç‰‡å‘æˆ‘ä»¬å±•ç¤ºäº†æˆ‘ä»¬å°†å¦‚ä½•è®¾ç½®ä¸€åˆ‡ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬**è·å–æ•°æ®**ï¼Œç„¶åæˆ‘ä»¬**å°†å…¶ç¼–ç ä¸ºæ¨¡å‹èƒ½å¤Ÿç†è§£çš„æ ¼å¼**(â€œä»¤ç‰Œâ€å’Œâ€œå†…éƒ¨ _ æ–‡æœ¬ _ ç¼–ç å™¨â€)ï¼Œç„¶åæˆ‘ä»¬å‘ç½‘ç»œæä¾›è¿™äº›æ•°æ®ï¼Œ**æ¯”è¾ƒæ ‡ç­¾å¹¶è°ƒæ•´æƒé‡**ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹çš„æœ€åï¼Œæ¨¡å‹å‡†å¤‡å¥½è¿›è¡Œé¢„æµ‹ã€‚

ç°åœ¨æˆ‘ä»¬ç»ˆäºå¯ä»¥æ„Ÿå—åˆ° AllenNLP çš„é­”åŠ›äº†ï¼æˆ‘ä»¬å°†ç”¨ä¸€ä¸ªç®€å•çš„ JSON æ–‡ä»¶æŒ‡å®šä¸Šå›¾ä¸­çš„æ‰€æœ‰å†…å®¹ã€‚

```
{
  "dataset_reader": {
    "type": "20newsgroups"
  },
  "train_data_path": "train",
  "test_data_path": "test",
  "evaluate_on_test": true,
  "model": {
    "type": "20newsgroups_classifier",
    "model_text_field_embedder": {
      "tokens": {
        "type": "embedding",
        "pretrained_file": "https://s3-us-west-2.amazonaws.com/allennlp/datasets/glove/glove.6B.100d.txt.gz",
        "embedding_dim": 100,
        "trainable": false
      }
    },
    "internal_text_encoder": {
      "type": "lstm",
      "bidirectional": true,
      "input_size": 100,
      "hidden_size": 100,
      "num_layers": 1,
      "dropout": 0.2
    },
    "classifier_feedforward": {
      "input_dim": 200,
      "num_layers": 2,
      "hidden_dims": [200, 100],
      "activations": ["relu", "linear"],
      "dropout": [0.2, 0.0]
    }
  },
  "iterator": {
    "type": "bucket",
    "sorting_keys": [["text", "num_tokens"]],
    "batch_size": 64
  },
  "trainer": {
    "num_epochs": 40,
    "patience": 3,
    "cuda_device": 0,
    "grad_clipping": 5.0,
    "validation_metric": "+accuracy",
    "optimizer": {
      "type": "adagrad"
    }
  }
}
```

è®©æˆ‘ä»¬çœ‹çœ‹é‚£é‡Œå‘ç”Ÿäº†ä»€ä¹ˆã€‚

## 1â€”æ•°æ®è¾“å…¥

ä¸ºäº†å‘Šè¯‰ AllenNLP è¾“å…¥æ•°æ®é›†ä»¥åŠå¦‚ä½•ä»ä¸­è¯»å–ï¼Œæˆ‘ä»¬åœ¨ JSON æ–‡ä»¶ä¸­è®¾ç½®äº†`'dataset_reader'`é”®ã€‚

> ä¸€ä¸ª`DatasetReader`ä»æŸä¸ªä½ç½®è¯»å–æ•°æ®å¹¶æ„é€ ä¸€ä¸ª`Dataset`ã€‚é™¤äº†æ–‡ä»¶è·¯å¾„ä¹‹å¤–ï¼Œè¯»å–æ•°æ®æ‰€éœ€çš„æ‰€æœ‰å‚æ•°éƒ½åº”è¯¥ä¼ é€’ç»™`DatasetReader` â€” [AllenNLP æ–‡æ¡£](https://allenai.github.io/allennlp-docs/api/allennlp.data.dataset_readers.dataset_reader.html?highlight=dataset_reader#module-allennlp.data.dataset_readers.dataset_reader)çš„æ„é€ å‡½æ•°

æˆ‘ä»¬çš„æ•°æ®é›†å°†æ˜¯ 20 ä¸ªæ–°ç»„ï¼Œç¨åæˆ‘ä»¬å°†å®šä¹‰å¦‚ä½•ä»ä¸­è¯»å–(åœ¨ python ç±»ä¸­)ã€‚é¦–å…ˆè®©æˆ‘ä»¬å®šä¹‰æ¨¡å‹çš„å…¶ä½™éƒ¨åˆ†ã€‚

## 2 â€”æ¨¡å‹

ä¸ºäº†æŒ‡å®šå‹å·ï¼Œæˆ‘ä»¬å°†è®¾ç½®`'model'`é”®ã€‚`'model'`é”®å†…è¿˜æœ‰ä¸‰ä¸ªå‚æ•°:

`'model_text_field_embedder'`ã€`'internal_text_encoder'`å’Œ`'classifier_feedforward'`

è®©æˆ‘ä»¬å…ˆå¤„ç†ç¬¬ä¸€ä¸ªï¼Œå‰©ä¸‹çš„ä¸¤ä¸ªç•™å¾…ä»¥åå¤„ç†ã€‚

ä½¿ç”¨å¯†é’¥`'model_text_field_embedder'`ï¼Œæˆ‘ä»¬å‘Šè¯‰ AllenNLP åœ¨å°†æ•°æ®ä¼ é€’ç»™æ¨¡å‹ä¹‹å‰åº”è¯¥å¦‚ä½•å¯¹å…¶è¿›è¡Œç¼–ç ã€‚ç®€è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬å¸Œæœ›è®©æˆ‘ä»¬çš„æ•°æ®æ›´â€œæœ‰æ„ä¹‰â€ã€‚å…¶èƒŒåçš„æƒ³æ³•æ˜¯è¿™æ ·çš„:**å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿåƒæ¯”è¾ƒæ•°å­—ä¸€æ ·æ¯”è¾ƒå•è¯ä¼šæ€ä¹ˆæ ·ï¼Ÿ**

å¦‚æœ **5 - 3 + 2 = 4** ä¸ºä»€ä¹ˆä¸æ˜¯**å›½ç‹-ç”·äºº+å¥³äºº=ç‹å**ï¼Ÿ

ä½¿ç”¨**å•è¯åµŒå…¥**æˆ‘ä»¬å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚è¿™å¯¹æ¨¡å‹ä¹Ÿæœ‰å¥½å¤„ï¼Œå› ä¸ºç°åœ¨æˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨å¾ˆå¤šç¨€ç–æ•°ç»„(æœ‰å¾ˆå¤šé›¶çš„æ•°ç»„)ä½œä¸ºè¾“å…¥ã€‚

> å•è¯åµŒå…¥æ˜¯è‡ªç„¶è¯­è¨€å¤„ç†(NLP)ä¸­ä¸€ç»„è¯­è¨€å»ºæ¨¡å’Œç‰¹å¾å­¦ä¹ æŠ€æœ¯çš„ç»Ÿç§°**ï¼Œå…¶ä¸­æ¥è‡ªè¯æ±‡è¡¨çš„å•è¯æˆ–çŸ­è¯­è¢«æ˜ å°„åˆ°å®æ•°çš„å‘é‡**ã€‚ä»æ¦‚å¿µä¸Šè®²ï¼Œå®ƒæ¶‰åŠåˆ°ä¸€ä¸ªæ•°å­¦ä¸Šçš„[åµŒå…¥](https://en.wikipedia.org/wiki/Embedding)ä»ä¸€ä¸ªæ¯ä¸ªå•è¯ä¸€ç»´çš„ç©ºé—´åˆ°ä¸€ä¸ªè¿ç»­çš„[æ›´ä½ç»´åº¦çš„å‘é‡ç©ºé—´](https://en.wikipedia.org/wiki/Vector_space)ã€‚â€” [ç»´åŸºç™¾ç§‘](https://en.wikipedia.org/wiki/Word_embedding)

åœ¨æˆ‘ä»¬çš„æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ [GloVe:å•è¯è¡¨ç¤ºçš„å…¨å±€å‘é‡](https://nlp.stanford.edu/projects/glove/)

> GloVe æ˜¯ä¸€ç§æ— ç›‘ç£å­¦ä¹ ç®—æ³•ï¼Œç”¨äº**è·å–å•è¯çš„çŸ¢é‡è¡¨ç¤º**ã€‚åœ¨æ¥è‡ªè¯­æ–™åº“çš„èšé›†çš„å…¨å±€å•è¯-å•è¯å…±ç°ç»Ÿè®¡ä¸Šæ‰§è¡Œè®­ç»ƒï¼Œå¹¶ä¸”æ‰€å¾—çš„è¡¨ç¤ºå±•ç¤ºäº†å•è¯å‘é‡ç©ºé—´çš„æœ‰è¶£çš„çº¿æ€§å­ç»“æ„ã€‚â€”â€”[æ‰‹å¥—](https://nlp.stanford.edu/projects/glove/)

å¦‚æœè¿™äº›æœ‰æ„ä¹‰çš„è¯ï¼Œå°±æŠŠ Glove æƒ³è±¡æˆä¸€ä¸ªæ¨¡å‹ï¼Œåœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬ä¼ é€’å•è¯å¹¶æŠŠå®ƒä»¬ç¼–ç æˆå‘é‡ã€‚æˆ‘ä»¬å°†æ¯ä¸ªåµŒå…¥å‘é‡çš„å¤§å°è®¾ç½®ä¸º 100ã€‚

> Glove å°†å•è¯ç¼–ç æˆå‘é‡

è¿™å°±æ˜¯`'model_text_field_embedder'`çš„ä½œç”¨ã€‚

## 3 â€”æ•°æ®è¿­ä»£å™¨

åƒå¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬å°†åˆ†æ‰¹åˆ†ç¦»è®­ç»ƒæ•°æ®ã€‚AllenNLP æä¾›äº†ä¸€ä¸ªåä¸º [BucketIterator](https://allenai.github.io/allennlp-docs/api/allennlp.data.iterators.html#bucket-iterator) çš„è¿­ä»£å™¨ï¼Œå®ƒé€šè¿‡æ ¹æ®æ¯æ‰¹çš„æœ€å¤§è¾“å…¥é•¿åº¦å¡«å……æ‰¹æ¥æé«˜è®¡ç®—(å¡«å……)æ•ˆç‡ã€‚ä¸ºæ­¤ï¼Œå®ƒæ ¹æ®æ¯ä¸ªæ–‡æœ¬ä¸­çš„æ ‡è®°æ•°é‡å¯¹å®ä¾‹è¿›è¡Œæ’åºã€‚æˆ‘ä»¬åœ¨`'iterator'`é”®ä¸­è®¾ç½®è¿™äº›å‚æ•°ã€‚

## 4 â€”åŸ¹è®­å¸ˆ

æœ€åä¸€æ­¥æ˜¯ä¸ºåŸ¹è®­é˜¶æ®µè®¾ç½®é…ç½®ã€‚è®­ç»ƒå™¨ä½¿ç”¨ AdaGrad optimizer è¾¾ 10 ä¸ªæ—¶æœŸï¼Œå¦‚æœåœ¨æœ€å 3 ä¸ªæ—¶æœŸéªŒè¯å‡†ç¡®åº¦æ²¡æœ‰æé«˜ï¼Œåˆ™åœæ­¢ä½¿ç”¨ã€‚

ä¸ºäº†è®­ç»ƒæ¨¡å‹ï¼Œæˆ‘ä»¬åªéœ€è¦è¿è¡Œ:

`python run.py our_classifier.json -s /tmp/your_output_dir_here`

å¦ä¸€ä»¶å¾ˆé…·çš„äº‹æƒ…æ˜¯ï¼Œæœ‰äº†è¿™ä¸ªæ¡†æ¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»¥ååœæ­¢å’Œæ¢å¤è®­ç»ƒã€‚ä½†åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®š dataset_reader å’Œæ¨¡å‹ python ç±»ã€‚

# ğŸ‘©ğŸ¾â€ğŸ’»ç¼–å†™ AllenNLP Python ç±»

## æ•°æ®é›† _ é˜…è¯»å™¨. py

æˆ‘ä»¬å°†ä½¿ç”¨ç”± [scikit-learn](http://scikit-learn.org/stable/datasets/twenty_newsgroups.html) æä¾›çš„ 20 ä¸ªæ–°é—»ç»„ã€‚è¦åœ¨ JSON æ–‡ä»¶ä¸­å¼•ç”¨ DatasetReaderï¼Œæˆ‘ä»¬éœ€è¦æ³¨å†Œå®ƒ:

```
@DatasetReader.register("20newsgroups")
class NewsgroupsDatasetReader(DatasetReader):
```

æ‚¨å°†å®ç°ä¸‰ä¸ªæ–¹æ³•:`read()`å’Œ`text_to_instance()`ã€‚

*   `read()`

`read()`æ–¹æ³•ä» scikit-learn è·å–æ•°æ®ã€‚ä½¿ç”¨ AllenNLPï¼Œæ‚¨å¯ä»¥è®¾ç½®æ•°æ®æ–‡ä»¶çš„è·¯å¾„(ä¾‹å¦‚ JSON æ–‡ä»¶çš„è·¯å¾„)ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯åƒ python æ¨¡å—ä¸€æ ·å¯¼å…¥æ•°æ®ã€‚æˆ‘ä»¬å°†ä»æ•°æ®é›†ä¸­è¯»å–æ¯ä¸ªæ–‡æœ¬å’Œæ¯ä¸ªæ ‡ç­¾ï¼Œå¹¶ç”¨`text_to_instance()`åŒ…è£…å®ƒã€‚

*   `text_to_instance()`

è¯¥æ–¹æ³•"*æ‰§è¡Œä»æ–‡æœ¬è¾“å…¥åˆ°* `*Instance*` " [(AllenNLP æ–‡æ¡£](https://allenai.github.io/allennlp-docs/api/allennlp.data.dataset_readers.dataset_reader.html?highlight=datasetreader))æ‰€éœ€çš„ä»»ä½•æ ‡è®°åŒ–æˆ–å¤„ç†ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ„å‘³ç€è¿™æ ·åš:

```
 @overrides
    def text_to_instance(self, newsgroups_post: str, label: str = None) -> Instance:  
        tokenized_text = self._tokenizer.tokenize(newsgroups_post)
        post_field = **TextField(tokenized_text, self._token_indexers)**
        fields = {'post': post_field}
        if label is not None:
            fields['label'] = **LabelField(int(label),skip_indexing=True)**
        return Instance(fields)
```

æˆ‘ä»¬å°† 20 ä¸ªæ–°é—»ç»„ä¸­çš„æ–‡æœ¬å’Œæ ‡ç­¾åŒ…è£…æˆ`[TextField](https://allenai.github.io/allennlp-docs/api/allennlp.data.fields.html?highlight=textfield#text-field)`å’Œ`[LabelField](https://allenai.github.io/allennlp-docs/api/allennlp.data.fields.html?highlight=textfield#allennlp.data.fields.label_field.LabelField)`ã€‚

## model.py

æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªåŒå‘ LSTM ç½‘ç»œï¼Œå®ƒæ˜¯ä¸€ä¸ªå¤åˆ¶ç¬¬ä¸€å¾ªç¯å±‚çš„å•å…ƒã€‚ä¸€å±‚æŒ‰åŸæ ·æ¥æ”¶è¾“å…¥ï¼Œå¦ä¸€å±‚æ¥æ”¶è¾“å…¥åºåˆ—çš„åå‘å‰¯æœ¬ã€‚å› æ­¤ï¼ŒBLSTM ç½‘ç»œè¢«è®¾è®¡ä¸ºæ•è·åºåˆ—æ•°æ®é›†çš„ä¿¡æ¯å¹¶ä¿æŒæ¥è‡ªè¿‡å»å’Œæœªæ¥çš„ä¸Šä¸‹æ–‡ç‰¹å¾ã€‚(æ¥æº:[åŒå‘ LSTM é€’å½’ç¥ç»ç½‘ç»œä¸­æ–‡åˆ†è¯](https://arxiv.org/pdf/1602.04874.pdf))

é¦–å…ˆè®©æˆ‘ä»¬å®šä¹‰æ¨¡å‹**çš„ç±»å‚æ•°**

*   `vocab`

> å› ä¸ºåœ¨æ‚¨çš„æ¨¡å‹ä¸­ç»å¸¸æœ‰å‡ ä¸ªä¸åŒçš„æ˜ å°„ï¼Œæ‰€ä»¥`Vocabulary`ä¼šè·Ÿè¸ªä¸åŒçš„åç§°ç©ºé—´ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæ–‡æœ¬çš„â€œä»¤ç‰Œâ€è¯æ±‡è¡¨(ä»£ç ä¸­æ²¡æœ‰æ˜¾ç¤ºï¼Œä½†è¿™æ˜¯åœ¨åå°ä½¿ç”¨çš„é»˜è®¤å€¼)ï¼Œå’Œä¸€ä¸ªæˆ‘ä»¬è¯•å›¾é¢„æµ‹çš„æ ‡ç­¾çš„â€œæ ‡ç­¾â€è¯æ±‡è¡¨â€” [åœ¨æ‚¨çš„é¡¹ç›®ä¸­ä½¿ç”¨ AllenNLP](https://github.com/allenai/allennlp/blob/master/tutorials/getting_started/using_in_your_repo.md)

*   `model_text_field_embedder`

ç”¨äºåµŒå…¥æˆ‘ä»¬ä½œä¸ºè¾“å…¥è·å¾—çš„ä»¤ç‰Œ`TextField`ã€‚è¿”å›å•è¯çš„æ‰‹å¥—å‘é‡è¡¨ç¤ºã€‚

*   `internal_text_encoder`

æˆ‘ä»¬å°†ä½¿ç”¨ç¼–ç å™¨å°†è¾“å…¥æ–‡æœ¬è½¬æ¢ä¸ºå•ä¸ªå‘é‡(RNNsï¼Œè¿˜è®°å¾—å—ï¼Ÿ).`Seq2VecEncoder`æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œå®ƒå°†ä¸€ç³»åˆ—å‘é‡ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¿”å›ä¸€ä¸ªå‘é‡ã€‚

*   `num_classes` â€”è¦é¢„æµ‹çš„æ ‡ç­¾æ•°é‡

ç°åœ¨è®©æˆ‘ä»¬å®ç°æ¨¡å‹ç±»**æ–¹æ³•**

*   `forward()`

![](img/f6477b26fb45fce509ddeb032583462b.png)

What the forward() method does

> è¯¥æ¨¡å‹åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯åµŒå…¥æ–‡æœ¬ï¼Œç„¶åå°†å…¶ç¼–ç ä¸ºä¸€ä¸ªå‘é‡ã€‚ä¸ºäº†å¯¹æ–‡æœ¬è¿›è¡Œç¼–ç ï¼Œæˆ‘ä»¬éœ€è¦è·å¾—æ©ç ï¼Œè¿™äº›æ©ç è¡¨ç¤ºæ ‡è®°åºåˆ—ä¸­çš„å“ªäº›å…ƒç´ åªæ˜¯ä¸ºäº†å¡«å……è€Œå­˜åœ¨çš„ã€‚
> 
> ç„¶åæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå‰é¦ˆç½‘ç»œæ¥å¾—åˆ°ç±»é€»è¾‘ã€‚æˆ‘ä»¬å°† logits é€šè¿‡ softmax æ¥è·å¾—é¢„æµ‹æ¦‚ç‡ã€‚æœ€åï¼Œå¦‚æœç»™æˆ‘ä»¬ä¸€ä¸ªæ ‡ç­¾ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—æŸå¤±å¹¶è¯„ä¼°æˆ‘ä»¬çš„æŒ‡æ ‡ã€‚â€” [åœ¨æ‚¨çš„é¡¹ç›®ä¸­ä½¿ç”¨ AllenNLP](https://github.com/allenai/allennlp/blob/master/tutorials/getting_started/using_in_your_repo.md)

æ­£å‘æ–¹æ³•åŸºæœ¬ä¸Šå®Œæˆæ¨¡å‹è®­ç»ƒä»»åŠ¡ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šä¸€ç‚¹æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…ï¼Œä½ å¯ä»¥å»[è¿™é‡Œ](https://medium.freecodecamp.org/big-picture-machine-learning-classifying-text-with-neural-networks-and-tensorflow-d94036ac2274#20cc)ã€‚ç°åœ¨æˆ‘ä»¬æ¥è°ˆè°ˆæ¨¡å‹ç±»å‚æ•°çš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†:**åˆ†ç±»å™¨ _ å‰é¦ˆ**ã€‚

> æˆ‘ä»¬éœ€è¦`*Model.forward*`æ¥è®¡ç®—å®ƒè‡ªå·±çš„æŸå¤±ã€‚è®­ç»ƒä»£ç å°†åœ¨ç”±`*forward*`è¿”å›çš„å­—å…¸ä¸­å¯»æ‰¾`*loss*`å€¼ï¼Œå¹¶è®¡ç®—è¯¥æŸå¤±çš„æ¢¯åº¦ä»¥æ›´æ–°æ¨¡å‹çš„å‚æ•°ã€‚â€” [åœ¨æ‚¨çš„é¡¹ç›®ä¸­ä½¿ç”¨ AllenNLP](https://github.com/allenai/allennlp/blob/master/tutorials/getting_started/using_in_your_repo.md)

*   `decode()`

> `decode`æœ‰ä¸¤ä¸ªåŠŸèƒ½:å®ƒæ¥å—`forward`çš„è¾“å‡ºï¼Œå¹¶å¯¹å…¶è¿›è¡Œä»»ä½•å¿…è¦çš„æ¨æ–­æˆ–è§£ç ï¼Œå®ƒå°†æ•´æ•°è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œä½¿å…¶å¯è¯»(ä¾‹å¦‚ï¼Œç”¨äºæ¼”ç¤º)ã€‚â€” [åœ¨æ‚¨çš„](https://github.com/allenai/allennlp/blob/master/tutorials/getting_started/using_in_your_repo.md)ä¸­ä½¿ç”¨ AllenNLP

# ğŸ”ƒè¿è¡Œä»£ç 

å¦‚æˆ‘ä¹‹å‰æ‰€è¯´ï¼Œé€šè¿‡å‘½ä»¤è¡Œè®­ç»ƒæ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨:

`python run.py our_classifier.json -s /tmp/your_output_dir_here`

æˆ‘è¿˜åˆ›å»ºäº†ä¸€ä¸ªç¬”è®°æœ¬ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ Google Colaboratory ä¸Šè¿è¡Œå®éªŒå¹¶å…è´¹ä½¿ç”¨ GPUï¼Œä¸‹é¢æ˜¯é“¾æ¥:[https://colab . research . Google . com/drive/1 q3b 5 hackcjysvd 6 yhrwnx L2 byqgk 08 jhq](https://colab.research.google.com/drive/1q3b5HAkcjYsVd6yhrwnxL2ByqGK08jhQ)

ä½ ä¹Ÿå¯ä»¥åœ¨[è¿™ä¸ªåº“](https://github.com/dmesquita/easy-deep-learning-with-AllenNLP)ä¸ŠæŸ¥çœ‹ä»£ç ã€‚

æˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ªç®€å•çš„åˆ†ç±»æ¨¡å‹ï¼Œä½†å¯èƒ½æ€§æ˜¯æ— é™çš„ã€‚è¯¥æ¡†æ¶æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å·¥å…·ï¼Œå¯ä»¥ä¸ºæˆ‘ä»¬çš„äº§å“åˆ›å»ºæœ‰è¶£çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ã€‚âœ¨

[![](img/308a8d84fb9b2fab43d66c117fcc4bb4.png)](https://medium.com/swlh)

## è¿™ç¯‡æ–‡ç« å‘è¡¨åœ¨ [The Startup](https://medium.com/swlh) ä¸Šï¼Œè¿™æ˜¯ Medium æœ€å¤§çš„åˆ›ä¸šåˆŠç‰©ï¼Œæ‹¥æœ‰ 307ï¼Œ871+è¯»è€…ã€‚

## è®¢é˜…æ¥æ”¶[æˆ‘ä»¬çš„å¤´æ¡æ–°é—»åœ¨è¿™é‡Œ](http://growthsupply.com/the-startup-newsletter/)ã€‚

[![](img/b0164736ea17a63403e660de5dedf91a.png)](https://medium.com/swlh)