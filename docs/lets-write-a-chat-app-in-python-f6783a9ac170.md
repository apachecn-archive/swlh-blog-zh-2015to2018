# æˆ‘ä»¬ç”¨ Python å†™ä¸ªèŠå¤© App å§

> åŸæ–‡ï¼š<https://medium.com/swlh/lets-write-a-chat-app-in-python-f6783a9ac170>

ä¸åˆ° 150 è¡Œä»£ç ä¸­çš„ Tkinter +å¥—æ¥å­—

![](img/fbf1546c6d733dde0b5e5a63d1048f1a.png)

Itâ€™s Always Good to Have a Conversation!

ä¸è¦å¤ªé¢‘ç¹ï¼Œä½ ç¢°å·§åˆ›é€ äº†ä¸€äº›æƒŠäººçš„ç®€å•è€Œæœ‰è¶£çš„ä¸œè¥¿ï¼Œä½ åªæ˜¯è¿«ä¸åŠå¾…åœ°ä¸ä¸–ç•Œåˆ†äº«ã€‚

è¿™æ­£æ˜¯å‘ç”Ÿåœ¨æˆ‘èº«ä¸Šçš„äº‹æƒ…ï¼Œäº‹å®ä¸Šï¼Œæˆ‘åœ¨è¿™é‡Œåˆ†äº«æˆ‘æ˜¯å¦‚ä½•ç”¨éå¸¸ç®€æ´çš„ Python ä»£ç åˆ¶ä½œä¸€ä¸ªç®€å•çš„èŠå¤©åº”ç”¨ç¨‹åºçš„ã€‚æ›´ä½•å†µï¼›æˆ‘å·²ç»åœ¨æ²¡æœ‰*ä»»ä½•*ç¬¬ä¸‰æ–¹ä¾èµ–çš„æƒ…å†µä¸‹å®ç°äº†ä»£ç ï¼æ‰€ä»¥è®©æˆ‘ä»¬å¼€å§‹å§ï¼

é¦–å…ˆï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªèŠå¤©æœåŠ¡å™¨ï¼Œé€šè¿‡å®ƒå¯ä»¥æ¥æ”¶æ¥è‡ªæƒ³è¦äº¤æµçš„å®¢æˆ·çš„è¯·æ±‚ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä½¿ç”¨äº†å¥½çš„ ole å¥—æ¥å­—å’Œä¸€ç‚¹å¤šçº¿ç¨‹ã€‚ä½¿ç”¨åƒ [Twisted](https://twistedmatrix.com/) å’Œ [SocketServer](https://pymotw.com/3/socketserver/) è¿™æ ·çš„æ¡†æ¶æ˜¯ä¸€ç§é€‰æ‹©ï¼Œä½†å¯¹äºæˆ‘ä»¬è¿™æ ·ç®€å•çš„è½¯ä»¶æ¥è¯´ï¼Œè¿™ä¼¼ä¹æœ‰ç‚¹å¤§æå°ç”¨äº†ã€‚

# **æœåŠ¡å™¨**

![](img/a6e1e4b0e0044b3bfed093c7dc4ce8bc.png)

ä¸‹é¢æ˜¯æˆ‘ä»¬å¦‚ä½•å¼€å§‹æˆ‘ä»¬çš„æœåŠ¡å™¨è„šæœ¬(å¯¹äºè¿™ä¸ªåº”ç”¨ç¨‹åºï¼Œåªæœ‰ä¸¤ä¸ªè„šæœ¬:ä¸€ä¸ªç”¨äºæœåŠ¡å™¨ï¼Œå¦ä¸€ä¸ªç”¨äºå®¢æˆ·ç«¯):

```
#!/usr/bin/env python3
"""Server for multithreaded (asynchronous) chat application."""from socket import AF_INET, socket, SOCK_STREAM
from threading import Thread
```

ä¸ºæ­¤æˆ‘ä»¬å°†ä½¿ç”¨ TCP å¥—æ¥å­—ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨`AF_INET`å’Œ`SOCK_STREAM`æ ‡å¿—ã€‚æˆ‘ä»¬åœ¨ UDP å¥—æ¥å­—ä¸Šä½¿ç”¨å®ƒä»¬ï¼Œå› ä¸ºå®ƒä»¬æ›´åƒæ˜¯ç”µè¯ï¼Œåœ¨é€šä¿¡å¼€å§‹ä¹‹å‰ï¼Œæ¥æ”¶è€…å¿…é¡»æ‰¹å‡†ä¼ å…¥çš„è¿æ¥ï¼Œè€Œ UDP å¥—æ¥å­—æ›´åƒæ˜¯é‚®ä»¶åçš„ä¸œè¥¿(ä»»ä½•äººéƒ½å¯ä»¥å‘ä»–/å¥¹çŸ¥é“åœ°å€çš„ä»»ä½•æ¥æ”¶è€…å‘é€é‚®ä»¶)ï¼Œæ‰€ä»¥åœ¨é€šä¿¡å‘ç”Ÿä¹‹å‰ï¼Œå®ƒä»¬å®é™…ä¸Šä¸éœ€è¦å»ºç«‹è¿æ¥ã€‚æ˜¾ç„¶ï¼ŒTCP æ¯” UDP å¥—æ¥å­—æ›´é€‚åˆæˆ‘ä»¬ç›®çš„ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨å®ƒä»¬ã€‚è¿™é‡Œå¯ä»¥äº†è§£æ›´å¤šæ’åº§[ã€‚](https://en.wikipedia.org/wiki/Network_socket)

å¯¼å…¥åï¼Œæˆ‘ä»¬è®¾ç½®äº†ä¸€äº›*å¸¸é‡*ä»¥å¤‡åç”¨:

```
clients = {}
addresses = {}HOST = ''
PORT = 33000
BUFSIZ = 1024
ADDR = (HOST, PORT)
SERVER = socket(AF_INET, SOCK_STREAM)
SERVER.bind(ADDR)
```

ç°åœ¨ï¼Œæˆ‘ä»¬å°†æœåŠ¡ä»»åŠ¡åˆ†ä¸ºæ¥å—æ–°è¿æ¥ã€å¹¿æ’­æ¶ˆæ¯å’Œå¤„ç†ç‰¹å®šå®¢æˆ·ã€‚è®©æˆ‘ä»¬ä»æ¥å—è¿æ¥å¼€å§‹:

```
def accept_incoming_connections():
    """Sets up handling for incoming clients."""
    while True:
        client, client_address = SERVER.accept()
        print("%s:%s has connected." % client_address)
        client.send(bytes("Greetings from the cave!"+
                          "Now type your name and press enter!", "utf8"))
        addresses[client] = client_address
        Thread(target=handle_client, args=(client,)).start()
```

è¿™åªæ˜¯ä¸€ä¸ªæ°¸è¿œç­‰å¾…ä¼ å…¥è¿æ¥çš„å¾ªç¯ï¼Œä¸€æ—¦è·å¾—è¿æ¥ï¼Œå®ƒå°±è®°å½•è¿æ¥(æ‰“å°ä¸€äº›è¿æ¥ç»†èŠ‚)å¹¶å‘è¿æ¥çš„å®¢æˆ·ç«¯å‘é€æ¬¢è¿æ¶ˆæ¯ã€‚ç„¶åï¼Œå®ƒå°†å®¢æˆ·ç«¯çš„åœ°å€å­˜å‚¨åœ¨`addresses`å­—å…¸ä¸­ï¼Œç¨åä¸ºè¯¥å®¢æˆ·ç«¯å¯åŠ¨å¤„ç†çº¿ç¨‹ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰ä¸ºæ­¤å®šä¹‰ç›®æ ‡å‡½æ•°`handle_client()`ï¼Œä½†æˆ‘ä»¬ä¼šè¿™æ ·åš:

```
def handle_client(client):  # Takes client socket as argument.
    """Handles a single client connection."""
     name = client.recv(BUFSIZ).decode("utf8")
    welcome = 'Welcome %s! If you ever want to quit, type {quit} to exit.' % name
    client.send(bytes(welcome, "utf8"))
    msg = "%s has joined the chat!" % name
    broadcast(bytes(msg, "utf8"))
    clients[client] = name
     while True:
        msg = client.recv(BUFSIZ)
        if msg != bytes("{quit}", "utf8"):
            broadcast(msg, name+": ")
        else:
            client.send(bytes("{quit}", "utf8"))
            client.close()
            del clients[client]
            broadcast(bytes("%s has left the chat." % name, "utf8"))
            break
```

è‡ªç„¶åœ°ï¼Œåœ¨æˆ‘ä»¬å‘æ–°å®¢æˆ·å‘é€æ¬¢è¿æ¶ˆæ¯åï¼Œå®ƒä¼šå›å¤ä¸€ä¸ªä»–/å¥¹å¸Œæœ›ç”¨äºè¿›ä¸€æ­¥äº¤æµçš„åå­—ã€‚åœ¨`handle_client()`å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ä¿å­˜è¿™ä¸ªåå­—ï¼Œç„¶åå‘å®¢æˆ·ç«¯å‘é€å¦ä¸€æ¡æ¶ˆæ¯ï¼Œå…³äºè¿›ä¸€æ­¥çš„æŒ‡ä»¤ã€‚æ¥ä¸‹æ¥æ˜¯é€šä¿¡çš„ä¸»å¾ªç¯:åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä»å®¢æˆ·ç«¯æ¥æ”¶è¿›ä¸€æ­¥çš„æ¶ˆæ¯ï¼Œå¦‚æœæ¶ˆæ¯ä¸åŒ…å«é€€å‡ºæŒ‡ä»¤ï¼Œæˆ‘ä»¬åªéœ€å°†æ¶ˆæ¯å¹¿æ’­ç»™å…¶ä»–è¿æ¥çš„å®¢æˆ·ç«¯(ç¨åæˆ‘ä»¬å°†å®šä¹‰å¹¿æ’­æ–¹æ³•)ã€‚å¦‚æœæˆ‘ä»¬ç¡®å®é‡åˆ°äº†å¸¦æœ‰é€€å‡ºæŒ‡ä»¤çš„æ¶ˆæ¯(ä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯å‘é€äº†ä¸€ä¸ª`{quit}`)ï¼Œæˆ‘ä»¬å°†ç›¸åŒçš„æ¶ˆæ¯å›æ˜¾åˆ°å®¢æˆ·ç«¯(å®ƒè§¦å‘å®¢æˆ·ç«¯çš„å…³é—­æ“ä½œ)ï¼Œç„¶åæˆ‘ä»¬å…³é—­å®ƒçš„è¿æ¥å¥—æ¥å­—ã€‚ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡åˆ é™¤å®¢æˆ·ç«¯çš„æ¡ç›®æ¥åšä¸€äº›æ¸…ç†å·¥ä½œï¼Œæœ€åå‘å…¶ä»–è¿æ¥çš„äººå¤§å£°å®£å¸ƒè¿™ä¸ªç‰¹å®šçš„äººå·²ç»ç¦»å¼€äº†å¯¹è¯ã€‚

ç°åœ¨æˆ‘ä»¬çš„`broadcast()`åŠŸèƒ½æ¥äº†:

```
def broadcast(msg, prefix=""):  # prefix is for name identification.
    """Broadcasts a message to all the clients."""
     for sock in clients:
        sock.send(bytes(prefix, "utf8")+msg)
```

è¿™å‡ ä¹æ˜¯ä¸è¨€è‡ªæ˜çš„ï¼›å®ƒåªæ˜¯å°†`msg`å‘é€ç»™æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œå¹¶åœ¨å¿…è¦æ—¶æ·»åŠ ä¸€ä¸ªå¯é€‰çš„`prefix`ã€‚åœ¨æˆ‘ä»¬çš„`handle_client()`å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ç¡®å®ä¼ é€’äº†ä¸€ä¸ª`prefix`åˆ°`broadcast()`ï¼Œæˆ‘ä»¬è¿™æ ·åšæ˜¯ä¸ºäº†è®©äººä»¬å¯ä»¥ç¡®åˆ‡åœ°çœ‹åˆ°è°æ˜¯ç‰¹å®šæ¶ˆæ¯çš„å‘é€è€…ã€‚

è¿™å°±æ˜¯æˆ‘ä»¬çš„æœåŠ¡å™¨æ‰€éœ€çš„æ‰€æœ‰åŠŸèƒ½ã€‚æœ€åï¼Œæˆ‘ä»¬æ”¾å…¥ä¸€äº›ä»£ç æ¥å¯åŠ¨æˆ‘ä»¬çš„æœåŠ¡å™¨å¹¶ç›‘å¬ä¼ å…¥çš„è¿æ¥:

```
if __name__ == "__main__":
    SERVER.listen(5)  # Listens for 5 connections at max.
    print("Waiting for connection...")
    ACCEPT_THREAD = Thread(target=accept_incoming_connections)
    ACCEPT_THREAD.start()  # Starts the infinite loop.
    ACCEPT_THREAD.join()
    SERVER.close()
```

æˆ‘ä»¬`join()` `ACCEPT_THREAD`è®©ä¸»è„šæœ¬ç­‰å¾…å®ƒå®Œæˆï¼Œè€Œä¸è·³è½¬åˆ°ä¸‹ä¸€è¡Œï¼Œå…³é—­æœåŠ¡å™¨ã€‚

è¿™å°±å®Œæˆäº†æˆ‘ä»¬çš„æœåŠ¡å™¨è„šæœ¬ï¼Œå®ƒå‘ˆç°åœ¨ä»¥ä¸‹è¦ç‚¹ä¸­(å¯¹äºé‚£äº›æ­£åœ¨æ™ºèƒ½æ‰‹æœºä¸Šé˜…è¯»æœ¬æ–‡çš„äººï¼Œè¯·è®¿é—® [this](https://github.com/schedutron/CPAP/blob/master/Chap5/chat_serv.py) é“¾æ¥ä»¥è·å¾—å®Œæ•´çš„æœåŠ¡å™¨ä»£ç ):

# å®¢æˆ·

![](img/7bb5a503413b2e6cc989c6d3781e7729.png)

è¿™æ›´æœ‰è¶£ï¼Œå› ä¸ºæˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ª GUIï¼æˆ‘ä»¬ä½¿ç”¨ Tkinterï¼ŒPython çš„â€œåŒ…å«ç”µæ± â€GUI æ„å»ºå·¥å…·æ¥å®ç°æˆ‘ä»¬çš„ç›®çš„ã€‚è®©æˆ‘ä»¬å…ˆåšä¸€äº›å¯¼å…¥:

```
#!/usr/bin/env python3
"""Script for Tkinter GUI chat client."""from socket import AF_INET, socket, SOCK_STREAM
from threading import Thread
import tkinter
```

ç°åœ¨æˆ‘ä»¬å°†ç¼–å†™å¤„ç†æ¶ˆæ¯å‘é€å’Œæ¥æ”¶çš„å‡½æ•°ã€‚æˆ‘ä»¬ä»æ¥æ”¶å¼€å§‹:

```
def receive():
    """Handles receiving of messages."""
    while True:
        try:
            msg = client_socket.recv(BUFSIZ).decode("utf8")
            msg_list.insert(tkinter.END, msg)
        except OSError:  # Possibly client has left the chat.
            break
```

ä¸ºä»€ä¹ˆåˆæ˜¯æ— é™å¾ªç¯ï¼Ÿå› ä¸ºæˆ‘ä»¬æ¥æ”¶ä¿¡æ¯çš„æ–¹å¼æ˜¯ä¸ç¡®å®šçš„ï¼Œä¸æˆ‘ä»¬å‘é€ä¿¡æ¯çš„æ–¹å¼å’Œæ—¶é—´æ— å…³ã€‚æˆ‘ä»¬ä¸å¸Œæœ›è¿™æ˜¯ä¸€ä¸ªå¯¹è®²æœºèŠå¤©åº”ç”¨ç¨‹åºï¼Œä¸€æ¬¡åªèƒ½å‘é€ ***æˆ–*** æ¥æ”¶ï¼›æˆ‘ä»¬å¸Œæœ›åœ¨å¯èƒ½çš„æ—¶å€™æ¥æ”¶ä¿¡æ¯ï¼Œåœ¨éœ€è¦çš„æ—¶å€™å‘é€ä¿¡æ¯ã€‚å¾ªç¯ä¸­çš„åŠŸèƒ½éå¸¸ç®€å•ï¼›`recv()`æ˜¯é˜»æŒ¡éƒ¨åˆ†ã€‚å®ƒåœæ­¢æ‰§è¡Œï¼Œç›´åˆ°æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯ï¼Œå½“æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œæˆ‘ä»¬ç»§ç»­å‰è¿›ï¼Œå°†æ¶ˆæ¯è¿½åŠ åˆ°`msg_list`ã€‚æˆ‘ä»¬å°†å¾ˆå¿«å®šä¹‰`msg_list`ï¼Œå®ƒåŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªåœ¨å±å¹•ä¸Šæ˜¾ç¤ºæ¶ˆæ¯åˆ—è¡¨çš„ Tkinter ç‰¹æ€§ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰`send()`å‡½æ•°:

```
def send(event=None):  # event is passed by binders.
    """Handles sending of messages."""
    msg = my_msg.get()
    my_msg.set("")  # Clears input field.
    client_socket.send(bytes(msg, "utf8"))
    if msg == "{quit}":
        client_socket.close()
        top.quit()
```

æˆ‘ä»¬ä½¿ç”¨`event`ä½œä¸ºå‚æ•°ï¼Œå› ä¸ºå½“ GUI ä¸Šçš„`send`æŒ‰é’®è¢«æŒ‰ä¸‹æ—¶ï¼Œå®ƒè¢« Tkinter éšå¼ä¼ é€’ã€‚`my_msg`æ˜¯ GUI ä¸Šçš„è¾“å…¥å­—æ®µï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨`msg = my_msg.get()`æå–è¦å‘é€çš„æ¶ˆæ¯ã€‚ä¹‹åï¼Œæˆ‘ä»¬æ¸…é™¤è¾“å…¥å­—æ®µï¼Œç„¶åå°†æ¶ˆæ¯å‘é€åˆ°æœåŠ¡å™¨ï¼Œæ­£å¦‚æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„ï¼ŒæœåŠ¡å™¨å°†æ­¤æ¶ˆæ¯å¹¿æ’­åˆ°æ‰€æœ‰å®¢æˆ·ç«¯(å¦‚æœå®ƒä¸æ˜¯é€€å‡ºæ¶ˆæ¯)ã€‚å¦‚æœæ˜¯é€€å‡ºæ¶ˆæ¯ï¼Œæˆ‘ä»¬å…³é—­å¥—æ¥å­—ï¼Œç„¶åå…³é—­ GUI åº”ç”¨ç¨‹åº(é€šè¿‡`top.close()`)

æˆ‘ä»¬è¿˜å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°ï¼Œå½“æˆ‘ä»¬é€‰æ‹©å…³é—­ GUI çª—å£æ—¶ï¼Œè¿™ä¸ªå‡½æ•°å°†è¢«è°ƒç”¨ã€‚è¿™æ˜¯ä¸€ç§å…³é—­å‰æ¸…ç†åŠŸèƒ½ï¼Œåº”è¯¥åœ¨ GUI å…³é—­å‰å…³é—­å¥—æ¥å­—è¿æ¥:

```
def on_closing(event=None):
    """This function is to be called when the window is closed."""
    my_msg.set("{quit}")
    send()
```

è¿™å°†è¾“å…¥å­—æ®µè®¾ç½®ä¸º`{quit}`ï¼Œç„¶åè°ƒç”¨`send()`ï¼Œå®ƒå°†æŒ‰é¢„æœŸå·¥ä½œã€‚ç°åœ¨æˆ‘ä»¬å¼€å§‹æ„å»º GUIï¼Œåœ¨ä¸»åç§°ç©ºé—´ä¸­(å³ï¼Œåœ¨ä»»ä½•å‡½æ•°ä¹‹å¤–)ã€‚æˆ‘ä»¬é¦–å…ˆå®šä¹‰é¡¶çº§å°éƒ¨ä»¶å¹¶è®¾ç½®å…¶æ ‡é¢˜:

```
top = tkinter.Tk()
top.title("Chatter")
```

ç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ¡†æ¶æ¥ä¿å­˜æ¶ˆæ¯åˆ—è¡¨ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å˜é‡ï¼Œä¸»è¦ç”¨äºå­˜å‚¨æˆ‘ä»¬ä»è¾“å…¥å­—æ®µè·å¾—çš„å€¼(æˆ‘ä»¬å°†å¾ˆå¿«å®šä¹‰å®ƒ)ã€‚æˆ‘ä»¬å°†è¯¥å˜é‡è®¾ç½®ä¸º`"Type your messages here."`æ¥æç¤ºç”¨æˆ·ä¹¦å†™ä»–ä»¬çš„æ¶ˆæ¯ã€‚ä¹‹åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ»šåŠ¨æ¡æ¥æ»šåŠ¨è¿™ä¸ªæ¶ˆæ¯æ¡†æ¶ã€‚ä»£ç å¦‚ä¸‹:

```
messages_frame = tkinter.Frame(top)
my_msg = tkinter.StringVar()  # For the messages to be sent.
my_msg.set("Type your messages here.")
scrollbar = tkinter.Scrollbar(messages_frame)  # To navigate through past messages.
```

ç°åœ¨æˆ‘ä»¬å®šä¹‰å°†å­˜å‚¨åœ¨`messages_frame`ä¸­çš„æ¶ˆæ¯åˆ—è¡¨ï¼Œç„¶åå°†æˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢åˆ›å»ºçš„æ‰€æœ‰å†…å®¹æ‰“åŒ…(åœ¨é€‚å½“çš„ä½ç½®):

```
msg_list = tkinter.Listbox(messages_frame, height=15, width=50, yscrollcommand=scrollbar.set)
scrollbar.pack(side=tkinter.RIGHT, fill=tkinter.Y)
msg_list.pack(side=tkinter.LEFT, fill=tkinter.BOTH)
msg_list.pack()messages_frame.pack()
```

ä¹‹åï¼Œæˆ‘ä»¬ä¸ºç”¨æˆ·åˆ›å»ºè¾“å…¥å­—æ®µæ¥è¾“å…¥ä»–ä»¬çš„æ¶ˆæ¯ï¼Œå¹¶å°†å…¶ç»‘å®šåˆ°ä¸Šé¢å®šä¹‰çš„å­—ç¬¦ä¸²å˜é‡ã€‚æˆ‘ä»¬è¿˜å°†å®ƒç»‘å®šåˆ°`send()`å‡½æ•°ï¼Œè¿™æ ·æ¯å½“ç”¨æˆ·æŒ‰ä¸‹ return æ—¶ï¼Œæ¶ˆæ¯å°±è¢«å‘é€åˆ°æœåŠ¡å™¨ã€‚æ¥ä¸‹æ¥ï¼Œå¦‚æœç”¨æˆ·å¸Œæœ›é€šè¿‡ç‚¹å‡»å‘é€ä»–ä»¬çš„æ¶ˆæ¯ï¼Œæˆ‘ä»¬åˆ›å»ºå‘é€æŒ‰é’®ã€‚åŒæ ·ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªæŒ‰é’®çš„ç‚¹å‡»ç»‘å®šåˆ°`send()`å‡½æ•°ã€‚æ˜¯çš„ï¼Œæˆ‘ä»¬è¿˜æ‰“åŒ…äº†æˆ‘ä»¬åˆšåˆšåˆ¶ä½œçš„æ‰€æœ‰è¿™äº›ä¸œè¥¿ã€‚æ­¤å¤–ï¼Œä¸è¦å¿˜è®°ä½¿ç”¨æ¸…ç†åŠŸèƒ½`on_closing()`ï¼Œå½“ç”¨æˆ·å¸Œæœ›å…³é—­ GUI çª—å£æ—¶ï¼Œåº”è¯¥è°ƒç”¨è¿™ä¸ªåŠŸèƒ½ã€‚æˆ‘ä»¬é€šè¿‡ä½¿ç”¨`top`çš„`protocol`æ–¹æ³•æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚è¿™æ˜¯æ‰€æœ‰è¿™äº›çš„ä»£ç :

```
entry_field = tkinter.Entry(top, textvariable=my_msg)
entry_field.bind("<Return>", send)
entry_field.pack()
send_button = tkinter.Button(top, text="Send", command=send)
send_button.pack()top.protocol("WM_DELETE_WINDOW", on_closing)
```

(å‡ ä¹)å®Œæˆäº†ã€‚æˆ‘ä»¬è¿˜æ²¡æœ‰ç¼–å†™è¿æ¥åˆ°æœåŠ¡å™¨çš„ä»£ç ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¿…é¡»å‘ç”¨æˆ·è¯¢é—®æœåŠ¡å™¨çš„åœ°å€ã€‚æˆ‘å·²ç»é€šè¿‡ç®€å•åœ°ä½¿ç”¨`input()`åšåˆ°äº†è¿™ä¸€ç‚¹ï¼Œæ‰€ä»¥åœ¨ GUI å¼€å§‹ä¹‹å‰ï¼Œç”¨æˆ·ä¼šæ”¶åˆ°ä¸€äº›å‘½ä»¤è¡Œæç¤ºï¼Œè¦æ±‚è¾“å…¥ä¸»æœºåœ°å€ã€‚è¿™å¯èƒ½æœ‰ç‚¹ä¸æ–¹ä¾¿ï¼Œæ‚¨å¯ä»¥ä¸ºæ­¤æ·»åŠ  GUIï¼Œä½†æ˜¯æˆ‘æŠŠå®ƒä½œä¸ºå®¶åº­ä½œä¸šç•™ç»™æ‚¨ğŸ™‚ã€‚è¿™æ˜¯æˆ‘çš„ä»£ç :

```
HOST = input('Enter host: ')
PORT = input('Enter port: ')if not PORT:
    PORT = 33000  # Default value.
else:
    PORT = int(PORT)BUFSIZ = 1024
ADDR = (HOST, PORT)
client_socket = socket(AF_INET, SOCK_STREAM)
client_socket.connect(ADDR)
```

ä¸€æ—¦æˆ‘ä»¬è·å¾—äº†åœ°å€å¹¶åˆ›å»ºäº†ä¸€ä¸ªå¥—æ¥å­—æ¥è¿æ¥å®ƒï¼Œæˆ‘ä»¬å°±å¯åŠ¨äº†æ¥æ”¶æ¶ˆæ¯çš„çº¿ç¨‹ï¼Œç„¶åæ˜¯ GUI åº”ç”¨ç¨‹åºçš„ä¸»å¾ªç¯:

```
receive_thread = Thread(target=receive)
receive_thread.start()
tkinter.mainloop()  # Starts GUI execution.
```

å°±æ˜¯è¿™æ ·ï¼æˆ‘ä»¬å·²ç»ç¼–å†™äº†èŠå¤©åº”ç”¨ç¨‹åºã€‚åŒæ ·ï¼Œå®Œæ•´çš„å®¢æˆ·ç«¯è„šæœ¬åœ¨ä¸‹é¢çš„è¦ç‚¹ä¸­ç»™å‡º(å¯¹äºæ™ºèƒ½æ‰‹æœºä¸Šçš„è¯»è€…ï¼Œè¿™é‡Œæ˜¯è¦ç‚¹çš„é“¾æ¥):

# æ¼”ç¤º

è¿™ç§åœ¨å¤šå°ç”µè„‘ä¸Šæµ‹è¯•çš„æ„Ÿè§‰æ£’æäº†ã€‚å½“ç„¶ï¼Œæ‚¨å¯ä»¥åœ¨åŒä¸€å°æœºå™¨ä¸Šè¿è¡ŒæœåŠ¡å™¨å’Œå®¢æˆ·æœºè¿›è¡Œæµ‹è¯•(åœ¨æ‚¨çš„å®¢æˆ·æœºä¸Šä½¿ç”¨`127.0.0.1`ä»£æ›¿`HOST`ï¼Œä½†æ˜¯çœ‹åˆ°ä¸åŒè®¡ç®—æœºä¹‹é—´çš„å®æ—¶é€šä¿¡æ„Ÿè§‰æ£’æäº†ã€‚æœåŠ¡å™¨è„šæœ¬å°†è®°å½•å“ªäº› IP åœ°å€æ­£åœ¨è®¿é—®å®ƒï¼Œå®¢æˆ·ç«¯è„šæœ¬å°†ç”Ÿæˆä¸€ä¸ª GUI(åœ¨è¯¢é—®ä¸»æœºåœ°å€å),ç±»ä¼¼äºä¸‹é¢çš„å±å¹•æˆªå›¾:

![](img/25c6bd1bc169cc28745235c0ba0042e5.png)

Client GUI

![](img/c1de89c8457f3290f18e4d70b5a3406f.png)

Another Client Connected to the Same Server

è€å®è¯´ï¼Œè€ƒè™‘åˆ°èƒŒåçš„ Python ä»£ç è¡Œæ•°ï¼ŒGUI çœ‹èµ·æ¥ä¸é”™ï¼Œä½†å¹¶ä¸å‡ºè‰²ï¼æˆ‘æŠŠè®©å®ƒçœ‹èµ·æ¥æ›´å¥½(æ›´ç›´è§‚)çš„ä»»åŠ¡ç•™ç»™äº†ä½ ï¼Œä¹Ÿè®¸å¯ä»¥åƒè„¸ä¹¦çš„ Messenger ä¸€æ ·åˆ¶ä½œä¸€ä¸ªå·¦å³èŠå¤©ç•Œé¢ã€‚ä½ ç”šè‡³å¯ä»¥ä½¿ç”¨åƒ Kivy è¿™æ ·çš„ç¬¬ä¸‰æ–¹åº“æ¥è·å¾—æ›´å¤šçš„ç¾æ„Ÿå’Œè·¨å¹³å°çš„å¯ç§»æ¤æ€§ï¼Œæˆ–è€…ä¸€ä¸ªç½‘ç»œç•Œé¢â€”â€”åœ¨è¯„è®ºä¸­å‘è¡¨ä½ çš„æƒ³æ³•ã€‚æœ€åï¼Œè°¢è°¢ä½ çš„è€å¿ƒï¼Œä¸€ç›´è¯»åˆ°æœ€åä¸€ä¸ªå­—ï¼æˆ‘èµèµä½ çš„è€å¿ƒğŸ™‚ã€‚

é¡µï¼ˆpage çš„ç¼©å†™ï¼‰s:å…³äºæˆ‘çš„å…¶ä»–é¡¹ç›®(æœ‰äº›è¾ƒå°ï¼Œæœ‰äº›å¤§å¾—å¤š)ï¼Œè¯·è®¿é—®[æˆ‘çš„ GitHub ç®€ä»‹](https://github.com/schedutron)ã€‚

æ­¤å¤–ï¼Œæˆ‘æ˜¯åšå®¢æ–°æ‰‹ï¼Œæ‰€ä»¥å»ºè®¾æ€§çš„æ‰¹è¯„ä¸ä»…éœ€è¦ï¼Œè€Œä¸”éå¸¸éœ€è¦ï¼æˆ‘ä¹äºæ¥å—æ›´å¥½çš„å†™ä½œé£æ ¼ã€æŠ€å·§å’Œæ•™å­¦æ–¹æ³•â€”â€”æ¬¢è¿åœ¨è¯„è®ºä¸­æå‡ºæ¥ã€‚

[![](img/1488dbbce2455ca450822fcdde5782b5.png)](http://buymeacoff.ee/schedutron)

Did you like the read? Medium doesnâ€™t offer partner program in my countryâ€•so I ask people to buy me coffee instead.

![](img/731acf26f5d44fdc58d99a6388fe935d.png)

## è¿™ä¸ªæ•…äº‹å‘è¡¨åœ¨ [The Startup](https://medium.com/swlh) ä¸Šï¼Œè¿™é‡Œæœ‰ 263ï¼Œ100 å¤šäººèšé›†åœ¨ä¸€èµ·é˜…è¯» Medium å…³äºåˆ›ä¸šçš„ä¸»è¦æ•…äº‹ã€‚

## è®¢é˜…æ¥æ”¶[æˆ‘ä»¬çš„å¤´æ¡](http://growthsupply.com/the-startup-newsletter/)ã€‚

![](img/731acf26f5d44fdc58d99a6388fe935d.png)