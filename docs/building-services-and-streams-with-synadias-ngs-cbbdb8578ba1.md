# 建筑服务和流与 Synadia 的 NGS

> 原文：<https://medium.com/swlh/building-services-and-streams-with-synadias-ngs-cbbdb8578ba1>

![](img/5c945b4e8bb62f820a8df506582af703.png)

很久以前，许多公司尝试在云中公开端点，这些端点可用于代理和促进网络连接。WCF 和当时所谓的 Windows Azure 的结合给了。NET 开发人员能够将端点插入到相当于基于云的交换机中，即使它是针对某种专有的协议集。这种模式被低估了，在我看来，不仅在微软领域，在其他类似产品中也是如此。

T2 NATS T3 背后的公司 Synadia 推出了一项名为 T4 NGS T5 的新服务。如果你不熟悉 NATS，你可以把它想象成一个轻量级的云原生消息系统，它可以自动形成和扩展集群，并有一个持久的、重放友好的变体，称为 [NATS 流](https://nats.io/documentation/streaming/nats-streaming-intro/)。对 NATS 题材的消费就像卡夫卡一样，订户群是以循环方式传递信息的，但也非常简单，因为你永远不需要手动进入你的 NATS 系统，去做诸如重新划分、摆弄旋钮或开关之类的事情，以扩大规模。

在我看来，NATS 是云原生消息传递的一个最好的例子，它采用了“it just works”模型。在 NATS 有大量的复杂性(和许多非常酷的计算机科学)，但是开发人员从来没有看到这一点。我们只是像使用电器一样使用它，它总是在我们身边，就像你们大多数人可能都不记得的旧拨号音。

这个拨号音现在是 NGS 的全球电话。一旦你注册了，你就可以像在 NATS 一样开始发布和订阅主题，除了你正在和 **connect.ngs.global** 对话。仅在这一个特性上，不管主机情况如何，从任何地方连接到我的经纪人的能力就足够吸引我，让我现在就想玩它。这是我从像 **Pubnub** 或 **Ably** 这样的服务中得到的东西，但是没有通常堆积在上面的所有增值(也就是厂商锁定)服务。

但这还不是我们从 NGS 那里得到的最好的部分。有了 NGS，我们可以在账户之间安全地*导入*和*导出*——使用私钥，并且不会*与 NGS 服务器共享任何敏感信息。*

在我过去的许多博客文章中，我已经展示了 RESTful 和 gRPC 服务，它们让人们在僵尸末日期间报告僵尸的位置。此外，我还发布了僵尸位置的实时信息。在我的帐户中，使用 NGS，我可以导出一个关于某个主题的服务，在该主题中我可以接收新的僵尸报告，并且我可以导出一个向所有感兴趣的人发送僵尸目击事件的流。

这是我在 NGS 的命令行界面上看到的样子:

```
╭────────────────────────────────────────────────────────╮
│                        Exports                         │
├─────────┬─────────────────────────────────────┬────────┤
│ Type    │ Subject                             │ Public │
├─────────┼─────────────────────────────────────┼────────┤
│ Service │ zombie.apocalypse.sightings.reports │ Yes    │
│ Stream  │ zombie.apocalypse.sightings         │ Yes    │
╰─────────┴─────────────────────────────────────┴────────╯
```

我已经从我的账户导出了这些东西，这实际上只是我和 NGS 之间同步的 [JWT](https://jwt.io/) 的修改。因为我已经将这个服务和流列为 public，所以任何拥有我的 long account ID(我认为这也是我在系统中的公钥)的人都可以*导入*那个东西。想要发布到我的目击报告服务的人会将`zombie.apocalypse.sightings.reports`导入到像`sightings.reports`这样的本地主题(或者他们选择的任何内容)。订阅服务主题并回复它的代码与用常规 NATS 编写的代码完全相同。

任何想收听`zombie.apocalypse.sightings`主题的人都可以通过订阅和一点点代码来实现。

没有人(希望)会在 NGS 创建僵尸启示录服务。但是，如果您的公司已经围绕支持访问数据流的付费服务建立了大量基础设施，该怎么办呢？像路透社这样的公司对专有的和难以消费的信息收费高得离谱。对于*私有*导出，导入者需要一个授权令牌来导入。这个授权令牌来自出口商，并且可以要求付款或订阅，而不经过 NGS。因为那笔交易是带外的，所以你不必担心 NGS 试图从中分一杯羹。

NGS 不知道你的客户是谁，只知道导入你数据流的系统的公钥。

如果 NFL 有一个延时统计流，人们可以用容易消费的消息订阅，会怎么样？任何拥有授权令牌的人都可以订阅`nfl.stats.(team).(whatever)`。如果天文学家目前通过老化的基础设施和网络相互发送数据，以聚合和整合来自多个地面站的数据(是的，亚马逊已经发现了这个机会)，可以在知名账户导出的知名服务上发布，会怎么样？任何拥有流导出器公钥的人都可以获得这些数据——业余天文学家、学校、大学、科学移动应用。

你能想象物联网设备、传感器和仪器发布可能会带来哪些类型的反馈吗？是的，我*将*设置我的 BBQ 吸烟者在公共出口上发布肉的温度。

通过全球消息代理安全共享流和服务的一个方面经常被忽视，那就是生产者和消费者都是*客户*。这对系统架构和设计，其次对*成本*有可衡量的影响。换句话说，即使只限于单个出站连接或在 VPN 上，您也可以生产和消费服务。

当一个公司公开一个 API 供公众使用时，他们必须建立大量的基础设施来支持它。这种支持性的基础设施比提供真正功能的核心服务要昂贵得多。有 web 应用程序防火墙、反向代理，还有数不清的附加安全层和监控系统。然后是一个可能基于 OAuth 的认证系统，现在令牌的使用和验证渗透到了公司为这个简单的 API 提供的服务中。你的柠檬水摊得不到杂货店的任何帮助，你在自己种柠檬。

这种基础设施成本和安全支出的原因很简单:如果你公开一个 API，*互联网正来到你的门前，互联网上充斥着不良行为者*。现在，这是您的城墙上的一个开口，一个易受攻击的点，通过它，数据可能被劫持，凭据可能被窃取，财务信息可能被用于盗窃，横向权限提升可能发生，等等。当安全专业人员听到有人想要公开另一个公共 API 时，这可能就像是地狱本身的开放，将新的恶魔释放到您的私有云。

但是现在让我们换个角度思考一下。您希望公开一个服务，并且您的服务响应关于特定主题的一组特定消息。你的服务现在可以是一些小代码的实例，组成一个收听 NGS 的订阅组。你的服务被安全地安置在你的城墙之内，当你作为一个客户与 NGS 交谈时，不会有漏洞产生。默认情况下是安全的。

“但是如果 NGS 倒下了呢？”你问得有理有据。好吧，如果 AWS 或者 Azure 或者 Google 倒下了呢？NGS 是一种服务，它需要可用、快速和可靠。依赖 NGS 不会让你比依赖亚马逊、谷歌或微软的云更脆弱。虚拟机、容器、集群和像 NGS 这样的服务都是新的电力。

如果你公开一项服务供所有人使用，那么 NGS 很可能会在消息流向你之前采取反 DDoS 措施。你没有打开公共交通的大门来回应这些信息。如果你正在公开一个私有(需要授权令牌)服务，那么你保证永远不会收到来自没有得到令牌的人的消息——那些令牌是由你而不是 NGS 发布的，并且它们可以在你认为合适的时候过期。

我认为值得重申的是，即使是在 NGS 云中心拥有`ssh` 访问权限的根级运营商也不能为你的私人出口授予授权令牌。

每个人都应该放下手头的工作，通过 NGS 公开他们的 API 吗？*当然不是*。然而，基于 [*nkeys*](https://github.com/nats-io/nkeys) 的客户端[安全性](https://ed25519.cr.yp.to/)的优雅与*你不必托管自己的网关*的理念相结合，使得 NGS 有可能吸引初创公司、希望降低公开服务成本的人，以及不想处理支持和保护完整 API 网关的麻烦的人。

你希望能够向你的客户运送货物，你不希望必须建造、维护和保护港口。

随着我继续探索 NGS，我会随时通知你。我还会告诉你什么时候能看到`kevin.nomnoms.bbq`流的温度读数。

[![](img/308a8d84fb9b2fab43d66c117fcc4bb4.png)](https://medium.com/swlh)

## 这篇文章发表在 [The Startup](https://medium.com/swlh) 上，这是 Medium 最大的创业刊物，拥有+400，714 名读者。

## 在此订阅接收[我们的头条新闻](http://growthsupply.com/the-startup-newsletter/)。

[![](img/b0164736ea17a63403e660de5dedf91a.png)](https://medium.com/swlh)