<html>
<head>
<title>Making an uber minimal API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">制作一个超级最小API</h1>
<blockquote>原文：<a href="https://medium.com/swlh/making-an-uber-minimal-api-f62f6189f262#2017-12-27">https://medium.com/swlh/making-an-uber-minimal-api-f62f6189f262#2017-12-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="084f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">API或“应用程序接口”是处理请求的简单方式，通常使得响应一致且易于解释。这是连接不同提供商的服务的重要组成部分，如谷歌地图应用编程接口(T1)，或T2的微服务架构(T3)，如网飞。</p><p id="6588" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最基本的形式是:</p><p id="3a3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1.用户(通常以编程方式)向主机服务器发送http请求。url参数包含用户指定的“任务”的详细信息。</p><p id="2fcc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.服务器解析url参数并执行其所需的任务。</p><p id="ebc3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.服务器以机器友好格式的输出作为响应，例如:JSON。</p><p id="3c23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是有效的，因为用户与服务交互的方法不限于任何一个程序、语言或操作系统。这使得开发人员可以将Instagram等外部服务集成到他们的应用程序中，而Instagram不必放弃对外部方可以控制的内容的控制。因此，虽然我可以提供服务，让用户喜欢Instagram上的帖子，但我不能删除他们的数据库。</p><h2 id="722d" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">议程上的第一项—发送请求的地方:</h2><p id="1fa2" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">可能是个好的开始。Flask可以用来为此创建一个非常整洁的应用程序。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="6f5c" class="je jf hi kj b fi kn ko l kp kq">from flask import Flask, request, jsonify</span><span id="ead6" class="je jf hi kj b fi kr ko l kp kq">app = Flask(__name__)</span><span id="88f9" class="je jf hi kj b fi kr ko l kp kq"><a class="ae jd" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route('/api')<br/>def API():<br/>    return process_request(request.args) #get URL arguments</span><span id="cc1e" class="je jf hi kj b fi kr ko l kp kq">if __name__ == "__main__":<br/>    app.run(debug=True)</span></pre><h2 id="d892" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">下一步——让它做点什么！</h2><p id="8e5a" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">举例来说，这个函数在给定体重、身高和可选性别的情况下计算身体质量指数。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="56de" class="je jf hi kj b fi kn ko l kp kq">def get_BMI(height, weight, sex='male'):<br/>    #Calculate BMI and BMI category:</span><span id="e845" class="je jf hi kj b fi kr ko l kp kq">    #Some maths here</span><span id="a452" class="je jf hi kj b fi kr ko l kp kq">    #return a dict which will be converted to JSON<br/>    return {"BMI": BMI, "category": category, <br/>           "data": {"height": height, "weight": weight, "sex": sex}}</span></pre><p id="3b51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它返回一个字典，可以转换成JSON以便接收方使用。process_request函数确保所需的参数存在，否则抛出错误。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="a2b0" class="je jf hi kj b fi kn ko l kp kq">def process_request(query):<br/>    if 'height' in query.keys() and 'weight' in query.keys():<br/>        if 'sex' in query.keys():<br/>            response = get_BMI(query['height'], <br/>                               query['weight'],<br/>                               sex=query['sex'])<br/>        else:<br/>            response = get_BMI(query['height'], <br/>                               query['weight'])<br/>    else:<br/>        response = {"error": "'height' and 'weight' are required"}<br/>    <br/>    return jsonify(response)</span></pre><p id="e1c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，用户可以传递一个格式为:'【http://www.hostsite.com/api?weight=67】T4&amp;性别=女性&amp;身高=172 的url，并在JSON中接收响应:</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="1fd4" class="je jf hi kj b fi kn ko l kp kq">{<br/>  "BMI": 20.74506939371804, <br/>  "category": "Healthy", <br/>  "data": {<br/>    "height": "185", <br/>    "sex": "male", <br/>    "weight": "71"<br/>  }<br/>}</span></pre><p id="fac3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">耶，你的API起作用了！</p><h2 id="658c" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">奖励回合—让它更好用:</h2><p id="b2bc" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">虽然将字符串连接成一个url，然后发送一个GET请求，然后在最终能够访问您的输出之前将响应转换成JSON，但是组织经常发布库或包来使这个过程更加用户友好。通过将机制隐藏在一个包中，API可以成为一个“黑匣子”,但这也大大降低了使用您的服务的障碍。在这种情况下，一个简单的python类就可以解决这个问题:</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="79fa" class="je jf hi kj b fi kn ko l kp kq">class Bmi(object):<br/>    def __init__(self):<br/>        self.BMI = 'no data'<br/>        self.category = 'no data'</span><span id="eeb0" class="je jf hi kj b fi kr ko l kp kq">    def get(self, weight, height, sex="male"):<br/>        import urllib2<br/>        import json</span><span id="39a9" class="je jf hi kj b fi kr ko l kp kq">        url = 'http://www.hostsite.com/api?<em class="ks">'</em>      <br/>        query =  'weight='+str(weight)<br/>        query += '&amp;height='+str(height)<br/>        query += '&amp;sex='+sex<br/>        response =  urllib2.urlopen(url + query)<br/>        data = response.read()<br/>        data = json.loads(data)<br/>        <br/>        self.BMI = data["BMI"]<br/>        self.category = data["category"]</span></pre><p id="7619" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在与API的交互更加“人性化”。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="32fb" class="je jf hi kj b fi kn ko l kp kq">from bmi_package import bmi</span><span id="5eea" class="je jf hi kj b fi kr ko l kp kq">test = bmi.Bmi()<br/>test.get(89, 185)</span><span id="f440" class="je jf hi kj b fi kr ko l kp kq">print(“Your BMI is: {0}”.format(test.BMI))<br/>print(“Based on this, you are: {0}”.format(test.category)</span></pre><figure class="ke kf kg kh fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es kt"><img src="../Images/731acf26f5d44fdc58d99a6388fe935d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6gfnVvkMRFtjVsWF7vkClA.png"/></div></div></figure><h2 id="fd41" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">这篇文章发表在<a class="ae jd" href="https://medium.com/swlh" rel="noopener"> The Startup </a>上，这是Medium最大的创业刊物，有285，454+人关注。</h2><h2 id="7945" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">订阅接收<a class="ae jd" href="http://growthsupply.com/the-startup-newsletter/" rel="noopener ugc nofollow" target="_blank">我们的头条新闻</a>。</h2><figure class="ke kf kg kh fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es kt"><img src="../Images/731acf26f5d44fdc58d99a6388fe935d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6gfnVvkMRFtjVsWF7vkClA.png"/></div></div></figure></div></div>    
</body>
</html>