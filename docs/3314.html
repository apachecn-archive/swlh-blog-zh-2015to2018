<html>
<head>
<title>ElasticSearch search suggestions best practices</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">弹性搜索搜索建议最佳实践</h1>
<blockquote>原文：<a href="https://medium.com/swlh/elasticsearch-search-suggestions-best-practices-241fa3a97108?source=collection_archive---------1-----------------------#2018-03-22">https://medium.com/swlh/elasticsearch-search-suggestions-best-practices-241fa3a97108?source=collection_archive---------1-----------------------#2018-03-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/2d4b9b404910b11c4d5b58c1835729b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-dcTolNmIyNJ0VwUrAszuA.png"/></div></div></figure><p id="85df" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">用户大量使用电子商务平台，确保产品非常容易被找到是至关重要的。</p><p id="4ea5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我一直在一家处理平台的公司工作，该平台提供对1亿件产品的访问，因此我们投入了一些时间和资源来确保我们的搜索结果和建议随着时间的推移变得更好。当然，正如你从标题中注意到的，它是基于ElasticSearch的。</p><figure class="jo jp jq jr fd ij er es paragraph-image"><a href="https://www.awin1.com/cread.php?s=2019123&amp;v=6798&amp;q=306873&amp;r=628669"><div class="er es et"><img src="../Images/afc8ccc428cfeb04dc9ecab4c919c8fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*5t1nuMSxepBLmdUPj2RfMQ.gif"/></div></a></figure><p id="a501" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们来谈谈有助于制作一个伟大的搜索模块的关键点。</p><ul class=""><li id="b54e" class="js jt hi is b it iu ix iy jb ju jf jv jj jw jn jx jy jz ka bi translated">ES标记符</li><li id="f83c" class="js jt hi is b it kb ix kc jb kd jf ke jj kf jn jx jy jz ka bi translated">多匹配是首选</li><li id="13fc" class="js jt hi is b it kb ix kc jb kd jf ke jj kf jn jx jy jz ka bi translated">模糊逻辑</li><li id="2772" class="js jt hi is b it kb ix kc jb kd jf ke jj kf jn jx jy jz ka bi translated">关联因素<br/> —词频<br/> —倒排文档频率<br/> —正常长度</li></ul><h1 id="7ed0" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">ES标记符</h1><p id="fa14" class="pw-post-body-paragraph iq ir hi is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated">正如您所知，ES中的每个字段都有一个分析器，这些分析器由标记器和过滤器组成。确保以有助于搜索变得更好的方式选择这些是至关重要的。<br/>在建议的情况下，使用<a class="ae lj" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-edgengram-tokenizer.html" rel="noopener ugc nofollow" target="_blank">边缘NGram记号化器</a>可以获得最佳结果之一。Edge <a class="ae lj" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-ngram-tokenizer.html" rel="noopener ugc nofollow" target="_blank"> NGram </a>是什么？</p><blockquote class="lk ll lm"><p id="7825" class="iq ir ln is b it iu iv iw ix iy iz ja lo jc jd je lp jg jh ji lq jk jl jm jn hb bi translated">每当edge_ngram tokenizer遇到指定字符列表中的一个字符时，它首先将文本分解成单词<br/>，然后它发出每个单词的N元语法，其中N元语法的开头锚定到单词的开头。</p></blockquote><p id="05c9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这就带来了Ngram是什么的问题？它基本上是取你的令牌中所有相邻的指定长度为N克的令牌。</p><p id="f9bb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ln">例如。3克的“快速狐狸”会给出如下的代币<br/>【Qui，uic，ick，Fox，oxe，xes】</em></p><p id="caa7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Edge Ngram将类似于Ngram，但只是从一开始就标记化。</p><p id="6445" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用Edge Ngram的好处是，当用户提供更多数据时，您的查询将匹配更好的结果。假设你输入Nik，它会匹配Nikon和Nike的令牌Nik，当然如果你输入e，它只会匹配Nike。</p><p id="81b5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要检查您的字段对于某个文档是如何标记的，您可以在ES:</p><p id="dc1d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">GET<a class="ae lj" href="http://Host/index_name/type/bead7_documentID_cd23cf/_termvectors?fields=fieldName" rel="noopener ugc nofollow" target="_blank">Host/index _ name/type/bead 7 _ documentID _ CD 23 cf/_ term vectors？fields =字段名</a></p><p id="6aa7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将向您显示您有多少令牌，以及它们是如何为某个字段名(基本上是您的搜索字段)构造的。</p><h1 id="68cf" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">多匹配是首选</h1><p id="d5bd" class="pw-post-body-paragraph iq ir hi is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated">作为一个查询，没有必须，但是“匹配”或<a class="ae lj" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-multi-match-query.html" rel="noopener ugc nofollow" target="_blank">“多匹配”</a>查询被证明是搜索场景中最好的。如果您在多个字段中查找，将使用“multi_match ”,默认的搜索类型将是“最佳匹配”,其中提供的任何一个字段匹配，文档将是匹配的。<br/>但是，假设您希望您搜索的关键字出现在组合在一起的字段组合中(即品牌/型号/系列)。在这种情况下，您应该使用类型为<a class="ae lj" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-multi-match-query.html#type-cross-fields" rel="noopener ugc nofollow" target="_blank"> cross_fields </a>的“匹配”查询进行搜索【请注意，使用cross_fields将导致您无法使用模糊逻辑，如下所述】。</p><h1 id="9909" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">模糊逻辑</h1><p id="0bc7" class="pw-post-body-paragraph iq ir hi is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated"><a class="ae lj" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html#query-dsl-match-query-fuzziness" rel="noopener ugc nofollow" target="_blank">模糊逻辑</a>是一个使用起来非常简单的特性，但是它会对你的搜索产生巨大的影响。</p><p id="bdf2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is lr">让我们用一个例子来展示一下用法</strong> : <br/>如果用户在平台中搜索<strong class="is lr">‘Nile’</strong>，ElasticSearch肯定知道他指的是‘Nike’，但是发生了打字或者一只猫跳到了键盘上。耐克当然会匹配。酷，对！<br/>但请注意，这不能用于所有类型的匹配查询搜索(例如cross_fields)，但大多数都是这样。</p><h1 id="2c27" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">相关性因素</h1><p id="7470" class="pw-post-body-paragraph iq ir hi is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated">ES对什么影响相关性有一些理论(因为搜索引擎不是他们做的，而是Lucene的)。</p><p id="0e8c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当你制作你的结构时，要考虑3个主要因素</p><h2 id="4882" class="ls kh hi bd ki lt lu lv km lw lx ly kq jb lz ma ku jf mb mc ky jj md me lc mf bi translated">检索词频率</h2><p id="282a" class="pw-post-body-paragraph iq ir hi is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated">有多少个标记包含在该文档中查找的单词。并且这个值会影响得到的相关性，如下所示:<br/> if(t in d) = √frequency <br/>因此，如果你的标记没有被正确标记，你可能会在完美匹配中遇到问题。<br/>例如。假设你的分词器正在这样做:<br/> a/b/c = &gt; a，a/b，a/b/c <br/>这将导致重复3次，这使得它的权重比匹配只有“a”作为值的文档的权重更高(这是一个完美的匹配)。</p><h2 id="7411" class="ls kh hi bd ki lt lu lv km lw lx ly kq jb lz ma ku jf mb mc ky jj md me lc mf bi translated">逆文档频率</h2><p id="c9d9" class="pw-post-body-paragraph iq ir hi is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated">对于这一部分，我只能说，你应该知道你的总文档中某个关键词越多，这个关键词就失去了价值。这是在ES/Lucene中完成的，以确保不必要的停用词如“the”、“in”不会被考虑在内。因此，在构建数据时要牢记这一点。</p><h2 id="7db0" class="ls kh hi bd ki lt lu lv km lw lx ly kq jb lz ma ku jf mb mc ky jj md me lc mf bi translated">标准长度</h2><p id="fddf" class="pw-post-body-paragraph iq ir hi is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated">这基本上是您的字段值的长度，如果您真的不太在意这个优先级(这又会影响完美匹配)，那么禁用它，您会注意到内存的显著改善，因为这为每个文档占用了一个字节。但是，禁用搜索功能是不明智的。如果你有一个日志索引，当你的字段被分析时，你一定要禁用它，因为在日志索引中你只关心找到一个错误代码，但是你不关心其他的东西，而且你会节省大量的内存。</p><h2 id="4dc6" class="ls kh hi bd ki lt lu lv km lw lx ly kq jb lz ma ku jf mb mc ky jj md me lc mf bi translated">如何检查什么影响什么:</h2><p id="1445" class="pw-post-body-paragraph iq ir hi is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated">要检查是什么影响了您的查询不够相关，请在您的查询中使用[ <a class="ae lj" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-explain.html" rel="noopener ugc nofollow" target="_blank"> explain </a> ]来查看TF、IDF和其他因素以及它们的值。</p><p id="0b0f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它会给你类似这样的东西:</p><p id="0617" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">前任。耐克的比赛</p><figure class="jo jp jq jr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/2c373c95bfafd4ba94b0cf90a2f7f5ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iicLpB-LmIc53zRpllqa3g.png"/></div></div></figure><h1 id="e70f" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">结论</h1><p id="fc55" class="pw-post-body-paragraph iq ir hi is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated">你真应该买一个<a class="ae lj" href="http://tidd.ly/8f345c71" rel="noopener ugc nofollow" target="_blank">程序员笔记本电脑/工作站贴纸</a>，它们太棒了😍。</p><p id="09c5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们还得出结论，搜索和建议是需要讨论的非常大的主题，这篇文章肯定没有涵盖这个主题的1%。但是，根据我的经验，这些关键点是非常可靠的搜索基础。<br/>希望这对读者有用。</p><figure class="jo jp jq jr fd ij er es paragraph-image"><a href="https://www.awin1.com/cread.php?s=2019123&amp;v=6798&amp;q=306873&amp;r=628669"><div class="er es et"><img src="../Images/afc8ccc428cfeb04dc9ecab4c919c8fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*5t1nuMSxepBLmdUPj2RfMQ.gif"/></div></a></figure></div><div class="ab cl mh mi gp mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="hb hc hd he hf"><figure class="jo jp jq jr fd ij er es paragraph-image"><a href="https://medium.com/swlh"><div class="er es mo"><img src="../Images/308a8d84fb9b2fab43d66c117fcc4bb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YqDjlKFwScoQYQ62DWEdig.png"/></div></a></figure><h2 id="48f8" class="ls kh hi bd ki lt lu lv km lw lx ly kq jb lz ma ku jf mb mc ky jj md me lc mf bi translated">这篇文章发表在<a class="ae lj" href="https://medium.com/swlh" rel="noopener"> The Startup </a>上，这是Medium最大的创业刊物，有308，589人关注。</h2><h2 id="24b8" class="ls kh hi bd ki lt lu lv km lw lx ly kq jb lz ma ku jf mb mc ky jj md me lc mf bi translated">订阅接收<a class="ae lj" href="http://growthsupply.com/the-startup-newsletter/" rel="noopener ugc nofollow" target="_blank">我们的头条新闻</a>。</h2><figure class="jo jp jq jr fd ij er es paragraph-image"><a href="https://medium.com/swlh"><div class="er es mo"><img src="../Images/b0164736ea17a63403e660de5dedf91a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ouK9XR4xuNWtCes-TIUNAw.png"/></div></a></figure></div></div>    
</body>
</html>