<html>
<head>
<title>How Should You Use Elasticsearch In Ruby On Rails App?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Ruby On Rails App中应该如何使用Elasticsearch？</h1>
<blockquote>原文：<a href="https://medium.com/swlh/how-should-you-use-elasticsearch-in-ruby-on-rails-app-3d8d6997cc75?source=collection_archive---------3-----------------------#2017-12-11">https://medium.com/swlh/how-should-you-use-elasticsearch-in-ruby-on-rails-app-3d8d6997cc75?source=collection_archive---------3-----------------------#2017-12-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/0e4d8ae7837c8ced6a9d87b9393344db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mQHZWQzU5RzvoJhn0lJLaQ.jpeg"/></div></div></figure><p id="9507" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi jo translated">lasticsearch是一个强大而灵活的开源、分布式、实时搜索和分析引擎。这是搜索技术的黄金标准。它构建在Apache Lucene库之上，为查询和索引大量结构化数据提供了一个健壮的RESTful HTTP接口。开箱即用，它提供了一个高效，可扩展和强大的搜索。Elasticsearch的一个主要特点是，它分布在它的核心，这意味着为了冗余或性能，你可以很容易地横向扩展它。</p><p id="0a8f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Elasticsearch也可以用作数据存储引擎，但它有一些<strong class="is jx">缺点</strong>:</p><ul class=""><li id="b12f" class="jy jz hi is b it iu ix iy jb ka jf kb jj kc jn kd ke kf kg bi translated">在Elasticsearch中，数据是“近乎实时”可用的。也就是说，当你对一篇文章提交评论并刷新页面时，它可能不会显示出来，因为索引仍在更新。</li><li id="3741" class="jy jz hi is b it kh ix ki jb kj jf kk jj kl jn kd ke kf kg bi translated">Elasticsearch没有给出任何门禁系统或者内部安全。您将需要一个防火墙来保护ES免受外部访问。</li><li id="1e93" class="jy jz hi is b it kh ix ki jb kj jf kk jj kl jn kd ke kf kg bi translated">对数据库端高级计算的支持也是有限的。</li><li id="97cb" class="jy jz hi is b it kh ix ki jb kj jf kk jj kl jn kd ke kf kg bi translated">尽管ES是分布式的且相对稳定，但备份并不像其他数据存储解决方案那样优先考虑。如果Elasticsearch是您的主要数据存储，您可能需要重新考虑一下。</li></ul><h1 id="a4bf" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">关于Elasticsearch你需要知道的:</h1><p id="62cd" class="pw-post-body-paragraph iq ir hi is b it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn hb bi translated">Elasticsearch是面向文档的。它使用文档来存储它的整个对象。这些文件被编入索引以便于检索。这里，文档属于一个类型，而类型属于一个索引。每一个ES索引都可以被分割成许多称为碎片的部分。当您需要的存储卷超出单个节点或服务器的能力时，这就完成了。它还可以通过跨分片并行化操作来提高ES集群的性能。</p><p id="453b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦创建了索引，主碎片的数量就固定了。这基本上定义了索引中存储的最大数据量，因为每个节点都受到CPU、RAM和I/o数量的限制，至少可以容纳一个碎片。您只能在创建索引后更改副本碎片的数量，尽管这只会影响集群的吞吐量，而不会影响实际的数据存储能力。</p><figure class="lq lr ls lt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/c28fe7362bac5e17d863f750c36aeb69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GfbzGoGVq0mcPXcYHDRdpA.png"/></div></div></figure><h1 id="6443" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">你真的需要Elasticsearch吗？</h1><p id="7575" class="pw-post-body-paragraph iq ir hi is b it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn hb bi translated">通常，您试图解决的问题可以通过一些高级的SQL查询和一些新的索引更容易地解决。通常在两种情况下使用Elasticsearch是有意义的。</p><p id="ab7a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">全文搜索是Elasticsearch的初衷，也是为了对复杂数据进行反规范化。通常情况下，我们会尝试将我们的数据标准化，以匹配我们的模型。但是当查询规范化的表时，我们可能会遇到一些性能问题。使用像Elasticsearch这样的搜索技术，可以更快地对数据进行反规范化和检索。</p><p id="d106" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您确实需要Elasticsearch，下面的说明应该可以帮助您开始:</p><ul class=""><li id="b74b" class="jy jz hi is b it iu ix iy jb ka jf kb jj kc jn kd ke kf kg bi translated">遵循Elasticsearch提供的安装说明。</li><li id="db57" class="jy jz hi is b it kh ix ki jb kj jf kk jj kl jn kd ke kf kg bi translated">如果这恰好是您添加到项目中的第一个Elasticsearch索引，那么您必须安装elasticsearch-rails和elasticsearch-model gems。</li><li id="fc79" class="jy jz hi is b it kh ix ki jb kj jf kk jj kl jn kd ke kf kg bi translated">要配置gem，您需要一个初始化文件来设置模型使用的Elasticsearch客户端。</li><li id="0a73" class="jy jz hi is b it kh ix ki jb kj jf kk jj kl jn kd ke kf kg bi translated">一旦<a class="ae lu" href="https://www.cognitiveclouds.com/custom-software-development-services/ruby-on-rails-development-company" rel="noopener ugc nofollow" target="_blank">轨道项目</a>准备就绪，就在模型上建立索引。</li><li id="282a" class="jy jz hi is b it kh ix ki jb kj jf kk jj kl jn kd ke kf kg bi translated">建立索引的第一步显然是在您想要搜索的模型上配置索引。然而，推荐的方法是将索引逻辑封装到一个ActiveSupport:: Concern中，它可以包含在您的模型中。请记住，这里您只需要对需要搜索索引的字段/关系进行索引。索引的字段越多，Elasticsearch中的索引就越大。这意味着你需要更强大的硬件，而且索引越大，搜索查询的时间就越长。接下来，决定有多少碎片将保存数据。如果预计数据量不大，建议使用一个主碎片。</li><li id="c5c0" class="jy jz hi is b it kh ix ki jb kj jf kk jj kl jn kd ke kf kg bi translated">一旦定义了索引，就该开始查询了。记住，在开始查询之前，您需要索引一些数据。elasticsearch-model gem为RESTful Elasticsearch API提供了一个强大的搜索接口。您可以使用Elasticsearch文档中提到的任何API端点进行查询。</li><li id="cce9" class="jy jz hi is b it kh ix ki jb kj jf kk jj kl jn kd ke kf kg bi translated">只要包含elastic search::Model::Callbacks，就可以设置自动回调。自定义回调很容易定义，并且您可以控制何时真正希望更新索引。</li><li id="da66" class="jy jz hi is b it kh ix ki jb kj jf kk jj kl jn kd ke kf kg bi translated">最后，花时间写一个更快的导入。内置导入效率不是很高。</li></ul><blockquote class="lv"><p id="4ad5" class="lw lx hi hj ly lz ma mb mc md me jn dx translated"><em class="mf">这并不是在你的项目中使用elasticsearch-rails gem的唯一方法，但是这种方法对我们来说非常有效。</em></p></blockquote><h1 id="70a6" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx mg kz la lb mh ld le lf mi lh li lj bi translated">耐嚼宝石</h1><p id="fa93" class="pw-post-body-paragraph iq ir hi is b it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn hb bi translated">弹性搜索模型宝石的替代品是耐嚼宝石。它增加了Elasticsearch-Ruby客户端，使其更强大，并使我们与 <a class="ae lu" href="https://www.zibtek.com/Ruby-on-Rails-Development-Company" rel="noopener ugc nofollow" target="_blank"> <em class="mj"> Rails </em> </a> <em class="mj">更紧密地集成。比较好用，你肯定会喜欢API这样的ActiveRecord。我们选择了elasticsearch-model gem，因为它让我们可以直接访问elasticsearch的“低级”普通查询，因此我们可以轻松地定制我们的查询。</em></p></div><div class="ab cl mk ml gp mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="hb hc hd he hf"><p id="3554" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="mj">原载于</em><a class="ae lu" href="https://www.cognitiveclouds.com/insights/how-should-you-use-elasticsearch-in-ruby-on-rails-app/" rel="noopener ugc nofollow" target="_blank"><strong class="is jx"><em class="mj">cognitive clouds博客</em></strong></a><strong class="is jx"><em class="mj">:</em></strong><em class="mj"/><strong class="is jx"><em class="mj"/></strong><a class="ae lu" href="https://www.cognitiveclouds.com/custom-software-development-services/ruby-on-rails-development-company" rel="noopener ugc nofollow" target="_blank"><em class="mj">ruby on rails开发公司</em> </a></p><figure class="lq lr ls lt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mr"><img src="../Images/731acf26f5d44fdc58d99a6388fe935d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6gfnVvkMRFtjVsWF7vkClA.png"/></div></div></figure><h2 id="fd41" class="ms kn hi bd ko mt mu mv ks mw mx my kw jb mz na la jf nb nc le jj nd ne li nf bi translated">这篇文章发表在<a class="ae lu" href="https://medium.com/swlh" rel="noopener"> The Startup </a>上，这是Medium最大的创业刊物，有300，118+人关注。</h2><h2 id="7945" class="ms kn hi bd ko mt mu mv ks mw mx my kw jb mz na la jf nb nc le jj nd ne li nf bi translated">在这里订阅接收<a class="ae lu" href="http://growthsupply.com/the-startup-newsletter/" rel="noopener ugc nofollow" target="_blank">我们的头条新闻</a>。</h2><figure class="lq lr ls lt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mr"><img src="../Images/731acf26f5d44fdc58d99a6388fe935d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6gfnVvkMRFtjVsWF7vkClA.png"/></div></div></figure></div></div>    
</body>
</html>