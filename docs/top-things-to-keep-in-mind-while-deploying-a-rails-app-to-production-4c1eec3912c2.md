# 在将 Rails 应用程序部署到生产环境时，需要记住的首要事项是什么？

> 原文：<https://medium.com/swlh/top-things-to-keep-in-mind-while-deploying-a-rails-app-to-production-4c1eec3912c2>

![](img/40900fa50179dccb1fae2ea5056be5d7.png)

Top things to keep in mind while deploying a Rails app to production?

无论您的开发人员选择哪个平台进行部署，除了您将为所选环境遵循的步骤之外，还有一些通用的清单需要遵循。从一开始，你就必须做出以下选择:

*   **在哪里部署和选择 web 服务器**:您必须根据成本考虑、补丁和升级的健全性检查来做出决定。对于服务器，你会发现普遍的选择是乘客或彪马。必须考虑 RAM 的使用情况，可以使用定制安装的软件进行监控。对指标、自动警报、错误测量和详细诊断进行检查，以识别源代码中的问题。请记住，您选择使用的 Rail 版本应该保证长期支持。
*   **选择合适的数据库和内容交付网络**:你对数据库的选择是一种权衡，最终可能会增加 RAM 的大小。Rails 函数允许以简单的方式批量获取小器械包进行处理，并且可以随时投入使用。您可以通过使用内容交付网络来提高数量。检查图像上传，因为像 Heroku 这样的特定环境可以施加超时限制。出于安全考虑，有必要取消对多余员工的访问权。此外，考虑到故障不可避免，一旦 Rails 上线，一定要指定一名有能力的员工负责，并配备适当的钥匙。

## 基本步骤:

*   确保对可维护性、可读性、快速开发和重复进行检查。
*   名称服务器需要更改，主交换机记录需要更正，以便重定向收到的邮件。
*   应提供适当的数据库索引。虽然它可以降低插入查询的速度，但是它可以提高读取查询的性能。
*   需要识别和检查用户。

## 安全性和备份:

*   您必须为生产数据的定期备份建立一个计划的备份机制。备份应该包括代码、数据和用户上传的数据。
*   明文不应该是存储用户密码的形式。用户提交的信息不应局限于数据库查询。
*   在控制器中设置防止伪造的保护措施。真实性标记必须出现在所有提交的表单上。
*   防止用户帐户 ID 被覆盖。
*   应维护用于灾难管理的有限回滚版本，而不是跨遗留系统。
*   验证用户提交文件的内容类型和扩展名，并保护上传目录不运行脚本
*   如果应用程序发生了不好的情况，将建立一个通知机制。可以使用托管服务或通知程序插件选项。
*   机密数据，如信用卡信息、个人数据等。应该防止泄漏。此类机密信息不应写入日志文件。

## 操作检查:

*   识别慢速查询日志以进行优化。
*   该应用程序应该允许定期重复的工作，如邮件和通讯。这可以通过 CRON 或类似的程序来完成
*   将进行检查以确保所有流程，如 Mongrel、Apache 等。，应用程序所需的。这可以通过标准的监控工具来完成。
*   随着时间的推移，日志文件的大小会不断增加，较大的文件需要更多的时间来打开和下载。为应用程序建立一个日志循环设置。
*   应该包括一个计划任务来消除过时的会话。
*   设置资产主机以减少加载时间。
*   控制器应该包含请求处理和响应相关的逻辑。
*   应用程序需要从一开始就国际化。这最好与开发一起完成。为其他语言定制应该很容易。
*   确保版本控制系统检查已经完成
*   Rails 框架附带了内置的代码重载机制。每当你引用一个不存在的类时，如果你安装了一个钩子，相同的钩子代码将试图定位并加载与该类相关的文件。你需要检查这个。

# 关于所选环境的具体注意事项将包括:

## Heroku:

Heroku 将使你的开发者更容易配置。检查至少应该包括包安装、加密和管理机密、初始化、监控、Nginx 配置、SSH 密钥、SSL 配置、Capistrano 配置、日志记录和安全性。

## 乘客:

客运易于使用，将使您的部署过程简单和可伸缩性。启动服务器、安装 Ruby runtime、安装 passenger、设置生产服务器、创建 UNIX 用户帐户和设置权限、部署应用程序、确保更新和与 web 服务器的集成是最基本的。乘客可以产生多个应用程序。在乘客身上展开时，一些额外的考虑事项是:

*   性能:运行的进程越多，CPU 内核的利用率就越高，直到达到硬件极限。你会发现 Standalone 和 Nginx 比 Apache 稍快。
*   I/O 并发性:运行的进程越多，可用的 I/O 并发性就越大。这使得你的应用程序性能更好。
*   稳定性:See Passenger 重新启动崩溃的进程，而其他进程不受影响，并且可以接管，以防您的应用程序进程崩溃。
*   控制问题:许多问题，比如卡住或内存泄漏，都可以通过重启出现问题的进程来控制。
*   对于可用性:独立在开发过程中更容易，但 Nginx 和 Apache 在生产过程中更容易。
*   多租户:Nginx 和 Apache 集成模式可以同时托管多个应用。
*   灵活性和控制:如果您需要深入控制系统的每个方面，或者如果您的生产集群具有高级架构，那么独立将是您在生产期间的最佳选择。

## Ubuntu:

你必须创建一个虚拟私人服务器，选择一个图像，选择大小，选择地区，然后继续安装 Ruby，Nginx，MySQL 和 PostgreSQL 数据库设置，Capistrano 设置，添加 Nginx 主机并连接数据库。

## Capistrano 上的自动化:

Capistrano 是一个应用程序发布自动化工具。当您发布 web 应用程序的新版本时，您将不得不执行一系列操作，比如运行一个命令来安装您的 gem 包，将您的应用程序代码上传到您的服务器，重新启动进程，等等。Capistrano 让您的开发人员自动化所有这些操作。

> *服务器 Capistrano，不会为您提供 HTTP 事务处理。这意味着它不会取代 web 服务器或应用服务器。相反，你必须和他们一起使用 Capistrano。例如，Capistrano 脚本附带了在新的应用程序版本发布后重启应用服务器的指令。*

*最初发表于 CognitiveClouds 的产品洞察博客:Top* [***Ruby on Rails 开发公司***](https://www.cognitiveclouds.com/custom-software-development-services/ruby-on-rails-development-company)

![](img/731acf26f5d44fdc58d99a6388fe935d.png)

## 这篇文章发表在 [The Startup](https://medium.com/swlh) 上，这是 Medium 最大的创业刊物，拥有 299，352+人关注。

## 在此订阅接收[我们的头条新闻](http://growthsupply.com/the-startup-newsletter/)。

![](img/731acf26f5d44fdc58d99a6388fe935d.png)