<html>
<head>
<title>Snapchat’s Filters: How computer vision recognizes your face</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Snapchat的过滤器:计算机视觉如何识别你的脸</h1>
<blockquote>原文：<a href="https://medium.com/swlh/snapchats-filters-how-computer-vision-recognizes-your-face-9ce536206fa7?source=collection_archive---------1-----------------------#2018-02-07">https://medium.com/swlh/snapchats-filters-how-computer-vision-recognizes-your-face-9ce536206fa7?source=collection_archive---------1-----------------------#2018-02-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/8c5ddd90661f173ddf10116f6622a45e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*58eDHIFYj96AXST7Jz4nCw.jpeg"/></div></div></figure><div class=""/><div class=""><h2 id="5309" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh dx translated"><strong class="ak">个性化面部识别背后的科学</strong></h2></div><p id="9e50" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">在那些无聊的时候，当你玩着<a class="ae ke" href="https://www.snapchat.com/" rel="noopener ugc nofollow" target="_blank"> Snapchat </a>的滤镜——伸出舌头，模仿你的特征，想办法让花冠正好戴在你的头上——你肯定有过这样的时刻，你想知道在技术层面上发生了什么——Snapchat是如何设法让你的脸与动画匹配的？</p><p id="f3de" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">在网上搜索了两周之后，我很感激终于能够一窥幕后的真相。原来产品是计算机视觉应用的一个实例，是各种面部识别软件背后的主要燃料。</p><h2 id="bf01" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated"><strong class="ak">技术</strong></h2><p id="1fc1" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">这项技术来自一家乌克兰初创公司<strong class="jk lf"> Looksery </strong>，这是一款允许用户在视频聊天和拍照时修改面部特征的应用。Snapchat于2015年9月以1.5亿美元收购了这家总部位于Odesa的变脸初创公司。据报道，这是乌克兰历史上最大的技术收购。</p><figure class="lh li lj lk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lg"><img src="../Images/1e3605b557fd1415b29ae26c2a52a4a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*weCroGAyHfoZDK1h7ZOoDA.png"/></div></div></figure><p id="1fed" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">他们的<a class="ae ke" href="http://www.supreality.com/2016/04/13/snapchats-augmented-reality/#comment-1138" rel="noopener ugc nofollow" target="_blank">增强现实过滤器</a>进入了巨大且快速增长的计算机视觉领域。<strong class="jk lf">计算机视觉</strong>可以被认为是计算机图形学的直接对立面。计算机图形学试图从3D模型中产生图像模型，而计算机视觉试图从图像数据中创建3D空间。计算机视觉开始越来越多地应用于我们的社会。这就是你如何扫描你的支票，并从行中提取数据。你可以用手机存支票。这就是脸书如何知道谁在你的照片中，自动驾驶汽车如何避免碾过人，以及你如何给自己一个狡猾的鼻子。</p><h2 id="d044" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated"><strong class="ak">Snapchat过滤器如何工作</strong></h2><p id="6502" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">Looksery保持他们的工程更加保密，但每个人都可以在线访问他们的专利。Snapchat滤镜使用的计算机视觉的特定区域被称为<strong class="jk lf">图像处理</strong>。图像处理是通过对所提供图片上的每个单独像素执行数学运算来转换图像。</p><p id="0ed6" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated"><strong class="jk lf"> 1 —面部检测:</strong></p><p id="462e" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">第一步是这样工作的:<em class="ll">给定一幅输入图像或视频帧，找出所有当前人脸，输出其包围盒(即矩形坐标形式:</em> <strong class="jk lf"> <em class="ll"> X </em> </strong> <em class="ll">，</em> <strong class="jk lf"> <em class="ll"> Y </em> </strong> <em class="ll">，</em> <strong class="jk lf"> <em class="ll">宽度</em></strong><em class="ll">&amp;</em><strong class="jk lf"><em class="ll">高度</em> </strong> <em class="ll">)。</em></p><p id="86d9" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">自21世纪初以来，人脸检测一直是一个得到解决的问题，但面临一些挑战，包括检测<a class="ae ke" href="https://arxiv.org/pdf/1612.04402.pdf" rel="noopener ugc nofollow" target="_blank">微小</a>、<a class="ae ke" href="https://arxiv.org/pdf/1603.09364.pdf" rel="noopener ugc nofollow" target="_blank">部分</a> &amp; <a class="ae ke" href="http://ieeexplore.ieee.org/abstract/document/5459421/" rel="noopener ugc nofollow" target="_blank">非正面</a>人脸。最广泛使用的技术是方向梯度直方图(简称为<a class="ae ke" href="https://en.wikipedia.org/wiki/Histogram_of_oriented_gradients" rel="noopener ugc nofollow" target="_blank"> HOG </a>)和支持向量机(简称为<a class="ae ke" href="https://en.wikipedia.org/wiki/Support_vector_machine" rel="noopener ugc nofollow" target="_blank"> SVM </a>)的组合，其在给出高质量图像的情况下实现了一般到相对较好的检测率，但是这种方法至少在<strong class="jk lf"> CPU </strong>上不能进行实时检测。</p><figure class="lh li lj lk fd hk er es paragraph-image"><div class="er es lm"><img src="../Images/d16b3e3b2902e5be3bcccc80b9f066ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*2-ezOTxM6wRtRG2FJ3eCbw.jpeg"/></div></figure><p id="2708" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated"><em class="ll">下面是猪/SVM探测器的工作原理</em>:</p><p id="25b7" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">给定一个输入图像，计算该图像的<a class="ae ke" href="https://en.wikipedia.org/wiki/Pyramid_%28image_processing%29" rel="noopener ugc nofollow" target="_blank">金字塔</a>表示，它是原始图像的多尺度缩小版本的金字塔。对于金字塔上的每个条目，使用滑动窗口方法。滑动窗口的概念非常简单。通过以恒定的步长在图像上循环，以不同的比例提取通常大小为64×128像素的小图像碎片。对于每个小块，算法会决定它是否包含人脸。为当前窗口计算HOG，并将其传递给SVM分类器(线性或非线性),以进行决策(即，是否人脸)。完成金字塔后，通常会进行一个<a class="ae ke" href="http://users.ecs.soton.ac.uk/msn/book/new_demo/nonmax/" rel="noopener ugc nofollow" target="_blank">非最大值抑制</a>(简称NMS)操作，以丢弃堆叠的矩形。你可以在这里阅读更多关于猪和SVM组合的内容。</p><p id="2fe6" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated"><strong class="jk lf"> 2 —面部标志:</strong></p><p id="fe7c" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">这是我们分析阶段的下一步，工作如下:<em class="ll">对于每个检测到的面部，输出该面部的每个成员或面部特征的局部区域坐标。这包括眼睛、骨骼、嘴唇、鼻子、嘴巴……坐标通常以点的形式(</em> <strong class="jk lf"> <em class="ll"> X </em> </strong> <em class="ll">、</em> <strong class="jk lf"> <em class="ll"> Y </em> </strong> <em class="ll">)。</em></p><p id="5928" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">提取面部标志对于给定边界框(即带有目标面部的裁剪图像)的CPU来说是相对廉价的操作，但是对于程序员来说很难实现，除非使用一些<em class="ll">不太快的</em>机器学习技术，例如训练&amp;运行分类器。</p><figure class="lh li lj lk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ln"><img src="../Images/4d736a6c881ca7f8e7197742c8864dba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vRXrawyNUUa_mLYR1Vf-dQ.jpeg"/></div></div></figure><p id="ebea" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">你可以找到更多关于提取面部标志的信息<a class="ae ke" href="http://www.learnopencv.com/facial-landmark-detection/" rel="noopener ugc nofollow" target="_blank">这里</a>或者这个PDF: <a class="ae ke" href="http://www.cv-foundation.org/openaccess/content_cvpr_2014/papers/Kazemi_One_Millisecond_Face_2014_CVPR_paper.pdf" rel="noopener ugc nofollow" target="_blank">用回归树集合进行一毫秒面部对齐</a>。在一些明显有用的情况下，面部检测和界标提取被组合成单个操作。</p><p id="eac2" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated"><strong class="jk lf"> 3 —图像处理</strong></p><p id="c391" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">现在面部已经被检测到，Snapchat可以使用图像处理将特征应用到整张脸上。然而，他们选择了更进一步，他们想找到你的面部特征。这是在<strong class="jk lf">活动形状模型</strong>的帮助下完成的。</p><p id="651a" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">活动形状模型是已经通过在数百到数千幅图像上手动标记面部特征的边界来训练的面部模型。通过机器学习，创建了一个“平均脸”，并将其与提供的图像对齐。当然，这个平均脸并不完全符合用户的脸(我们都有不同的脸)，所以在拟合脸之后，检查“平均脸”边缘周围的像素，以寻找阴影的差异。因为算法所经历的训练，(机器学习过程)，它有一个特定面部特征应该是什么样子的基本框架，所以它在给定的图像中寻找类似的模式。即使一些初始变化是错误的，通过考虑它已经固定的其他点的位置，该算法将纠正它在认为你面部某些方面的位置方面犯下的错误。然后，模型会调整并创建一个网格(一个可以随着面部移动和缩放的3D模型)。</p><figure class="lh li lj lk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lg"><img src="../Images/e29f75a4e1e049ff1d10ab1ec880cfde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4xU_GUpNdFXLnrtMxCJOIg.jpeg"/></div></div></figure><p id="3983" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">当你在选择滤镜之前看到白色网络时，整个面部/特征识别过程就完成了。然后，过滤器通过增强它们或在它们上面添加一些东西来扭曲所提供的面部的某些区域。</p><h2 id="e607" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated"><strong class="ak">从滤镜到换脸</strong></h2><p id="1f73" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">几个月前，Snapchat的更新版本具有与朋友交换面孔的功能，无论是实时还是通过从你的图库中访问一些面孔。注意脸型是如何可见的，这就是统计模型所在的位置。它有助于Snapchat快速对齐您和您朋友的面部，并交换功能。</p><p id="a905" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">找到所有特征后，应用程序会沿着你的脸创建一个网格，一帧一帧地粘在每个点上。现在可以按照Snapchat的感觉编辑和修改这个网格。</p><figure class="lh li lj lk fd hk er es paragraph-image"><div class="er es lo"><img src="../Images/49998eecd41cf423520cec40d9aff7e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*YzfgVRCIUjfTUYE23VH9Ag.jpeg"/></div></figure><p id="1303" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">一些镜头通过让你扬起眉毛或张开嘴巴来做更多的事情。这也很容易思考，但是它需要更多的算法来暗示。</p><ul class=""><li id="0230" class="lp lq ht jk b jl jm jo jp jr lr jv ls jz lt kd lu lv lw lx bi translated">嘴巴里面比较黑，相对来说。所以这就暴露了嘴的张开。</li><li id="6ff3" class="lp lq ht jk b jl ly jo lz jr ma jv mb jz mc kd lu lv lw lx bi translated">当计算出用户抬起了眉毛时，眉毛相对于其他面部特征的变化被考虑在内。</li></ul><p id="60f8" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">如前所述，这项技术并不新鲜。但是在移动平台上实时执行所有这些过程需要大量的处理能力和一些复杂的算法。这就是为什么Snapchat认为支付1.5亿美元收购Looksery比仅仅建立其平台更好。</p><h2 id="2b00" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated"><strong class="ak">结论</strong></h2><p id="74b2" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">我希望这是有益的，并像它一样激起你的好奇心。现在，我将更深入地探索Snapchat过滤器，测试我最喜欢的面部镜头，了解并欣赏幕后进行的所有计算机视觉。</p><p id="6100" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi">— —</p><p id="8aa2" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated"><em class="ll">如果你喜欢这首曲子，我希望你能按下拍手按钮</em>👏<em class="ll">这样别人可能会偶然发现它。你可以在</em> <a class="ae ke" href="https://github.com/khanhnamle1994" rel="noopener ugc nofollow" target="_blank"> <em class="ll"> GitHub </em> </a> <em class="ll">上找到我自己的代码，在</em><a class="ae ke" href="https://jameskle.com/" rel="noopener ugc nofollow" target="_blank"><em class="ll">https://jameskle.com/</em></a><em class="ll">上找到更多我的写作和项目。也可以在</em> <a class="ae ke" href="https://twitter.com/@james_aka_yale" rel="noopener ugc nofollow" target="_blank"> <em class="ll">推特</em></a><em class="ll"/><a class="ae ke" href="mailto:khanhle.1013@gmail.com" rel="noopener ugc nofollow" target="_blank"><em class="ll">上关注我直接发邮件给我</em> </a> <em class="ll">或者</em> <a class="ae ke" href="http://www.linkedin.com/in/khanhnamle94" rel="noopener ugc nofollow" target="_blank"> <em class="ll">在LinkedIn上找我</em> </a> <em class="ll">。</em></p><p id="e9a5" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated"><strong class="jk lf">其他资源:</strong></p><ul class=""><li id="27df" class="lp lq ht jk b jl jm jo jp jr lr jv ls jz lt kd lu lv lw lx bi translated"><a class="ae ke" href="https://www.technobyte.org/2016/11/snapchat-filters-work/" rel="noopener ugc nofollow" target="_blank"><em class="ll">Snapchat滤镜如何工作</em></a><em class="ll">【Technobyte】</em></li><li id="48c1" class="lp lq ht jk b jl ly jo lz jr ma jv mb jz mc kd lu lv lw lx bi translated"><a class="ae ke" href="http://techundred.com/how-snapchat-filter-work/" rel="noopener ugc nofollow" target="_blank"><em class="ll">Snapchat滤镜如何工作——幕后</em></a><em class="ll">【tech bain】</em></li><li id="079c" class="lp lq ht jk b jl ly jo lz jr ma jv mb jz mc kd lu lv lw lx bi translated"><a class="ae ke" href="https://www.youtube.com/watch?v=Pc2aJxnmzh0" rel="noopener ugc nofollow" target="_blank"><em class="ll">Snapchat的滤镜如何工作</em> </a> <em class="ll"> (Vox) </em></li></ul><figure class="lh li lj lk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es md"><img src="../Images/731acf26f5d44fdc58d99a6388fe935d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6gfnVvkMRFtjVsWF7vkClA.png"/></div></div></figure><h2 id="fd41" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">这个故事发表在<a class="ae ke" href="https://medium.com/swlh" rel="noopener"> The Startup </a>上，这是Medium最大的企业家出版物，拥有294，522+人。</h2><h2 id="7945" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">在此订阅接收<a class="ae ke" href="http://growthsupply.com/the-startup-newsletter/" rel="noopener ugc nofollow" target="_blank">我们的头条新闻</a>。</h2><figure class="lh li lj lk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es md"><img src="../Images/731acf26f5d44fdc58d99a6388fe935d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6gfnVvkMRFtjVsWF7vkClA.png"/></div></div></figure></div></div>    
</body>
</html>