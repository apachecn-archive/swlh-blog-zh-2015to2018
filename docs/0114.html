<html>
<head>
<title>In Search of the Perfect Image Gallery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">寻找完美的图库</h1>
<blockquote>原文：<a href="https://medium.com/swlh/in-search-of-the-perfect-image-gallery-34f46f7615a1?source=collection_archive---------2-----------------------#2015-08-29">https://medium.com/swlh/in-search-of-the-perfect-image-gallery-34f46f7615a1?source=collection_archive---------2-----------------------#2015-08-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="5a8c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们面对现实:在一个反应灵敏的世界中显示图像并不容易。</p><p id="7ec5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在网页设计师的天堂里，所有的相机都会拍摄正方形图像，所以我们幸运的网页设计师会很容易地添加一个简单的<img/>标签列表，并最终玩一些float: left或某种flexbox的游戏。然后，他们会在下午4点关闭笔记本电脑，出去参加一些社交活动。</p><p id="ff9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不幸的是，对于我们亲爱的网页设计师来说，实际上并不是这样。照片可以是水平的(风景)，垂直的(肖像)或方形的。当你需要把一堆不同长宽比的图片放在一起时，你会努力弄清楚如何让整个东西看起来像一个专业的照相馆，而不是一片混乱。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/e710244926fa349e05da0dabe2a2755b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7DIccDlAD_S3IMhEBJc54w.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">that’s what I mean with “total mess”</figcaption></figure><p id="dbd8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">解决这个问题的一个显而易见的方法是，像杂志图片编辑一样思考，调整图片的大小和位置，使它们看起来很棒。然而，这种方法不是可行的选择，因为它基于三个假设:</p><ol class=""><li id="4834" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">我们是优秀的图片编辑</li><li id="6350" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">我们有时间仔细调整数百张照片的大小和位置</li><li id="e8c6" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">网站比例是固定的</li></ol><p id="3a1b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，基本上我们需要的是某种自动化，允许我们盲目地将我们的图像添加到图库中，然后将它们漂亮地放置。我们还希望能够在糟糕的iphone 4和IMAX屏幕上看到这些小猫。</p><p id="a5b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有这一切意味着我们亲爱的网页设计师将无法有社交生活，因为他们将不得不处理媒体的询问和基于百分比的布局，而他们的客户将开始抱怨他们浪费所有的时间在一个该死的简单的图库上，而他们的堂兄弟的一个朋友可以在五分钟内完成。</p><p id="3c54" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，当我们可怜的网页设计师开始失去任何希望时，一个名为<a class="ae kh" href="https://www.pinterest.com/" rel="noopener ugc nofollow" target="_blank"> pinterest </a>的网站推出了一个可能解决所有邪恶的灵丹妙药:砖石布局。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ki"><img src="../Images/2fa10de6e03973e572cf741f1e20973c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SGAVEweu0amrviE7SAKZDg.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">masonry layout on pinterest</figcaption></figure><p id="e5ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">砖石很棒！你可以放入任何长宽比的图像，这段智能的JavaScript代码会填充照片中的空隙，并保持所有元素的固定宽度。也很容易配置它来减少小屏幕上的列数，最终在那个蹩脚的旧iphone 4上只有一列。</p><p id="715b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，这种解决方案已经开始太受欢迎了，所以，就在我开始有一些社交生活的时候，我决定我需要寻找一种替代方案。</p><p id="02be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在打印的布局中，图像放置在不同的基线上是很少见的。砖石侧重于列，印刷设计师通常侧重于行，所以我开始寻找一种方法来固定行高而不是列宽。我已经找到了一些不错的解决方案，如<a class="ae kh" href="https://github.com/ed-lea/jquery-collagePlus" rel="noopener ugc nofollow" target="_blank"> jquery-collagePlus </a>或<a class="ae kh" href="http://miromannino.github.io/Justified-Gallery/" rel="noopener ugc nofollow" target="_blank"> Justified-Gallery </a>，然而真正让我震惊的是<a class="ae kh" href="http://www.chromatic.io/" rel="noopener ugc nofollow" target="_blank"> chromatic.io </a>使用的图库</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kj"><img src="../Images/ccaa8f30182492e3fce3c7f83ecad147.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FHmZeGua02d7_k9EAHNcpg.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">chromatic.io gallery</figcaption></figure><p id="ef3d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个图库最大的特点是它总是试图让行的高度接近屏幕高度的一半，并且它总是会产生一个完美的矩形图库，而不会在页面末尾留下任何空白。</p><p id="0632" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">幸运的是，chromatic的人发表了一篇文章<a class="ae kh" href="https://www.crispymtn.com/stories/the-algorithm-for-a-perfectly-balanced-photo-gallery" rel="noopener ugc nofollow" target="_blank">和他们为达到这一点所做的所有研究，我强烈建议你看一看。</a></p><p id="a6e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基本上他们做的是:</p><ul class=""><li id="ef1a" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc kk jz ka kb bi translated">将窗口高度除以2，找出单行的理想高度</li><li id="af57" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc kk jz ka kb bi translated">假设调整图像大小以适合理想的高度，使用所有图像宽度的总和来猜测我们需要的行数</li></ul><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kl km l"/></div></figure><ul class=""><li id="5f37" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc kk jz ka kb bi translated">使用归一化图像比率作为权重，使用perfectRowsNumber作为我们的k，解决线性分区问题</li><li id="3e81" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc kk jz ka kb bi translated">计算每个映像必须有多大的尺寸才能适合我们的分区阵列</li><li id="76ab" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc kk jz ka kb bi translated">最后，他们简单地用这些尺寸的div填充DOM，并使用实际的图像作为背景</li></ul><p id="c148" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有需要的代码都可以在<a class="ae kh" href="https://github.com/crispymtn/chromatic-ui" rel="noopener ugc nofollow" target="_blank"> github </a>上免费获得，他们还提供了一个<a class="ae kh" href="https://github.com/crispymtn/chromatic.js" rel="noopener ugc nofollow" target="_blank"> jquery插件</a>，但是它没有得到很好的文档记录，并且有很多额外的功能，所以我决定创建我自己的版本来做一件事，并试图把它做好:给定一个由图像的来源和纵横比描述的图像数组，返回一个由图像的精确尺寸描述的图像数组，让它们适合我们的完美布局。</p><p id="7c0f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最初，我试图简单地从他们的CoffeeScript源代码转换linear_partition函数，但突然我意识到它太复杂，计算量太大，不符合我的要求。所以我开始在网上阅读关于线性分区问题的可能解决方案。chromatic所遵循的方法在此处被描述为<a class="ae kh" href="http://www8.cs.umu.se/kurser/TDBAfl/VT06/algorithms/BOOK/BOOK2/NODE45.HTM" rel="noopener ugc nofollow" target="_blank">，并且允许找到最优解。</a></p><p id="28ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">盯着所有这些数学符号开始头疼，我跑去寻求另一个众所周知的万灵药的帮助:<a class="ae kh" href="https://en.wikipedia.org/wiki/Partition_problem#The_greedy_algorithm" rel="noopener ugc nofollow" target="_blank">维基百科</a>。</p><figure class="je jf jg jh fd ji ko kp kq kr ks paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kn"><img src="../Images/8ab88e7ce404c634f035fece613dcc89.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*pO-_OkVwt8_wjY5J2SZlUw.jpeg"/></div></div></figure><p id="10bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据该文章，将简单地将每个元素推到最小的可用分区的贪婪算法已知给出了最优解的7/6近似值。所以我决定写一个贪婪的线性划分算法，看看它与最优算法相比表现如何。</p><p id="0de0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我的greedyLinearPartition算法:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="35a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我做了一支<a class="ae kh" href="http://codepen.io/axyz/full/VLJrKr/" rel="noopener ugc nofollow" target="_blank">笔</a>，看看它在定位图像时表现如何。这不是完全相同的彩色最佳版本，但它似乎是我可以接受的。</p><p id="f552" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们看看使用贪婪算法，我们将获得多少速度。我已经准备了一个<a class="ae kh" href="http://jsperf.com/greedy-linear-partitioning" rel="noopener ugc nofollow" target="_blank"> jsPerf </a>来看看这两个算法如何在一些随机的样本数组上执行，既有完全随意的，也有类似实际照片比例的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kt"><img src="../Images/fe35698004b19242fe60c1916fe71951.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X1Lic0rvlwl07-VjQYFlOg.jpeg"/></div></div></figure><p id="c4c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">结果是惊人的，也许linear_partition代码可以优化:它使用下划线并直接从CoffeScript转换而来，但是在每秒操作数方面的差异确实很大，因此它可能会在较慢的设备上产生一些很大的差异。</p><p id="e999" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我已经在github上发布了完整的代码作为<a class="ae kh" href="https://github.com/axyz/perfect-layout" rel="noopener ugc nofollow" target="_blank">完美布局</a>，它也可以在<a class="ae kh" href="https://www.npmjs.com/package/perfect-layout" rel="noopener ugc nofollow" target="_blank"> npm </a>和bower上获得。</p><p id="bb83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请随意使用和贡献，我真的很想看看它会如何发展(我在考虑惰性加载和无限滚动支持)，但始终保持模块化的方法，以便那些只需要简单布局的人不会被未使用的代码弄得臃肿。</p><p id="9148" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kh" rel="noopener" href="/@axyz/in-search-of-the-perfect-image-gallery-part-2-48f04c84ac34">阅读第二部分</a></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ku"><img src="../Images/c1192ebad88d6b1fc6ae1d6a2bc61154.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WJ6pLzJD9qnHRthas2vL-Q.jpeg"/></div></div></figure><p id="3f81" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kv">发表于</em> <strong class="ih kw">创业、旅游癖和生活黑客</strong></p><div class="je jf jg jh fd ab cb"><figure class="kx ji ky kz la lb lc paragraph-image"><a href="http://supply.us9.list-manage.com/subscribe?u=310af6eb2240d299c7032ef6c&amp;id=d28d8861ad"><img src="../Images/de26c089e79a3a2a25d2b750ff6db50f.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*fSUxWFf6_qlAfAObKJuEAA.png"/></a></figure><figure class="kx ji ky kz la lb lc paragraph-image"><a href="https://blog.growth.supply/"><img src="../Images/f47a578114e0a96bdfabc3a5400688d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Me4fgEZDDb-d8j41O5oKaQ.png"/></a></figure><figure class="kx ji ky kz la lb lc paragraph-image"><a href="https://twitter.com/swlh_"><img src="../Images/c1351daa9c4f0c8ac516addb60c82f6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*_DMWEyOz7IhTGGNb5tzA0g.png"/></a></figure></div><p id="ec56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">-</p></div></div>    
</body>
</html>