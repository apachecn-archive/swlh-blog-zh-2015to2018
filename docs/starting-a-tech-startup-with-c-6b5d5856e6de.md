# 用 C++启动科技创业

> 原文：<https://medium.com/swlh/starting-a-tech-startup-with-c-6b5d5856e6de>

我和一位大学老朋友，林网络公司的费多尔·朱巴一起创办了一家名为“信号分析”的新科技公司。我们正在通过建立自己的数据库系统来构建一个现代的、基于云的 [OLAP](https://en.wikipedia.org/wiki/OLAP_cube) 多维数据存储和检索(cubes)。

我在技术方面处于领先地位，我对 C++非常熟悉，所以决定用它来构建我们的 OLAP 引擎。我最初确实在 Rust 中构建了一个原型，但是风险太高了(我应该再写一篇文章来解释这个决定)。

我的许多同行认为我用 C++而不是用动态语言——比如 Ruby 或 Python——构建云服务很奇怪，这种语言提供了高生产率以快速交付。

它开始质疑我自己使用 C++的判断，我决定研究它是否是一个好主意。

## **生产力**

C++不是一种动态语言，但是现代 C++ (C++11/14)有类型推理。有很多误解，认为如果用 C++编写，就必须用原始指针编码，键入冗长的名称空间/类型，并手动管理内存。在 C++中感觉更有效率的一个关键特性是 [*auto*](http://en.cppreference.com/w/cpp/language/auto) 特性；您不必键入冗长的命名空间和类；它使用类型推断来推断变量的类型。

手动内存管理是对 C++最普遍的误解。从 C++11 开始，现在推荐使用[*STD::shared _ ptr*](http://en.cppreference.com/w/cpp/memory/shared_ptr)或[*STD::unique _ ptr*](http://en.cppreference.com/w/cpp/memory/unique_ptr)进行自动内存管理。维护被引用的指针需要很少的计算成本，但这很小，安全性超过了这一成本。

高效的最后一个部分是拥有快速构建服务/产品的库。Python、Ruby 和其他语言都有很好的库来处理公共基础设施。在我看来，当前的 C++标准库严重缺乏基本功能，某些 API 的性能很差(例如，从 iostreams 读取文件)。脸书拥有开源的高质量库，帮助我们快速发布 OLAP 云服务的 alphas 版本。：

*   [***愚昧***](https://github.com/facebook/folly/)

这是一个很棒的通用 C++库，有很多高性能的类可以使用。我在整个引擎中使用他们的 *fbvector，fbstring* ，因为它分别比他们的 std::vector 和 std::string 提供了更好的性能。我们还使用了很多他们的未来和原子无锁数据结构。

脸书在他们的动态增长分配上做了一个非常聪明的举动，没有使用二次增长(这很容易从数学上证明为什么不好)。他们的容器将内存大小增加了 1.5 倍，而不是 2 倍，以提高性能。

另一方面，阅读《愚蠢代码》也让我成为了一名更好的 C++开发人员，所以我强烈推荐阅读这本书。

*   [***比邻星***](https://github.com/facebook/proxygen)

Proxygen 是一个异步 HTTP 服务器，也是由脸书开发的。我们使用 Proxygen 作为 HTTP 服务器，以 JSON 格式向 OLAP 引擎插入数据，并从中检索数据。它允许我们在一天内创建一个调用我们引擎的高性能 HTTP 服务器。我决定用 Python Tornado 服务器对它进行基准测试，并在 EC2 实例上用 200 个 HTTP 连接进行测试，得到了以下结果:

*C++/Proxygen =每秒 1，990，130 个请求*

*Python/Tornado =每秒 41，329 个请求*

它的 API 更低级，你必须编写自己的 HTTP 路由，但这是一个微不足道的任务。下面是我们的 HTTP 主体处理程序大致的样子:

*   [***王乐***](https://github.com/facebook/wangle)

我们的 OLAP 引擎本质上是一个分布式数据库，用于存储和查询多维数据。该引擎使用王乐作为应用服务器的基础。所有的逻辑都分层到王乐处理程序中，这些处理程序链接在一起形成一个管道。它与我们的 Proxygen HTTP 服务器通信以提供数据查询，并且节点之间相互通信。

它使用共享相同(对称)二进制可执行文件的服务器网格，因此没有主/从范例。每个服务器都是一个节点，既作为主机又作为从机，并使用自定义的二进制数据协议相互传递数据/消息。

我们需要的唯一缺少的东西是[纤程](https://en.wikipedia.org/wiki/Fiber_(computer_science)),用于引擎内存储和查询任务的协作调度；然而，富利/王乐开发商目前有一个实验版本，但它还没有准备好生产。

## **2。硬件/劳动力成本**

根据我们的 HTTP 基准测试，我量化了 1 个 C++服务器大约相当于 40 个负载平衡的 python 服务器的原始计算能力。因此，使用 C++真的可以从底层硬件中挤出所有的计算能力，节省 1/40 的服务器成本。我想我们可以一开始就用 Python 编写它，但是从经济上来说，这是对人力成本和时间的浪费，因为在某些阶段，我们不得不放弃它，用 C++版本来获得我们需要的性能。Python 代码一旦废弃就没有经济价值了。

总的来说，C++可能不是创业公司最受欢迎的选择，但我相信现代 C++可以是一个可行的选择，给你接近 C 的性能和高层次的抽象。一旦代码库显著增长，我会担心构建时间，但希望 C++17 模块可以缓解这一问题。

我希望这篇文章能激励其他人探索 C++。