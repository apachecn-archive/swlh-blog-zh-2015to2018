<html>
<head>
<title>A Guide to AWS Lambdas using Python, triggered by an API call</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python的AWS Lambdas指南，由API调用触发</h1>
<blockquote>原文：<a href="https://medium.com/swlh/a-guide-to-aws-lambdas-using-python-triggered-by-an-api-call-1e768edd13c5?source=collection_archive---------2-----------------------#2018-10-16">https://medium.com/swlh/a-guide-to-aws-lambdas-using-python-triggered-by-an-api-call-1e768edd13c5?source=collection_archive---------2-----------------------#2018-10-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b6a7a7b8d1f8f49b7ccae387750e4699.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1xw6Sl17iX6c-3763PhWGw.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Let’s pretend that this is a relevant image</figcaption></figure><p id="64c3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">无服务器计算一直是最近讨论的话题。无服务器计算是服务器、操作系统和基础设施的抽象，同时保留核心功能-计算。无服务器计算有其自身的优势。开发人员不必担心在实际使用它们的功能之前设置整个服务器。此外，与基于时间的计费相比，某些应用程序更适合基于计算的计费。兰姆达斯有助于实现这一点。简而言之，lambdas是只被分配一项任务的孤立功能。使用这种类型的体系结构的其他一些优点是可伸缩性和无障碍的资源分配。所有主要的云服务提供商(<a class="ae js" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"> AWS </a>、<a class="ae js" href="https://cloud.google.com/functions/" rel="noopener ugc nofollow" target="_blank"> GCP </a>)都提供lambda功能。下面是在AWS中创建基本python lambda的指南。此外，还有一个使用API调用触发这个lambda的示例代码，这是最常见的请求类型。</p><p id="e4cd" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">以下是我们将遵循的步骤:</p><ul class=""><li id="97f9" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">λ创建</li><li id="80fa" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">Lambda部署</li><li id="11e0" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">API网关的配置</li></ul><p id="deba" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="kh">本指南假定您有一个活跃的AWS帐户和一定的耐心。</em></p><h1 id="5410" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">λ创建</h1><p id="5f2f" class="pw-post-body-paragraph iu iv hi iw b ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn lk jp jq jr hb bi translated">一个简单的lambda应该是这样的:</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="3b32" class="lu kj hi lq b fi lv lw l lx ly">def lambda_handler(event, context):<br/>    #lambda function here<br/>    ...<br/> <br/>    return { 'status' : 200, 'body' : 'Lambda executed successfully!' }</span></pre><p id="a0f3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这个方法会放入一个入口点，姑且称之为<em class="kh"> main </em> .py，以后记住。</p><p id="683e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">以下摘自官方<a class="ae js" href="https://docs.aws.amazon.com/lambda/latest/dg/python-programming-model-handler-types.html" rel="noopener ugc nofollow" target="_blank">文件</a>:</p><ul class=""><li id="4e5a" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated"><code class="du lz ma mb lq b">event</code>–AWS Lambda使用此参数将<strong class="iw mc">事件数据</strong>传递给处理程序。这个参数通常是Python <code class="du lz ma mb lq b">dict</code>类型的。也可以是<code class="du lz ma mb lq b">list</code>、<code class="du lz ma mb lq b">str</code>、<code class="du lz ma mb lq b">int</code>、<code class="du lz ma mb lq b">float</code>或<code class="du lz ma mb lq b">NoneType</code>型。</li><li id="50d4" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated"><code class="du lz ma mb lq b">context</code>–AWS Lambda使用此参数向您的处理程序提供<strong class="iw mc">运行时信息</strong>。该参数属于<code class="du lz ma mb lq b">LambdaContext</code>类型。</li></ul><p id="d7b2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw mc">处理额外的依赖关系</strong></p><p id="bf6a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Lambdas托管在已经安装了基本软件包的Linux服务器上。所有附加的依赖项都必须以固定的格式明确地放入部署包中，这将在下面描述。</p><p id="4f0e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">为了使这个过程顺利进行，为特定的项目建立一个虚拟环境。要创建一个部署包，创建一个zip文件，在zip文件的根层有一个主入口点文件<code class="du lz ma mb lq b">main.py</code>。额外的文件夹和文件可以以你认为合适的任何格式存在于zip中。<strong class="iw mc">确保你的项目中没有绝对路径。</strong></p><p id="2b20" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">它应该是这样的:</p><p id="9e07" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">lambda-test.zip/<br/>├──main . py(lambda入口点包含lambda_handler方法<br/>├──folder 1/<br/>│├──file 1<br/>│├──file 2<br/>│├──some _ method . py<br/>│└──docs<br/>├──some other folder/<br/>│├─file 1<br/>└─docs<br/>└─package 1<br/>╸─package 2【2】</p><p id="f30e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw mc">添加依赖关系</strong>:将<code class="du lz ma mb lq b">venv/lib/python2.7/site-packages/</code> <strong class="iw mc"> </strong>中的所有文件和文件夹复制到zip的根目录下(上图中的packageX)。这里的<code class="du lz ma mb lq b">venv</code>是项目的虚拟环境文件夹。遵守亚马逊设定的<a class="ae js" href="https://docs.aws.amazon.com/lambda/latest/dg/limits.html" rel="noopener ugc nofollow" target="_blank">尺寸限制</a>。让我们称这个压缩包为<code class="du lz ma mb lq b">lambda-test.zip</code></p></div><div class="ab cl md me gp mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="hb hc hd he hf"><h1 id="4f9c" class="ki kj hi bd kk kl mk kn ko kp ml kr ks kt mm kv kw kx mn kz la lb mo ld le lf bi translated">Lambda部署</h1><p id="87ec" class="pw-post-body-paragraph iu iv hi iw b ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn lk jp jq jr hb bi translated">掰指关节，这很讨厌。</p><ul class=""><li id="0103" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">登录您的AWS帐户。在服务下，转到<em class="kh"> lambdas </em>。创建一个新函数，姑且称之为<code class="du lz ma mb lq b">test</code>，将运行时改为<code class="du lz ma mb lq b">Python2.7</code>，并给它分配一个合适的角色。检查右上方的lambda区域。假设是这样的:</li></ul><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="5c01" class="lu kj hi lq b fi lv lw l lx ly"><strong class="lq mc">ARN</strong> - arn:aws:lambda:us-east-1:xxx:function:test</span></pre><p id="75f7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">稍后我们需要记住的地区:<strong class="iw mc"> </strong> <code class="du lz ma mb lq b">us-east-1</code></p><ul class=""><li id="717f" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">从左侧菜单中添加一个触发器<code class="du lz ma mb lq b">API gateway</code>。在其配置中，创建一个新的API。让安全系统暂时打开。在折叠的下拉菜单中命名该API。添加并保存触发器。</li></ul><p id="de9f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw mc">代码</strong></p><ul class=""><li id="1ecd" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">点击中间的功能<code class="du lz ma mb lq b">test</code>。有一个在线编辑代码的选项，但这适用于较小的项目。我们将使用我们的部署包。要使用它，去<strong class="iw mc"> S3 </strong>创建一个新的桶。<strong class="iw mc">确保桶区域与拉姆达区域</strong> <code class="du lz ma mb lq b">us-east-1</code> <strong class="iw mc">相同。</strong> <em class="kh">我花了很多时间才弄明白这个，别在这上面浪费时间了！</em>在这个桶中上传您的部署包<code class="du lz ma mb lq b">lambda-test.zip</code>并获得zip的链接。确保铲斗具有必要的安全参数。</li><li id="f3fc" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">回到lambda仪表板，将此链接粘贴到<code class="du lz ma mb lq b">code entry type</code><strong class="iw mc">-</strong>-<code class="du lz ma mb lq b">Upload a zip from Amazon S3.</code>确保运行时是Python2.7，处理程序设置为<code class="du lz ma mb lq b">main.lambda_handler.</code> <strong class="iw mc"> <em class="kh"> </em> </strong>根据需要调整下面设置中的超时。处理时间短的应用程序不应被分配很长的超时时间。记住，我们是横向扩展，按计算能力付费。我浪费了更多的时间去想为什么我的请求会超时。你不应该。救人而不犯错误，值得庆幸。</li></ul></div><div class="ab cl md me gp mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="hb hc hd he hf"><h1 id="c718" class="ki kj hi bd kk kl mk kn ko kp ml kr ks kt mm kv kw kx mn kz la lb mo ld le lf bi translated">配置API网关</h1><ul class=""><li id="37ae" class="jt ju hi iw b ix lg jb lh jf mp jj mq jn mr jr jy jz ka kb bi translated">在lambda仪表板上选择API gateway。并进入<strong class="iw mc"/>API创建<strong class="iw mc">、</strong>、<code class="du lz ma mb lq b">test.</code></li></ul><p id="3a45" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在你的API <strong class="iw mc"> <em class="kh"> </em> </strong> <code class="du lz ma mb lq b">test</code>中，创建一个新的资源——姑且称之为<code class="du lz ma mb lq b">number</code> <strong class="iw mc"> <em class="kh">。</em> </strong>中的<code class="du lz ma mb lq b">number</code>，做:</p><ol class=""><li id="6462" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr ms jz ka kb bi translated"><code class="du lz ma mb lq b">Actions </code> — <code class="du lz ma mb lq b">Enable CORS</code>:默认设置。</li><li id="5384" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr ms jz ka kb bi translated"><code class="du lz ma mb lq b">Actions </code> — <code class="du lz ma mb lq b">Create method</code> ( <code class="du lz ma mb lq b">GET</code>测试方法):勾选<code class="du lz ma mb lq b">Use Lambda Proxy integration</code>，同时添加lambda函数名<code class="du lz ma mb lq b">test</code>。</li><li id="50e6" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr ms jz ka kb bi translated">点击这个<em class="kh">刚被</em>创建的<code class="du lz ma mb lq b">number</code>的GET方法，然后点击被测螺栓图标。您可以在这里进行模拟测试。如果一切顺利，您应该会在右侧的<code class="du lz ma mb lq b">Response Body</code>下看到以下内容。</li></ol><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="c31a" class="lu kj hi lq b fi lv lw l lx ly">{<br/>  "body": "Lambda executed successfully!",<br/>  "status": 200<br/>}</span></pre><p id="3d26" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw mc">注意</strong> : <code class="du lz ma mb lq b">test</code> <strong class="iw mc"> <em class="kh"> </em> </strong>是API套件。<strong class="iw mc"><em class="kh"/></strong><code class="du lz ma mb lq b">number</code><strong class="iw mc"><em class="kh"/></strong>就是那个套件里的一个资源。<strong class="iw mc"><em class="kh"/></strong><code class="du lz ma mb lq b">GET</code><strong class="iw mc"><em class="kh"/></strong>是那个套件中那个资源的一个方法。而<code class="du lz ma mb lq b">life </code>是个谜。</p><p id="3e7e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">你的lambda现在可以运行了！</p></div><div class="ab cl md me gp mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="hb hc hd he hf"><p id="e50a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在结束之前，我将向您展示最后一样东西，从<code class="du lz ma mb lq b">GET</code>调用中获取一个参数。为此，请按照下列步骤操作:</p><ul class=""><li id="26ab" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">转到<code class="du lz ma mb lq b">number</code><strong class="iw mc"><em class="kh"/></strong>的<code class="du lz ma mb lq b">GET</code>方法，点击<strong class="iw mc"> <em class="kh"> </em> </strong> <code class="du lz ma mb lq b">Method Request</code>。</li><li id="5a01" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">在<code class="du lz ma mb lq b">URL Query String Parameters</code>下，添加查询字符串，比如说<code class="du lz ma mb lq b">input</code>。<code class="du lz ma mb lq b">input</code>是我们将从<code class="du lz ma mb lq b">GET</code>调用中获得的参数。您可以选择强制执行此操作。(我希望你喜欢这里大量使用双关语。)</li><li id="f076" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">在您的lambda函数<code class="du lz ma mb lq b">main.py</code>中，进行以下更改:</li></ul><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="1e22" class="lu kj hi lq b fi lv lw l lx ly">def lambda_handler(event, context):<br/>    #get number from the GET call<br/>    <br/>     input = int(event['queryStringParameters']['input'])<br/>     return { 'status' : 200, 'body' : 'Lambda executed successfully! Got the number : %d'%input }</span></pre><p id="b76a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="kh">(你将不得不再次创建部署包，把它上传到S3，然后在lambda函数中取回，但这应该不成问题，因为你现在是专家了。)</em></p><ul class=""><li id="b0e7" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">返回到资源编号，并在GET方法中单击test(螺栓图标)。在<code class="du lz ma mb lq b">Query Strings</code> <code class="du lz ma mb lq b">{number}</code>中输入以下内容。</li></ul><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="f82e" class="lu kj hi lq b fi lv lw l lx ly">input=2</span></pre><ul class=""><li id="7c89" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">点击测试。如果一切顺利，结果应该是，</li></ul><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="b1b2" class="lu kj hi lq b fi lv lw l lx ly">Lambda executed successfully! Got the number : 2</span></pre></div><div class="ab cl md me gp mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="hb hc hd he hf"><p id="f683" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><a class="ae js" href="https://aws.amazon.com/blogs/machine-learning/how-to-deploy-deep-learning-models-with-aws-lambda-and-tensorflow/" rel="noopener ugc nofollow" target="_blank">这里是</a>一篇强调在AWS lambdas上部署深度学习模型(大尺寸)的文章。</p><p id="c8b6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">干杯！</p><figure class="ll lm ln lo fd ij er es paragraph-image"><a href="https://medium.com/swlh"><div class="er es mt"><img src="../Images/308a8d84fb9b2fab43d66c117fcc4bb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YqDjlKFwScoQYQ62DWEdig.png"/></div></a></figure><h2 id="c148" class="lu kj hi bd kk mu mv mw ko mx my mz ks jf na nb kw jj nc nd la jn ne nf le ng bi translated">这篇文章发表在<a class="ae js" href="https://medium.com/swlh" rel="noopener"> The Startup </a>上，这是Medium最大的创业刊物，拥有+ 378，907读者。</h2><h2 id="9478" class="lu kj hi bd kk mu mv mw ko mx my mz ks jf na nb kw jj nc nd la jn ne nf le ng bi translated">在这里订阅接收<a class="ae js" href="http://growthsupply.com/the-startup-newsletter/" rel="noopener ugc nofollow" target="_blank">我们的头条新闻</a>。</h2><figure class="ll lm ln lo fd ij er es paragraph-image"><a href="https://medium.com/swlh"><div class="er es mt"><img src="../Images/b0164736ea17a63403e660de5dedf91a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ouK9XR4xuNWtCes-TIUNAw.png"/></div></a></figure></div></div>    
</body>
</html>