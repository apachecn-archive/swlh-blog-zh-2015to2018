<html>
<head>
<title>Ethereum ain’t hiding your secrets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以太坊不会隐藏你的秘密</h1>
<blockquote>原文：<a href="https://medium.com/swlh/ethereum-aint-hiding-your-secrets-703e89088937?source=collection_archive---------3-----------------------#2018-09-22">https://medium.com/swlh/ethereum-aint-hiding-your-secrets-703e89088937?source=collection_archive---------3-----------------------#2018-09-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="f858" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">关于如何在协定私有变量中显示状态的技术演练</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/011ad17b4380da7038785d759d13e9ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T417ZESBihRffqD6EA8u8Q.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Spammy Fun Image from Blog 4Linux</figcaption></figure><h1 id="6c92" class="jn jo hi bd jp jq jr js jt ju jv jw jx io jy ip jz ir ka is kb iu kc iv kd ke bi translated">序</h1><p id="385d" class="pw-post-body-paragraph kf kg hi kh b ki kj ij kk kl km im kn ko kp kq kr ks kt ku kv kw kx ky kz la hb bi translated">这是一个技术教程，它将带您了解从以太坊智能合约的私有变量中检索状态的具体步骤。这里的所有技术都可以应用到现实生活中。</p><p id="2383" class="pw-post-body-paragraph kf kg hi kh b ki lb ij kk kl lc im kn ko ld kq kr ks le ku kv kw lf ky kz la hb bi translated"><em class="lg">本教程由</em> <a class="ae lh" href="https://ethernaut.zeppelin.solutions/" rel="noopener ugc nofollow" target="_blank"> <em class="lg">以太者</em> </a> <em class="lg"> Lvl8挑战鼓励。</em></p><h1 id="d7f5" class="jn jo hi bd jp jq jr js jt ju jv jw jx io jy ip jz ir ka is kb iu kc iv kd ke bi translated">你可能需要什么</h1><p id="1ccb" class="pw-post-body-paragraph kf kg hi kh b ki kj ij kk kl km im kn ko kp kq kr ks kt ku kv kw kx ky kz la hb bi translated"><a class="ae lh" href="https://truffleframework.com/" rel="noopener ugc nofollow" target="_blank">松露</a>/<a class="ae lh" href="https://github.com/trufflesuite/ganache-cli" rel="noopener ugc nofollow" target="_blank">ganache-CLI</a>/<a class="ae lh" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">node . js</a>/<a class="ae lh" href="https://curl.haxx.se/" rel="noopener ugc nofollow" target="_blank">curl</a></p><h1 id="5f87" class="jn jo hi bd jp jq jr js jt ju jv jw jx io jy ip jz ir ka is kb iu kc iv kd ke bi translated">合同代码</h1><p id="0ebc" class="pw-post-body-paragraph kf kg hi kh b ki kj ij kk kl km im kn ko kp kq kr ks kt ku kv kw kx ky kz la hb bi translated">下面是一个非常简单的契约，有四个私有变量，有四种不同的类型:<strong class="kh li"> uint256 </strong>、<strong class="kh li">布尔</strong>、<strong class="kh li"> uint16 </strong>和<strong class="kh li">映射</strong>。当契约被部署到网络时，这些值被初始化。我们假设合约已经部署到“0xb3b 4546 a6 D8 c8 CD 1081 AC 94 a 7 e 06 a 24 b 207 c 863d”。</p><pre class="iy iz ja jb fd lj lk ll lm aw ln bi"><span id="5dcc" class="lo jo hi lk b fi lp lq l lr ls">contract PrivateStorage {<br/>    // Private Variables<br/>    uint256               private    v0;<br/>    bool                  private    v1;<br/>    uint16                private    v2;<br/>    mapping(uint =&gt; uint) private    v3;</span><span id="651e" class="lo jo hi lk b fi lt lq l lr ls">    // Initializations    <br/>    constructor() {<br/>        v0    =    5;<br/>        v1    =    true;<br/>        v2    =    6;<br/>        v3[1] =    7;<br/>    }<br/>}</span></pre><h1 id="f4ec" class="jn jo hi bd jp jq jr js jt ju jv jw jx io jy ip jz ir ka is kb iu kc iv kd ke bi translated">技巧(1)——揭示uint256</h1><p id="31aa" class="pw-post-body-paragraph kf kg hi kh b ki kj ij kk kl km im kn ko kp kq kr ks kt ku kv kw kx ky kz la hb bi translated">不可能通过从外部调用来访问合同的值。为了跳过障碍，我们需要通过web 3 API "<strong class="kh li">eth _ getStorageAt</strong>"直接访问契约的<strong class="kh li">存储</strong>。通过在控制台/终端中执行以下命令，我们在第0个状态“0xb3b45…”处访问契约，这是第一个声明的变量<em class="lg"> v0 </em>。</p><pre class="iy iz ja jb fd lj lk ll lm aw ln bi"><span id="4491" class="lo jo hi lk b fi lp lq l lr ls">curl -X POST - data '{"jsonrpc":"2.0", "method": "<strong class="lk li">eth_getStorageAt</strong>", "params": ["<strong class="lk li">0xb3b4546a6d8c8cd1081ac94a7e06a24b207c863d</strong>", "<strong class="lk li">0x0</strong>", "latest"], "id": 1}' localhost:8545</span></pre><p id="faa8" class="pw-post-body-paragraph kf kg hi kh b ki lb ij kk kl lc im kn ko ld kq kr ks le ku kv kw lf ky kz la hb bi translated">返回的答案将是:</p><pre class="iy iz ja jb fd lj lk ll lm aw ln bi"><span id="e641" class="lo jo hi lk b fi lp lq l lr ls">{"id":1,"jsonrpc":"2.0","result":"<strong class="lk li">0x05</strong>"}</span></pre><p id="4686" class="pw-post-body-paragraph kf kg hi kh b ki lb ij kk kl lc im kn ko ld kq kr ks le ku kv kw lf ky kz la hb bi translated">表示“0xb3b45…”合同的第0个值为<strong class="kh li"> 5 </strong>！！！</p><h1 id="9ea0" class="jn jo hi bd jp jq jr js jt ju jv jw jx io jy ip jz ir ka is kb iu kc iv kd ke bi translated">技巧(二)——揭示布尔&amp; uint16</h1><p id="fe78" class="pw-post-body-paragraph kf kg hi kh b ki kj ij kk kl km im kn ko kp kq kr ks kt ku kv kw kx ky kz la hb bi translated">由于EVM倾向于将多个小状态挤进同一个槽，所以布尔值<em class="lg"> v1 </em>和uint16值<em class="lg"> v2 </em>被分配到同一个存储槽位置——第1个位置。通过执行与技术(1)类似的命令，我们可以显示出<em class="lg"> v1 </em>和<em class="lg"> v2 </em>的组合答案。</p><pre class="iy iz ja jb fd lj lk ll lm aw ln bi"><span id="65e2" class="lo jo hi lk b fi lp lq l lr ls">curl -X POST --data '{"jsonrpc":"2.0", "method": "eth_getStorageAt", "params": ["0xb3b4546a6d8c8cd1081ac94a7e06a24b207c863d", "<strong class="lk li">0x1</strong>", "latest"], "id": 1}' localhost:8545</span></pre><p id="1f14" class="pw-post-body-paragraph kf kg hi kh b ki lb ij kk kl lc im kn ko ld kq kr ks le ku kv kw lf ky kz la hb bi translated">回应将是:</p><pre class="iy iz ja jb fd lj lk ll lm aw ln bi"><span id="1a3b" class="lo jo hi lk b fi lp lq l lr ls">{"id":1,"jsonrpc":"2.0","result":"<strong class="lk li">0x0601</strong>"}</span></pre><p id="ea86" class="pw-post-body-paragraph kf kg hi kh b ki lb ij kk kl lc im kn ko ld kq kr ks le ku kv kw lf ky kz la hb bi translated">展示了第一私有状态<em class="lg"> v1 </em>的值为<strong class="kh li"> 1 </strong>(为<strong class="kh li">真</strong>)，第二私有状态<em class="lg"> v2 </em>的值为<strong class="kh li"> 6 </strong>，它们一个接一个地连接在一起。</p><h1 id="feed" class="jn jo hi bd jp jq jr js jt ju jv jw jx io jy ip jz ir ka is kb iu kc iv kd ke bi translated">技巧(3)——揭示映射</h1><p id="db40" class="pw-post-body-paragraph kf kg hi kh b ki kj ij kk kl km im kn ko kp kq kr ks kt ku kv kw kx ky kz la hb bi translated">映射有一个不同的存储指示符，它是与协定中的映射位置连接在一起的映射键的散列。例如<strong class="kh li">hash([mapping _ key | mapping _ position])</strong>。为了找到串联，我们将映射键<strong class="kh li"> 1 </strong>附加到映射位置<strong class="kh li">2</strong>(因为其他私有状态<em class="lg"> v0、v1、v2 </em>用完了前两个位置。)</p><pre class="iy iz ja jb fd lj lk ll lm aw ln bi"><span id="855b" class="lo jo hi lk b fi lp lq l lr ls">[mapping_key | mapping_position] = "0x1" + "0x2"</span></pre><p id="9363" class="pw-post-body-paragraph kf kg hi kh b ki lb ij kk kl lc im kn ko ld kq kr ks le ku kv kw lf ky kz la hb bi translated">从技术上讲，我们需要在松露或其他地方创建一个可变的<em class="lg">梳子</em>:</p><pre class="iy iz ja jb fd lj lk ll lm aw ln bi"><span id="4e56" class="lo jo hi lk b fi lp lq l lr ls">var <strong class="lk li">comb</strong> = "0000000000000000000000000000000000000000000000000000000000000001" + "0000000000000000000000000000000000000000000000000000000000000002"</span></pre><p id="763d" class="pw-post-body-paragraph kf kg hi kh b ki lb ij kk kl lc im kn ko ld kq kr ks le ku kv kw lf ky kz la hb bi translated">我们散列这个<em class="lg">梳</em>以获得<strong class="kh li">eth _ getstoraget</strong>访问的最终指示符。</p><pre class="iy iz ja jb fd lj lk ll lm aw ln bi"><span id="4aa8" class="lo jo hi lk b fi lp lq l lr ls">var <strong class="lk li">indicator</strong> = web3.sha3(<strong class="lk li">comb</strong>, {"encoding": "hex"})</span></pre><p id="aa29" class="pw-post-body-paragraph kf kg hi kh b ki lb ij kk kl lc im kn ko ld kq kr ks le ku kv kw lf ky kz la hb bi translated">在这种情况下，我们将得到指示符为"<strong class="kh li">0x e 90 b 7 BC eb6 e 7 df 5418 FB 78d 8 ee 546 e 97 c 83 a 08 bbccc 01 a 0644d 599 CCD 2 a 7 C2 e 0</strong>"，它在下面的命令中使用:</p><pre class="iy iz ja jb fd lj lk ll lm aw ln bi"><span id="2f6a" class="lo jo hi lk b fi lp lq l lr ls">curl -X POST --data '{"jsonrpc":"2.0", "method": "eth_getStorageAt", "params": ["0xb3b4546a6d8c8cd1081ac94a7e06a24b207c863d", "<strong class="lk li">0xe90b7bceb6e7df5418fb78d8ee546e97c83a08bbccc01a0644d599ccd2a7c2e0</strong>", "latest"], "id": 1}' localhost:8545</span></pre><p id="360c" class="pw-post-body-paragraph kf kg hi kh b ki lb ij kk kl lc im kn ko ld kq kr ks le ku kv kw lf ky kz la hb bi translated">成功的结果将是:</p><pre class="iy iz ja jb fd lj lk ll lm aw ln bi"><span id="3861" class="lo jo hi lk b fi lp lq l lr ls">{"id":1,"jsonrpc":"2.0","result":"<strong class="lk li">0x07</strong>"}</span></pre><p id="557e" class="pw-post-body-paragraph kf kg hi kh b ki lb ij kk kl lc im kn ko ld kq kr ks le ku kv kw lf ky kz la hb bi translated">就是这样。我们到此为止。:)</p><h1 id="7ef5" class="jn jo hi bd jp jq jr js jt ju jv jw jx io jy ip jz ir ka is kb iu kc iv kd ke bi translated">摘要</h1><p id="1ae2" class="pw-post-body-paragraph kf kg hi kh b ki kj ij kk kl km im kn ko kp kq kr ks kt ku kv kw kx ky kz la hb bi translated">仅仅利用智能合约上的私有变量是无法隐藏信息的。强烈建议您在将任何秘密发送到区块链之前对其进行编码或加密，该秘密总是对所有人公开的。</p><h1 id="a666" class="jn jo hi bd jp jq jr js jt ju jv jw jx io jy ip jz ir ka is kb iu kc iv kd ke bi translated">伟大的参考</h1><ul class=""><li id="32ef" class="lu lv hi kh b ki kj kl km ko lw ks lx kw ly la lz ma mb mc bi translated"><a class="ae lh" href="https://github.com/ethereum/wiki/wiki/JavaScript-API" rel="noopener ugc nofollow" target="_blank">https://github.com/ethereum/wiki/wiki/JavaScript-API</a></li><li id="7eb1" class="lu lv hi kh b ki md kl me ko mf ks mg kw mh la lz ma mb mc bi translated"><a class="ae lh" rel="noopener" href="/coinmonks/how-to-read-private-variables-in-contract-storage-with-truffle-ethernaut-lvl-8-walkthrough-b2382741da9f">https://medium . com/coin monks/how-to-read-private-variables-in-contract-storage-with-truffle-ether naut-lvl-8-walk through-b 2382741 da9f</a></li><li id="c67c" class="lu lv hi kh b ki md kl me ko mf ks mg kw mh la lz ma mb mc bi translated"><a class="ae lh" href="https://ethernaut.zeppelin.solutions" rel="noopener ugc nofollow" target="_blank">https://ether naut . zeppelin . solutions</a></li></ul><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mi mj l"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><a href="https://medium.com/swlh"><div class="er es mk"><img src="../Images/308a8d84fb9b2fab43d66c117fcc4bb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YqDjlKFwScoQYQ62DWEdig.png"/></div></a></figure><h2 id="48f8" class="lo jo hi bd jp ml mm mn jt mo mp mq jx ko mr ms jz ks mt mu kb kw mv mw kd mx bi translated">这篇文章发表在<a class="ae lh" href="https://medium.com/swlh" rel="noopener"> The Startup </a>上，这是Medium最大的创业刊物，拥有+ 372，020名读者。</h2><h2 id="7265" class="lo jo hi bd jp ml mm mn jt mo mp mq jx ko mr ms jz ks mt mu kb kw mv mw kd mx bi translated">在这里订阅接收<a class="ae lh" href="http://growthsupply.com/the-startup-newsletter/" rel="noopener ugc nofollow" target="_blank">我们的头条新闻</a>。</h2><figure class="iy iz ja jb fd jc er es paragraph-image"><a href="https://medium.com/swlh"><div class="er es mk"><img src="../Images/b0164736ea17a63403e660de5dedf91a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ouK9XR4xuNWtCes-TIUNAw.png"/></div></a></figure></div></div>    
</body>
</html>