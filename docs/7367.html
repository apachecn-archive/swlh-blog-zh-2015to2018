<html>
<head>
<title>Preparing a Wedding like an Android Developer — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">像Android开发者一样准备婚礼——第二部分</h1>
<blockquote>原文：<a href="https://medium.com/swlh/preparing-a-wedding-like-an-android-developer-part-2-7b6b1980160f?source=collection_archive---------17-----------------------#2018-11-06">https://medium.com/swlh/preparing-a-wedding-like-an-android-developer-part-2-7b6b1980160f?source=collection_archive---------17-----------------------#2018-11-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="8194" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<a class="ae jd" rel="noopener" href="/@marxallski/preparing-a-wedding-like-an-android-developer-part-1-758315073ab7">上一篇</a>上，我介绍了如何组织婚礼筹备的工具和一些技巧。在这一部分，我们将重点介绍<strong class="ih je"/><strong class="ih je">App</strong><strong class="ih je">架构</strong>。</p></div><div class="ab cl jf jg gp jh" role="separator"><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk"/></div><div class="hb hc hd he hf"><h1 id="4771" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">功能</h1><p id="53ca" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">我们想要的不仅仅是一个是/否应用程序。首先，我们定义了应用程序中的主要高级功能:</p><ul class=""><li id="e02a" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated">个性化登录</li><li id="e7bc" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">邀请主屏幕</li><li id="d0bf" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">邀请响应</li><li id="2495" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">信息(位置、日程、如何到达等。)</li><li id="4d39" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">留言板</li></ul><h1 id="11a3" class="jm jn hi bd jo jp ld jr js jt le jv jw jx lf jz ka kb lg kd ke kf lh kh ki kj bi translated">制约因素</h1><p id="faba" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">我们需要解决几个制约因素。</p><ul class=""><li id="9b01" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated">该应用程序将由我们的客人专用。</li><li id="125c" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">它应该很容易安装和打开。</li><li id="50a7" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">年轻一代和老一代都将使用它。</li><li id="9149" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">我来自巴塞罗那，我的妻子来自德国。因此，我们需要两种语言。(加泰罗尼亚语和德语)</li><li id="e023" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">一些信息尚未修复，所以我们应该能够改变内容，而不需要人们更新应用程序。</li></ul><h1 id="765b" class="jm jn hi bd jo jp ld jr js jt le jv jw jx lf jz ka kb lg kd ke kf lh kh ki kj bi translated">建筑</h1><p id="83d9" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">在确定了高级特性和约束之后，我开始设计架构草案。</p><ul class=""><li id="f3a8" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated">100%科特林</li><li id="4c28" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">使用新的Android架构组件(ViewModel、LiveData等)</li><li id="36dc" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">Firebase实时数据库</li><li id="d8f8" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">Firebase认证</li><li id="e6e6" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">Firebase动态链接</li></ul><h2 id="f2f1" class="li jn hi bd jo lj lk ll js lm ln lo jw iq lp lq ka iu lr ls ke iy lt lu ki lv bi translated">被动</h2><p id="84ba" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">主要思想是使用Firebase将架构组件与反应性概念结合起来。</p><figure class="lx ly lz ma fd mb er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es lw"><img src="../Images/40553f0548ca15919176fa3a2220e975.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aDiPnfKAgr_ya5WWgXpXLw.png"/></div></div></figure><p id="eb81" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上图显示了不同组件之间的流动和交互。我们来分解一下。</p><ol class=""><li id="f2c9" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc mi kv kw kx bi translated"><strong class="ih je">片段</strong>是被动的，它们观察<strong class="ih je">ViewModel</strong>T12】资源。</li><li id="47b6" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc mi kv kw kx bi translated"><strong class="ih je">视图模型</strong>观察一个或多个<strong class="ih je">资源库</strong>资源。</li><li id="ff6f" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc mi kv kw kx bi translated"><strong class="ih je">库</strong>处理<strong class="ih je"> Firebase LiveData资源</strong>的创建和缓存。</li><li id="b880" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc mi kv kw kx bi translated"><strong class="ih je"> Firebase LiveData资源</strong>是一个对象，它扩展了<strong class="ih je"> LiveData </strong>并添加或删除了给定<strong class="ih je"> Firebase数据库引用</strong>的监听器。</li><li id="3006" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc mi kv kw kx bi translated">当<strong class="ih je">数据</strong>改变时，该改变被转发给观察者</li><li id="84a9" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc mi kv kw kx bi translated">如果需要的话，<strong class="ih je">视图模型</strong>将转换资源，并将其交付给<strong class="ih je">片段</strong></li><li id="2082" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc mi kv kw kx bi translated"><strong class="ih je">片段</strong>最终将给定的资源应用于视图。</li></ol><p id="3ecc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个设置中最关键的元素是<strong class="ih je"> FirebaseLiveData </strong>，让我们仔细看看:</p><figure class="lx ly lz ma fd mb"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="10e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一个简单的职业，但是有<em class="ml">【超能力】</em>。我为什么这么说？因为下面的这个类处理以下内容:</p><ul class=""><li id="fe79" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated">网络层。</li><li id="60d8" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">解析实体。</li><li id="5493" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">没有附加观察器时释放资源。</li><li id="5d4e" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">保持资源的状态(加载、错误、完成)。</li><li id="3cca" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">离线同步。</li><li id="7d38" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">反应性变化。当本地或远程发生变化时，观察者会得到通知。</li></ul><p id="7f90" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有这一切，都要感谢<strong class="ih je"> LiveData </strong>和<strong class="ih je"> Firebase Realtime </strong> <strong class="ih je">数据库</strong>的结合，让这个设置<em class="ml">变得“反应式”。</em></p><h2 id="bca4" class="li jn hi bd jo lj lk ll js lm ln lo jw iq lp lq ka iu lr ls ke iy lt lu ki lv bi translated">主页</h2><p id="d836" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">为了展示上述概念，我们将看看主页。</p><figure class="lx ly lz ma fd mb"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="24b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih je"> HomeRepo </strong>提供了一个获取<strong class="ih je">主页</strong>资源LiveData的公共方法。<strong class="ih je">主页</strong>是一个简单的数据类，带有显示UI所需的字段。</p><p id="d0ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在资源库内部，我们使用<strong class="ih je"> UserRepo </strong>来获取用户的语言，并创建我们的<strong class="ih je"> FirebaseLiveData </strong>，它将基于给定的语言提供主页资源。</p><p id="2dbf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们构建数据实体的方式是视图可以直接使用它们来显示UI(不是在所有地方，而是在大多数屏幕中)。因此，在这种情况下，视图模型只是转发资源。</p><pre class="lx ly lz ma fd mm mn mo mp aw mq bi"><span id="2c9b" class="li jn hi mn b fi mr ms l mt mu">class HomeViewModel(repository: HomeRepo) : ViewModel() {<br/>    <br/>    val homePage: LiveData&lt;Resource&lt;HomePage&gt;&gt; by <em class="ml">lazy </em><strong class="mn je">{<br/>        </strong>repository.getHomePage()<br/>    <strong class="mn je">}<br/></strong>}</span></pre><p id="38ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们只需要实现视图端。在这种情况下，<strong class="ih je"> HomeFragment </strong>负责观察<strong class="ih je"> ViewModel </strong>资源并更新视图元素。</p><figure class="lx ly lz ma fd mb"><div class="bz dy l di"><div class="mj mk l"/></div></figure><h1 id="255d" class="jm jn hi bd jo jp ld jr js jt le jv jw jx lf jz ka kb lg kd ke kf lh kh ki kj bi translated">显示优点的东西</h1><p id="26ab" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">在下面的gif中，左侧是Firebase数据库控制台，右侧是主页中的应用程序。每次我们改变一个值，不到一秒钟就会反映在我们的应用程序中。</p><figure class="lx ly lz ma fd mb er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es mv"><img src="../Images/0c3769274f25e636cf232174dded817e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*naOOawn3P0YBBKN1gHTLqA.gif"/></div></div></figure><p id="2d3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这允许我们在运行时修改整个应用程序的任何值，不需要更新，不需要硬编码的值。</p><p id="7152" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最重要的是，我们将Firebase设置为离线工作，这样一旦用户至少打开一次屏幕，它就不再需要网络来工作了。</p><pre class="lx ly lz ma fd mm mn mo mp aw mq bi"><span id="226b" class="li jn hi mn b fi mr ms l mt mu">val instance = FirebaseDatabase.getInstance().<em class="ml">apply </em><strong class="mn je">{<br/></strong>    setPersistenceEnabled(true)<br/>}</span></pre></div><div class="ab cl jf jg gp jh" role="separator"><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk"/></div><div class="hb hc hd he hf"><p id="f638" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下一篇文章中，我们将解决客人登机的问题，敬请关注！</p><figure class="lx ly lz ma fd mb er es paragraph-image"><a href="https://medium.com/swlh"><div class="er es mw"><img src="../Images/308a8d84fb9b2fab43d66c117fcc4bb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YqDjlKFwScoQYQ62DWEdig.png"/></div></a></figure><h2 id="c148" class="li jn hi bd jo lj lk ll js lm ln lo jw iq lp lq ka iu lr ls ke iy lt lu ki lv bi translated">这篇文章发表在<a class="ae jd" href="https://medium.com/swlh" rel="noopener"> The Startup </a>上，这是Medium最大的创业刊物，拥有+385，976名读者。</h2><h2 id="869c" class="li jn hi bd jo lj lk ll js lm ln lo jw iq lp lq ka iu lr ls ke iy lt lu ki lv bi translated">在这里订阅接收<a class="ae jd" href="http://growthsupply.com/the-startup-newsletter/" rel="noopener ugc nofollow" target="_blank">我们的头条新闻</a>。</h2><figure class="lx ly lz ma fd mb er es paragraph-image"><a href="https://medium.com/swlh"><div class="er es mw"><img src="../Images/b0164736ea17a63403e660de5dedf91a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ouK9XR4xuNWtCes-TIUNAw.png"/></div></a></figure></div></div>    
</body>
</html>