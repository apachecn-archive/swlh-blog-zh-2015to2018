<html>
<head>
<title>Dynamic AppEngine Configurations using Gradle Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Gradle的动态AppEngine配置第1部分</h1>
<blockquote>原文：<a href="https://medium.com/swlh/dynamic-appengine-configurations-using-gradle-part-1-e3959a39f31b?source=collection_archive---------11-----------------------#2018-11-13">https://medium.com/swlh/dynamic-appengine-configurations-using-gradle-part-1-e3959a39f31b?source=collection_archive---------11-----------------------#2018-11-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/35bbcd602ee3af9fef85951eb7a59ee9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QpQSiQBKj4qaoJHOTYI2rg.jpeg"/></div></div></figure><div class=""/><p id="fa9f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当使用AppEngine应用程序时，我们经常需要使用<a class="ae jo" href="https://cloud.google.com/appengine/docs/standard/java/configuration-files" rel="noopener ugc nofollow" target="_blank">配置文件</a>，如<a class="ae jo" href="https://cloud.google.com/appengine/docs/standard/java/config/appref" rel="noopener ugc nofollow" target="_blank"> appengine-web.xml </a>、<a class="ae jo" href="https://cloud.google.com/appengine/docs/standard/java/config/cronref" rel="noopener ugc nofollow" target="_blank"> cron.xml </a>、<a class="ae jo" href="https://cloud.google.com/appengine/docs/standard/java/reference/dispatch-xml" rel="noopener ugc nofollow" target="_blank"> dispatch.xml </a>等。此外，我们还需要应对多种环境，如试运行、alpha和生产环境。</p><p id="9478" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">问题是我们需要为每种环境配置不同的配置，例如，</p><ul class=""><li id="4469" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">在<strong class="is jy"> <em class="jz"> cron.xml </em> </strong>中，我们需要不同的配置来根据环境调度作业。例如:计划作业在分段中每两小时运行一次，在生产中每15分钟运行一次。</li><li id="a01a" class="jp jq ht is b it ka ix kb jb kc jf kd jj ke jn ju jv jw jx bi translated">在<strong class="is jy"> <em class="jz"> dispatch.xml </em> </strong>中，我们需要根据投产、生产等情况配置不同的路由规则。</li></ul><p id="7e44" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">同样，我们可能有几个理由让每个环境有不同的配置。在这一系列文章中，我们将探讨如何使用Gradle为每个环境设置这些配置。让我们开始吧。</p><p id="2b36" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is jy">注意:</strong>如果你想了解更多关于如何使用Gradle设置AppEngine的信息，请查看我的另一篇文章<a class="ae jo" rel="noopener" href="/@rameshlingappa/multi-module-projects-with-google-appengine-and-intellij-b3b2bc271bb1">使用AppEngine和Gradle的多模块项目</a></p></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><h1 id="015b" class="km kn ht bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">动态部署配置</h1><p id="608a" class="pw-post-body-paragraph iq ir ht is b it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn hb bi translated">在本文中，我们将介绍如何使用动态部署配置来执行appengine部署</p><p id="1a45" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当您通过Gradle<a class="ae jo" href="https://cloud.google.com/appengine/docs/flexible/java/gradle-reference#appenginedeploy" rel="noopener ugc nofollow" target="_blank"><strong class="is jy">appengine deploy</strong></a><strong class="is jy"/>任务执行app engine部署(<em class="jz"> gcloud app deploy </em>)时，我们需要每个环境的以下信息:</p><figure class="lq lr ls lt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lp"><img src="../Images/e3203ad5acb2e6827249335cd5b34834.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z9yu697UAkshLCM60IcvJA.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx">appengineDeploy task properties</figcaption></figure><p id="f6e6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将在<a class="ae jo" href="https://docs.gradle.org/current/userguide/command_line_interface.html#environment_options" rel="noopener ugc nofollow" target="_blank"> Gradle项目属性</a>的帮助下实现这一目标</p><blockquote class="ly lz ma"><p id="6b7e" class="iq ir jz is b it iu iv iw ix iy iz ja mb jc jd je mc jg jh ji md jk jl jm jn hb bi translated"><code class="du me mf mg mh b"><strong class="is jy"><em class="ht">-P</em></strong></code>、<code class="du me mf mg mh b"><strong class="is jy"><em class="ht">--project-prop<br/></em></strong></code>设置根项目的项目属性，例如<code class="du me mf mg mh b"><em class="ht">-Pmyprop=myvalue</em></code></p></blockquote><p id="d837" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，我们将为不同的环境部署传递一个名为<strong class="is jy"> mode </strong>的属性，其值如下。</p><blockquote class="ly lz ma"><p id="40ee" class="iq ir jz is b it iu iv iw ix iy iz ja mb jc jd je mc jg jh ji md jk jl jm jn hb bi translated"><code class="du me mf mg mh b"><strong class="is jy"><em class="ht">-Pmode=staging</em></strong></code>代表<strong class="is jy">集结</strong>部署<br/>T1】代表<strong class="is jy">阿尔法</strong>部署<br/>代表<strong class="is jy">直播</strong>部署</p></blockquote><p id="4bd8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">基于模式值，我们可以为部署属性设置不同的值，如下所示:</p><figure class="lq lr ls lt fd hk"><div class="bz dy l di"><div class="mi mj l"/></div><figcaption class="lu lv et er es lw lx bd b be z dx">deploy config based on mode property</figcaption></figure><p id="7523" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这就是我们正在做的，</p><ul class=""><li id="d2d0" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">在<strong class="is jy"> gaeVersions </strong>属性中，我们为每个目标环境设置了不同的版本号，这些值可以在我们需要部署到新版本时更新</li><li id="0481" class="jp jq ht is b it ka ix kb jb kc jf kd jj ke jn ju jv jw jx bi translated">在<strong class="is jy"> getDeployConfig() </strong>方法中，基于<strong class="is jy">模式</strong>值，我们正在设置不同的项目ID、版本和升级选项。默认情况下，模式为<em class="jz">分段</em>。</li></ul><p id="2c54" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以从appengine部署配置部分调用该方法，如下所示:</p><figure class="lq lr ls lt fd hk"><div class="bz dy l di"><div class="mi mj l"/></div><figcaption class="lu lv et er es lw lx bd b be z dx">appenigneDeploy task config using mode</figcaption></figure><p id="5feb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如您所见，所有部署配置都是使用从<strong class="is jy"> getDeployConfig() </strong>方法返回的配置字典设置的。</p><p id="be08" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，我们现在可以用一个简单的Gradle命令部署到多个环境中，</p><p id="f991" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">用于暂存:<code class="du me mf mg mh b">gradle appengineDeploy -Pmode=staging</code></p><p id="4453" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于阿尔法:<code class="du me mf mg mh b">gradle appengineDeploy -Pmode=alpha</code></p><p id="187d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">用于生产:<code class="du me mf mg mh b">gradle appengineDeploy -Pmode=live</code></p><p id="5359" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您使用IntelliJ，您也可以像下面这样设置运行配置，</p><figure class="lq lr ls lt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mk"><img src="../Images/c8a857993a2ecc9c0e81903eb620f2db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XRNu-hhLa9opvkLVrDYaLw.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx">deploy Run Configuration for each environment</figcaption></figure><p id="c31e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如需完整示例，请查看GitHub中的演示应用程序，<a class="ae jo" href="https://github.com/ramesh-dev/gae-dynamic-config-demo" rel="noopener ugc nofollow" target="_blank">单击此处</a></p><h2 id="b76b" class="ml kn ht bd ko mm mn mo ks mp mq mr kw jb ms mt la jf mu mv le jj mw mx li my bi translated">结论</h2><p id="4e08" class="pw-post-body-paragraph iq ir ht is b it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn hb bi translated">感谢您的阅读，希望这有所帮助。在接下来的文章中，我们将探讨如何基于环境创建动态配置文件。</p><p id="555c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is jy"> <em class="jz">敬请期待，快乐编码……</em></strong></p><figure class="lq lr ls lt fd hk er es paragraph-image"><a href="https://medium.com/swlh"><div class="er es mz"><img src="../Images/308a8d84fb9b2fab43d66c117fcc4bb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YqDjlKFwScoQYQ62DWEdig.png"/></div></a></figure><h2 id="c148" class="ml kn ht bd ko mm mn mo ks mp mq mr kw jb ms mt la jf mu mv le jj mw mx li my bi translated">这篇文章发表在<a class="ae jo" href="https://medium.com/swlh" rel="noopener"> The Startup </a>上，这是Medium最大的创业刊物，拥有+388，268名读者。</h2><h2 id="869c" class="ml kn ht bd ko mm mn mo ks mp mq mr kw jb ms mt la jf mu mv le jj mw mx li my bi translated">在这里订阅接收<a class="ae jo" href="http://growthsupply.com/the-startup-newsletter/" rel="noopener ugc nofollow" target="_blank">我们的头条新闻</a>。</h2><figure class="lq lr ls lt fd hk er es paragraph-image"><a href="https://medium.com/swlh"><div class="er es mz"><img src="../Images/b0164736ea17a63403e660de5dedf91a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ouK9XR4xuNWtCes-TIUNAw.png"/></div></a></figure></div></div>    
</body>
</html>