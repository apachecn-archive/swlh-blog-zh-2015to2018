<html>
<head>
<title>An audit logging framework for Relational databases.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关系数据库的审计日志框架。</h1>
<blockquote>原文：<a href="https://medium.com/swlh/an-audit-logging-framework-for-relational-databases-f902550cd849?source=collection_archive---------4-----------------------#2018-09-29">https://medium.com/swlh/an-audit-logging-framework-for-relational-databases-f902550cd849?source=collection_archive---------4-----------------------#2018-09-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="55ec" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">我刚刚用MongoDB和Kafka在nodejs中为关系数据库编写了一个审计日志框架。卡夫卡被用来提供存储的可扩展性和MongoDB。我正在使用<strong class="il jh">卡夫卡节点</strong>和<strong class="il jh">猫鼬</strong>分别访问卡夫卡和蒙哥数据库。项目在此<a class="ae ji" href="https://github.com/varunon9/audit-logging-framework" rel="noopener ugc nofollow" target="_blank">https://github.com/varunon9/audit-logging-framework</a>。在这个博客中，我将展示它的用法。</p></blockquote><h2 id="1566" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">要求-</h2><p id="8e61" class="pw-post-body-paragraph ii ij hi il b im kh io ip iq ki is it ju kj iw ix jy kk ja jb kc kl je jf jg hb bi translated">我在我的项目中使用MySql数据库。我希望对我的表执行所有创建和更新操作的审计日志记录。</p><h2 id="48ca" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">安装审计日志框架-</h2><p id="45c8" class="pw-post-body-paragraph ii ij hi il b im kh io ip iq ki is it ju kj iw ix jy kk ja jb kc kl je jf jg hb bi translated">前往<a class="ae ji" href="https://github.com/varunon9/audit-logging-framework" rel="noopener ugc nofollow" target="_blank">https://github.com/varunon9/audit-logging-framework</a>建立项目。你将不得不安装卡夫卡，蒙戈和nodejs。完成后，您可以继续学习本教程。</p><h2 id="44a1" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">MySql数据库架构-</h2><p id="8a30" class="pw-post-body-paragraph ii ij hi il b im kh io ip iq ki is it ju kj iw ix jy kk ja jb kc kl je jf jg hb bi translated">假设我们的数据库中有一个名为<em class="ik">学生</em>的表，我们想记录这个表的创建和更新操作。模式看起来像-</p><figure class="kn ko kp kq fd kr er es paragraph-image"><div class="er es km"><img src="../Images/4ee3f4eee9b81d9596f97a30bda249a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/1*n5rLorTeVqPdcx343udpag.png"/></div><figcaption class="ku kv et er es kw kx bd b be z dx">MySql database schema</figcaption></figure><p id="9c77" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jy iz ja jb kc jd je jf jg hb bi translated">为了简洁起见，这里只有一张桌子。在现实世界中，您会有多个表。要使用审核日志框架，您需要为所有表分配一个唯一的id。审核日志框架接受两个强制参数-</p><ol class=""><li id="e7ab" class="ky kz hi il b im in iq ir ju la jy lb kc lc jg ld le lf lg bi translated">tableId(对于表来说是唯一的)</li><li id="56d0" class="ky kz hi il b im lh iq li ju lj jy lk kc ll jg ld le lf lg bi translated">行标识(在表中是唯一的，可以使用标识字段)</li></ol><h2 id="6ce8" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">记录创建操作-</h2><p id="bd7b" class="pw-post-body-paragraph ii ij hi il b im kh io ip iq ki is it ju kj iw ix jy kk ja jb kc kl je jf jg hb bi translated">让我们在学生表中插入第一条记录。在现实世界中，您会编写API来对表执行操作。您需要将审计日志框架API与您的控制器/服务类集成。步骤应该是这样的-</p><ol class=""><li id="52c0" class="ky kz hi il b im in iq ir ju la jy lb kc lc jg ld le lf lg bi translated">您收到一个HTTP请求，要求在<em class="ik">学生</em>表中创建一条新记录</li><li id="ef36" class="ky kz hi il b im lh iq li ju lj jy lk kc ll jg ld le lf lg bi translated">在执行数据库操作之前，您从行中获取<strong class="il jh">旧数据</strong>。因为我们正在插入一条新记录，所以<strong class="il jh">旧数据</strong>将是{}(空对象)。</li><li id="e485" class="ky kz hi il b im lh iq li ju lj jy lk kc ll jg ld le lf lg bi translated">您对数据库执行写操作。该新插入的数据将为<strong class="il jh">新数据</strong>。如果操作成功，您点击审核日志框架api，POST<a class="ae ji" href="http://localhost:5000/auditLog" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/audit log</a>类似如下-</li></ol><figure class="kn ko kp kq fd kr er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es lm"><img src="../Images/e0b0623a1feaf27a9bbccd04cb15e229.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*az0nHoOo_fD5HLPLX5Ogmw.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx">audit-log for create operation</figcaption></figure><p id="f9a4" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jy iz ja jb kc jd je jf jg hb bi translated">4.这里<em class="ik">用户</em>是执行该操作的用户详细信息(可选)；<em class="ik">IP地址</em>是客户端的IP地址(可选)；<em class="ik">杂项</em>是您想要与审核日志一起捕获的任何其他信息(可选)。</p><h2 id="3e41" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">记录更新操作-</h2><p id="5816" class="pw-post-body-paragraph ii ij hi il b im kh io ip iq ki is it ju kj iw ix jy kk ja jb kc kl je jf jg hb bi translated">现在假设<em class="ik">学生</em>在保存年龄详细信息时出错，他用新的年龄值= 23更新了他的个人资料。</p><ol class=""><li id="81db" class="ky kz hi il b im in iq ir ju la jy lb kc lc jg ld le lf lg bi translated">现在<strong class="il jh">旧数据</strong>将是当前数据，即<br/> {"id": 1，" rollNo": 1130328，"名字:" " Varun "，"姓氏:" " Kumar "，"年龄":22，"性别:" " M"}</li><li id="881e" class="ky kz hi il b im lh iq li ju lj jy lk kc ll jg ld le lf lg bi translated"><strong class="il jh"> newData </strong>将会是<br/> {"id": 1，" rollNo": 1130328，" firstName": "Varun "，" lastName": "Kumar "，" age": 23，" gender": "M"} <br/>注意，年龄现在是23</li><li id="7902" class="ky kz hi il b im lh iq li ju lj jy lk kc ll jg ld le lf lg bi translated">您再次点击POST<a class="ae ji" href="http://localhost:5000/auditLog" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/audit log</a>类似这样的内容-</li></ol><figure class="kn ko kp kq fd kr er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es lr"><img src="../Images/c71eae33545dcad317891d560acd7674.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N_zWj1N6sTU2pJF3cobjyw.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx">audit-log for update operation</figcaption></figure><h2 id="2f8a" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">正在获取审核日志详细信息-</h2><p id="8fa9" class="pw-post-body-paragraph ii ij hi il b im kh io ip iq ki is it ju kj iw ix jy kk ja jb kc kl je jf jg hb bi translated">要获取给定的<strong class="il jh"> tableId </strong>和<strong class="il jh"> rowId </strong>的审计日志，您可以向<a class="ae ji" href="http://localhost:5000/auditLog" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/audit log</a>发出类似这样的get请求(<em class="ik"> count </em>即默认情况下日志数为5)</p><figure class="kn ko kp kq fd kr er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es ls"><img src="../Images/89dd0258cb8aa2a895f8c673b2421b22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3O76e01VYBKlMzmBZCD86w.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx">get audit-logs for a particular row inside given table</figcaption></figure><h2 id="4374" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated"><strong class="ak">结论- </strong></h2><p id="96d5" class="pw-post-body-paragraph ii ij hi il b im kh io ip iq ki is it ju kj iw ix jy kk ja jb kc kl je jf jg hb bi translated">我还没有大规模测试这个框架，但是这个简单的框架可以作为审计日志记录的良好起点。要调试问题，您可以检查日志目录中的日志。对于建议或问题，请在<a class="ae ji" href="https://github.com/varunon9/audit-logging-framework/issues" rel="noopener ugc nofollow" target="_blank">https://github.com/varunon9/audit-logging-framework/issues</a>创建github问题。</p><p id="cf8b" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jy iz ja jb kc jd je jf jg hb bi translated">感谢阅读(或只是滚动):D</p><figure class="kn ko kp kq fd kr er es paragraph-image"><a href="https://medium.com/swlh"><div class="er es lt"><img src="../Images/308a8d84fb9b2fab43d66c117fcc4bb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YqDjlKFwScoQYQ62DWEdig.png"/></div></a></figure><h2 id="c148" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">这篇文章发表在<a class="ae ji" href="https://medium.com/swlh" rel="noopener">的《创业》(The Startup </a>)上，这是Medium最大的创业刊物，拥有+427，678读者。</h2><h2 id="869c" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">在这里订阅接收<a class="ae ji" href="https://growthsupply.com/the-startup-newsletter/" rel="noopener ugc nofollow" target="_blank">我们的头条新闻</a>。</h2><figure class="kn ko kp kq fd kr er es paragraph-image"><a href="https://medium.com/swlh"><div class="er es lt"><img src="../Images/b0164736ea17a63403e660de5dedf91a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ouK9XR4xuNWtCes-TIUNAw.png"/></div></a></figure></div></div>    
</body>
</html>