<html>
<head>
<title>How to run GPU accelerated Signal Processing in TensorFlow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在TensorFlow中运行GPU加速信号处理</h1>
<blockquote>原文：<a href="https://medium.com/swlh/how-to-run-gpu-accelerated-signal-processing-in-tensorflow-13e1633f4bfb?source=collection_archive---------0-----------------------#2018-10-28">https://medium.com/swlh/how-to-run-gpu-accelerated-signal-processing-in-tensorflow-13e1633f4bfb?source=collection_archive---------0-----------------------#2018-10-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/16cd0a0e57685bf90288e56dea598e8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Em74V5YkBjo74sfp.png"/></div></div></figure><p id="05f1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在TensorFlow框架的深处存在一个很少被注意到的模块:<a class="ae jo" href="https://www.tensorflow.org/api_docs/python/tf/contrib/signal" rel="noopener ugc nofollow" target="_blank"> tf.contrib.signal </a>，它可以帮助为你的TensorFlow/Keras模型构建GPU加速的音频/信号处理管道。在本帖中，我们将采用一种实用的方法来检验一些最流行的信号处理操作，并将结果可视化。</p><h1 id="9143" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">你可以在<a class="ae jo" href="https://github.com/Tony607/tf_audio_signal" rel="noopener ugc nofollow" target="_blank"> my GitHub </a>上找到这篇文章的源代码，以及一个可运行的<a class="ae jo" href="https://colab.research.google.com/drive/1Adcy25HYC4c9uSBDK9q5_glR246m-TSx" rel="noopener ugc nofollow" target="_blank"> Google Colab笔记本</a>。</h1><h1 id="f3e3" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">开始</h1><p id="085d" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">我们将在TensorFlow中构建一个完整的计算图，它采用wav文件名并输出MFCC特征。有一些中间输出/音频特性可能很有趣，因此我们将启用TensorFlow eager execution，它允许我们立即评估操作，而无需构建完整的图形。如果你是第一次接触TensorFlow eager execution，你会发现它比graph API更直观。</p><p id="c380" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面的代码片段将带您开始TensorFlow中的热切执行。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div></figure><h1 id="0566" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">解码WAV文件</h1><p id="a36c" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated"><code class="du ky kz la lb b">tf.contrib.ffmpeg.decode_audio</code>依赖于本地安装的FFmpeg库来解码音频文件。</p><p id="674f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要在基于Linux的系统上安装FFmpeg，请运行以下命令。</p><pre class="ks kt ku kv fd lc lb ld le aw lf bi"><span id="85c9" class="lg jq hi lb b fi lh li l lj lk">apt update -qq<br/>apt install -y -qq ffmpeg<br/>ffmpeg -version</span></pre><p id="9b8e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">之后，我们可以下载一个小样本的警笛声wav文件，用TensorFlow解码。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div></figure><p id="3d52" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ky kz la lb b">waveform</code>是一个张量，在急切执行的帮助下，我们可以立即评估它的值并将其可视化。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div></figure><figure class="ks kt ku kv fd ij er es paragraph-image"><div class="er es ll"><img src="../Images/581803e32a12c1875fcc44e9b4265728.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/0*BZszH-M8rdZEQ1fa.png"/></div><figcaption class="lm ln et er es lo lp bd b be z dx">A section of the waveform</figcaption></figure><p id="56bb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从原始波形中，我们几乎看不到任何警报声的特征，加上可能有太多的数据直接输入神经网络。接下来的几个步骤将提取音频信号的频域签名。</p><p id="0c19" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="lq">Declaimer:Windows不支持用</em> <code class="du ky kz la lb b"><em class="lq">tf.contrib.ffmpeg</em></code> <em class="lq">解码音频文件。</em> <a class="ae jo" href="https://github.com/tensorflow/tensorflow/issues/8271" rel="noopener ugc nofollow" target="_blank"> <em class="lq">指https://github.com/tensorflow/tensorflow/issues/8271</em></a><em class="lq">。</em></p><p id="e9c1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Windows上的另一种方法是用scipy解码wav文件。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div></figure><h1 id="7acd" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">计算光谱图</h1><p id="7135" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">光谱图新手？看看酷的<a class="ae jo" href="https://musiclab.chromeexperiments.com/Spectrogram/" rel="noopener ugc nofollow" target="_blank"> Chrome音乐实验室实验</a>将你的声音实时可视化为频谱图。</p><p id="4131" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">计算光谱图最常用的方法是采用STFT(短时傅立叶变换)的幅度。</p><p id="7ee4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">任何音频波形都可以用不同频率、相位和幅度的正弦波的组合来表示。当信号随时间变化时，STFT可以确定信号本地部分的正弦频率和相位内容。</p><p id="b37a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ky kz la lb b">tf.contrib.signal.stft</code>计算<code class="du ky kz la lb b">signals</code>的STFT。该操作接受一个形状为<strong class="is lr"> <em class="lq">(批量大小，样本)</em> </strong>的张量“信号”。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div></figure><p id="2d03" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ky kz la lb b">stfts</code>张量具有<strong class="is lr"> <em class="lq"> (batch_size，frames，fft_unique_bins) </em> </strong>的形状，每个值包含一个具有实部和虚部的<code class="du ky kz la lb b"><em class="lq">a</em> + <em class="lq">bi </em></code>形式的复数。</p><p id="fa65" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">能谱图是复值STFT的大小，即<code class="du ky kz la lb b">sqrt{a^2 + b^2}</code>。</p><p id="0f7f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在TensorFlow中，它可以简单地计算为:</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div></figure><p id="4f8d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以绘制能量谱图，我们可以发现图像顶部显示的一些模式，其中频率上下波动，类似于警笛声音的音高变化。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div></figure><figure class="ks kt ku kv fd ij er es paragraph-image"><div class="er es ls"><img src="../Images/55574f3aabd57704faad9c0ff5ceb40c.png" data-original-src="https://miro.medium.com/v2/resize:fit:178/format:webp/0*eCFqyutickuiVrSg.png"/></div><figcaption class="lm ln et er es lo lp bd b be z dx">Magnitude spectrograms</figcaption></figure><h1 id="a7c2" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">计算梅尔频率倒谱系数</h1><p id="6248" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">如你所见，在计算出的能量谱图中有513个频率组，许多是“空白”的。当处理音频的频谱表示时，Mel频率倒谱系数(MFCCs)被广泛用于自动语音和说话人识别，这导致音频的较低维度和更感知相关的表示。</p><p id="2a6d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以在TensorFlow中将能量/星等谱图转换为Mel谱图，并像这样绘制其结果。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div></figure><p id="2447" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果需要，我们可以指定Mel频谱中包含的频率的下限和上限。</p><p id="15e3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ky kz la lb b"><strong class="is lr">num_mel_bins</strong></code>指定生成的Mel光谱中有多少个波段。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div class="er es lt"><img src="../Images/d0688f46db1a0091956683fe6ed72e33.png" data-original-src="https://miro.medium.com/v2/resize:fit:734/format:webp/0*8MI8oJ7Gm3qqk8zA.png"/></div><figcaption class="lm ln et er es lo lp bd b be z dx">Mel-spectrograms</figcaption></figure><p id="04e6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要进一步压缩Mel频谱幅度，您可以应用压缩非线性，如对数压缩，这有助于平衡频谱的低能量和高能量区域中细节的重要性，这更符合人类的听觉灵敏度。</p><p id="66b1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ky kz la lb b">log_offset</code>是一个小数字，用于避免在极少数情况下将<strong class="is lr"> log() </strong>应用于零。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div></figure><figure class="ks kt ku kv fd ij er es paragraph-image"><div class="er es lt"><img src="../Images/e3f057563fde2bcaa0efa3a10794a394.png" data-original-src="https://miro.medium.com/v2/resize:fit:734/format:webp/0*2jtbiEBEGaM7wHKD.png"/></div><figcaption class="lm ln et er es lo lp bd b be z dx">Log mel spectrograms</figcaption></figure><p id="306e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后一步，<code class="du ky kz la lb b"><a class="ae jo" href="https://www.tensorflow.org/api_docs/python/tf/contrib/signal/mfccs_from_log_mel_spectrograms" rel="noopener ugc nofollow" target="_blank">tf.contrib.signal.mfccs_from_log_mel_spectrograms</a></code>根据<code class="du ky kz la lb b">log_mel_spectrograms</code>计算<a class="ae jo" href="https://en.wikipedia.org/wiki/Mel-frequency_cepstrum" rel="noopener ugc nofollow" target="_blank">MFCC</a>。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div></figure><figure class="ks kt ku kv fd ij er es paragraph-image"><div class="er es lt"><img src="../Images/dd1f8b4983b05c32b911f1a21c316205.png" data-original-src="https://miro.medium.com/v2/resize:fit:734/format:webp/0*xqZkh0iJ5AMJtUSh.png"/></div><figcaption class="lm ln et er es lo lp bd b be z dx">MFCCs</figcaption></figure><h1 id="256e" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">一起构建一切</h1><p id="a3be" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">将所有内容放入TensorFlow管道中。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div></figure><h1 id="8685" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结论和进一步阅读</h1><p id="086a" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">在这篇文章中，我们介绍了如何在TensorFlow中进行GPU支持的信号处理。我们走过了从解码WAV文件到计算波形的MFCCs特征的每一步。构建最终管道，您可以应用到现有的TensorFlow/Keras模型，以制作端到端的音频处理计算图。</p><h2 id="2c53" class="lg jq hi bd jr lu lv lw jv lx ly lz jz jb ma mb kd jf mc md kh jj me mf kl mg bi translated">一些可能对你有帮助的相关资源。</h2><p id="3e30" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated"><a class="ae jo" href="http://practicalcryptography.com/miscellaneous/machine-learning/guide-mel-frequency-cepstral-coefficients-mfccs/" rel="noopener ugc nofollow" target="_blank">梅尔频率倒谱系数(MFCC)教程</a></p><p id="2bc4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://musiclab.chromeexperiments.com/Spectrogram/" rel="noopener ugc nofollow" target="_blank"> Chrome音乐实验室声谱图实验</a></p><p id="67b9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://github.com/Tony607/tf_audio_signal" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上这篇文章的源代码。</p><p id="5bb3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://twitter.com/intent/tweet?url=https%3A//www.dlology.com/blog/how-to-run-gpu-accelerated-signal-processing-in-tensorflow/&amp;text=How%20to%20run%20GPU%20accelerated%20Signal%20Processing%20in%20TensorFlow" rel="noopener ugc nofollow" target="_blank">在Twitter上分享</a> <a class="ae jo" href="https://www.facebook.com/sharer/sharer.php?u=https://www.dlology.com/blog/how-to-run-gpu-accelerated-signal-processing-in-tensorflow/" rel="noopener ugc nofollow" target="_blank">在脸书分享</a></p></div><div class="ab cl mh mi gp mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="hb hc hd he hf"><p id="b602" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="lq">原载于</em><a class="ae jo" href="https://www.dlology.com/blog/how-to-run-gpu-accelerated-signal-processing-in-tensorflow/" rel="noopener ugc nofollow" target="_blank"><em class="lq">www.dlology.com</em></a><em class="lq">。</em></p><figure class="ks kt ku kv fd ij er es paragraph-image"><a href="https://medium.com/swlh"><div class="er es mo"><img src="../Images/308a8d84fb9b2fab43d66c117fcc4bb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YqDjlKFwScoQYQ62DWEdig.png"/></div></a></figure><h2 id="c148" class="lg jq hi bd jr lu lv lw jv lx ly lz jz jb ma mb kd jf mc md kh jj me mf kl mg bi translated">这篇文章发表在<a class="ae jo" href="https://medium.com/swlh" rel="noopener"> The Startup </a>上，这是Medium最大的创业刊物，拥有+383，380名读者。</h2><h2 id="869c" class="lg jq hi bd jr lu lv lw jv lx ly lz jz jb ma mb kd jf mc md kh jj me mf kl mg bi translated">在这里订阅接收<a class="ae jo" href="http://growthsupply.com/the-startup-newsletter/" rel="noopener ugc nofollow" target="_blank">我们的头条新闻</a>。</h2><figure class="ks kt ku kv fd ij er es paragraph-image"><a href="https://medium.com/swlh"><div class="er es mo"><img src="../Images/b0164736ea17a63403e660de5dedf91a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ouK9XR4xuNWtCes-TIUNAw.png"/></div></a></figure></div></div>    
</body>
</html>