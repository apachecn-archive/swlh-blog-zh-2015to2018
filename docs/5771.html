<html>
<head>
<title>Email development with React and Webpack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React和Webpack开发电子邮件</h1>
<blockquote>原文：<a href="https://medium.com/swlh/email-development-with-react-and-webpack-3f1639b5effa?source=collection_archive---------2-----------------------#2018-07-29">https://medium.com/swlh/email-development-with-react-and-webpack-3f1639b5effa?source=collection_archive---------2-----------------------#2018-07-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/84da257122771e04e5f1d9b70725f986.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*885petuRk1orOmnU.jpg"/></div></div></figure><p id="3cf8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">由于大多数电子邮件客户强加的特性和限制，电子邮件开发通常是一个被忽视的实践。</p><p id="3406" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你想给你的产品带来愉快的用户体验，你必须确保你的产品设计在所有媒体上保持一致。</p><p id="4c90" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">电子邮件是最有可能消费你的产品的媒介之一。因此，在撰写电子邮件时，坚持在其他环境下开发产品时所遵循的设计原则是非常重要的。</p><p id="fd3a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然而，电子邮件世界有其自身的特殊性，电子邮件必须建立在其中的约束通常意味着设计上的妥协。</p><h2 id="2994" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">我个人的电子邮件开发经验</h2><p id="bee8" class="pw-post-body-paragraph iq ir hi is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">我最近参与的一个项目为产品提供了一个新的外观和感觉，但需要发送一封关于它的电子邮件。</p><p id="ac11" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们希望我们的电子邮件也能利用新的设计，理想情况下，还能利用我们已经为交付新UI而构建的工具和组件。</p><p id="4d3e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">出于这个原因，我们决定建立一个电子邮件开发管道来帮助我们实现这个目标。</p><p id="9441" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇博文中，我将重点介绍如何使用<a class="ae ko" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> React </a>和<a class="ae ko" href="https://webpack.js.org" rel="noopener ugc nofollow" target="_blank"> webpack </a>来构建HTML模板，并以电子邮件的形式发送出去。</p><p id="4e09" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">尽管我提到了<a class="ae ko" href="https://reactjs.org" rel="noopener ugc nofollow" target="_blank"> React </a>，但这个项目的关键在于<a class="ae ko" href="https://webpack.js.org" rel="noopener ugc nofollow" target="_blank"> webpack </a>是如何被配置成一个小型电子邮件开发环境的。我很确定同样的配置可以很容易地适应其他框架。</p><h2 id="d13e" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">制约因素</h2><p id="b7e7" class="pw-post-body-paragraph iq ir hi is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">这个项目必须允许我们在电子邮件开发中重用<a class="ae ko" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> React </a>组件。我们还希望对其进行结构化，以便允许多个电子邮件模板重用我们现有的组件库。</p><p id="70e3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，我们希望能够生成一个单独的HTML文件作为输出。</p><h2 id="d142" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">我们开始吧</h2><p id="c8cb" class="pw-post-body-paragraph iq ir hi is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">我在<a class="ae ko" href="https://github.com/alediaferia/blog-examples/tree/master/webpack-react-email" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上创建并推送了一个示例项目。不耐烦就去看看:)</p><h2 id="f9f1" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">项目结构</h2><p id="85e9" class="pw-post-body-paragraph iq ir hi is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">我们将通过一种方式构建项目，允许在同一个存储库中制作和托管多个电子邮件模板。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="6b3c" class="jo jp hi ku b fi ky kz l la lb">.<br/>├── output/<br/>├── package.json<br/>├── README.md<br/>├── src/<br/>│   ├── components/<br/>│   │   └── SectionOutline/<br/>│   │       ├── index.js<br/>│   │       └── index.scss<br/>│   ├── index.js<br/>│   └── templates/<br/>│       └── HelloWorld/<br/>│           ├── index.js<br/>│           ├── index.scss<br/>│           └── index.test.js<br/>├── webpack.config.js<br/>└── yarn.lock</span></pre><ul class=""><li id="7738" class="lc ld hi is b it iu ix iy jb le jf lf jj lg jn lh li lj lk bi translated"><code class="du ll lm ln ku b"><a class="ae ko" href="https://github.com/alediaferia/blog-examples/tree/master/webpack-react-email/src/templates" rel="noopener ugc nofollow" target="_blank">templates</a></code>文件夹将包含所有将要构建、预渲染和发布到输出文件夹的电子邮件模板</li><li id="49a7" class="lc ld hi is b it lo ix lp jb lq jf lr jj ls jn lh li lj lk bi translated"><code class="du ll lm ln ku b"><a class="ae ko" href="https://github.com/alediaferia/blog-examples/tree/master/webpack-react-email/src/components" rel="noopener ugc nofollow" target="_blank">components</a></code>文件夹将包含您想要跨模板重用的所有可重用的ReactJS组件</li><li id="cc39" class="lc ld hi is b it lo ix lp jb lq jf lr jj ls jn lh li lj lk bi translated"><code class="du ll lm ln ku b"><a class="ae ko" href="https://github.com/alediaferia/blog-examples/tree/master/webpack-react-email/output" rel="noopener ugc nofollow" target="_blank">output</a></code>文件夹包含您选择构建的模板的HTML输出</li></ul><h2 id="ae3d" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">网络包.配置. js</h2><p id="9757" class="pw-post-body-paragraph iq ir hi is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">webpack配置文件可能是这个项目中最重要的部分。构建配置将通过注入所有需要的信息并将其预先呈现为HTML来选择合适的模板进行构建。</p><p id="a137" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们从我们的webpack.config.js的头开始。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="670d" class="jo jp hi ku b fi ky kz l la lb">const path = require('path');<br/>const webpack = require('webpack');<br/>const HtmlWebpackPlugin = require('html-webpack-plugin');<br/>const PrerenderSPAPlugin = require('prerender-spa-plugin');<br/>const HTMLInlineCSSWebpackPlugin = require('html-inline-css-webpack-plugin').default;</span></pre><p id="1f33" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如您所见，配置正在导入一些有用的插件。</p><p id="875f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">特别是，<a class="ae ko" href="https://www.npmjs.com/package/prerender-spa-plugin" rel="noopener ugc nofollow" target="_blank"> PrerenderSPAPlugin </a>，将负责预渲染整个模板并从中生成一个静态HTML。这是在幕后使用<a class="ae ko" href="https://github.com/GoogleChrome/puppeteer" rel="noopener ugc nofollow" target="_blank">木偶师</a>实现的。</p><p id="7910" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里另一个重要的点是<a class="ae ko" href="https://www.npmjs.com/package/html-inline-css-webpack-plugin" rel="noopener ugc nofollow" target="_blank">htmlinlinecssbewebpackplugin</a>，它将帮助我们将css转换成生成的HTML中的内部<code class="du ll lm ln ku b">&lt;style&gt;</code>节点。这对电子邮件特别有用。</p><h2 id="539d" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">动态条目</h2><p id="e9ef" class="pw-post-body-paragraph iq ir hi is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">我们希望能够从<code class="du ll lm ln ku b">templates</code>文件夹中所有可用的模板中编译出一个模板。为了做到这一点，我们将创建一个函数，该函数将返回要为webpack配置导出的配置散列。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="5ea5" class="jo jp hi ku b fi ky kz l la lb">const config = (env) =&gt; {<br/>  return ({<br/>    mode: 'production',<br/>    entry: {<br/>      // this will be filled in dynamically<br/>    },<br/>    output: {<br/>      filename: '[name].js',<br/>      path: path.join(__dirname, 'output'),<br/>    },<br/>    module: {<br/>      rules: [<br/>        {<br/>          test: /\.(scss|css)$/,<br/>          use: [<br/>            'css-loader',<br/>            'sass-loader',<br/>          ],<br/>        },<br/>        {<br/>          test: /\.js$/,<br/>          exclude: /node_modules/,<br/>          use: {<br/>            loader: 'babel-loader',<br/>          },<br/>        },<br/>      ],<br/>    },<br/>    plugins: [<br/>      new PrerenderSPAPlugin({<br/>        staticDir: path.join(__dirname, 'output'),<br/>        indexPath: path.join(__dirname, 'output', `${env.entry}.html`),<br/>        routes: ['/'],<br/>        postProcess: context =&gt; Object.assign(context, { outputPath: path.join(__dirname, 'output', `${env.entry}.html`) }),<br/>      }),<br/>      new HtmlWebpackPlugin({<br/>        filename: `${env.entry}.html`,<br/>        chunks: [env.entry],<br/>      }),<br/>      new HTMLInlineCSSWebpackPlugin(),<br/><br/>      // the DefinePlugin helps us defining a const<br/>      // variable that will be 'visible' by the JS code<br/>      // we are rendering at runtime<br/>      new webpack.DefinePlugin({<br/>        "EMAIL_TEMPLATE": JSON.stringify(env.entry),<br/>      }),<br/>    ],<br/>  });<br/>};</span></pre><p id="a079" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如您所见，强制的<code class="du ll lm ln ku b">entry</code>字段尚未设置。我们将稍后处理它，并且我们将要求它通过命令行传递。</p><p id="4555" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该条目将用于通过将其值传递给<a class="ae ko" href="https://www.npmjs.com/package/prerender-spa-plugin" rel="noopener ugc nofollow" target="_blank"> PrerenderSPAPlugin </a>来加载正确的模板。它还将用于告诉<a class="ae ko" href="https://webpack.js.org/plugins/html-webpack-plugin/" rel="noopener ugc nofollow" target="_blank"> HtmlWebpackPlugin </a>如何命名结果文件。</p><p id="a26e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，我们按照webpack期望的方式导出配置:</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="ca5b" class="jo jp hi ku b fi ky kz l la lb">module.exports = (env) =&gt; {<br/>  const entry = {};<br/>  entry[env.entry] = './src/index.js';<br/>  const cfg = config(env);<br/>  cfg.entry = entry;<br/>  return (cfg);<br/>};</span></pre><p id="9465" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">无论我们指定什么条目，我们总是将它与我们的入口点关联起来:<code class="du ll lm ln ku b">index.js</code>。</p><p id="1f7a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ll lm ln ku b">index.js</code>文件负责加载模板并将其嵌入到我们的电子邮件布局中。</p><p id="381e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">查看完整的<code class="du ll lm ln ku b"><a class="ae ko" href="https://github.com/alediaferia/blog-examples/blob/master/webpack-react-email/webpack.config.js" rel="noopener ugc nofollow" target="_blank">webpack.config.js</a></code>以获取更多信息。</p><h2 id="af83" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">动态模板</h2><p id="4e35" class="pw-post-body-paragraph iq ir hi is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">这是<code class="du ll lm ln ku b">index.js</code>文件的内容:</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="10cd" class="jo jp hi ku b fi ky kz l la lb">import React, { PureComponent } from 'react';<br/>import ReactDOM from 'react-dom';<br/>import { Box, Item } from 'react-html-email';<br/><br/>/*<br/> * The EmailContainer will be the body of your Email HTML body.<br/> * It will receive the right template to load and inject from Webpack<br/> * and will attempt to load it here and include it in the DOM.<br/> * <br/> * This class expects the EMAIL_TEMPLATE const to be defined.<br/> */<br/>class EmailContainer extends PureComponent {<br/>  render() {<br/>    // EMAIL_TEMPLATE is defined by the webpack configuration and enables us<br/>    // to include the right template at compile time<br/>    const Template = require(`./templates/${EMAIL_TEMPLATE}`).default;<br/>    return (<br/>      &lt;Box width="600px" height="100%" bgcolor='#f3f3f3' align='center'&gt;<br/>        &lt;Item align='center' valign='top'&gt;<br/>          &lt;Template /&gt;<br/>        &lt;/Item&gt;<br/>      &lt;/Box&gt;<br/>    );<br/>  }<br/>}<br/><br/>ReactDOM.render(&lt;EmailContainer /&gt;, document.body);</span></pre><p id="d5f1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这就是奇迹发生的地方。每个模板都将嵌入到这个代码中，这个代码将为电子邮件生成最终的HTML输出。如你所见，我从方便的<a class="ae ko" href="https://github.com/chromakode/react-html-email" rel="noopener ugc nofollow" target="_blank"> react-html-email </a>项目中导入了几个组件，该项目负责为电子邮件世界提供一些有用的组件。</p><p id="f376" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ll lm ln ku b">Template</code>对象是从<code class="du ll lm ln ku b">EMAIL_TEMPLATE</code>常量字符串中动态加载的，该字符串是在执行这段代码时定义的。我们能够做到这一点是因为我们使用了webpack <a class="ae ko" href="https://webpack.js.org/plugins/define-plugin/" rel="noopener ugc nofollow" target="_blank"> DefinePlugin </a>:</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="c2c0" class="jo jp hi ku b fi ky kz l la lb">// the DefinePlugin helps us defining a const<br/>// variable that will be 'visible' by the JS code<br/>// we are rendering at runtime<br/>new webpack.DefinePlugin({<br/>  "EMAIL_TEMPLATE": JSON.stringify(env.entry),<br/>}),</span></pre><p id="c9cf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该插件将负责将常量设置为我感兴趣的电子邮件模板的完整路径。在我们的例子中是<code class="du ll lm ln ku b">HelloWorld</code>模板。</p><h2 id="7522" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">运行它</h2><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="55e3" class="jo jp hi ku b fi ky kz l la lb">yarn webpack --env.entry=HelloWorld</span></pre><p id="3f10" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">生成的HTML将存储在<code class="du ll lm ln ku b">output</code>文件夹中。</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div class="er es lt"><img src="../Images/4fb5160a8dd243d1626d37989a822999.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*P6Nk0pgGhl01Qlvz.png"/></div><figcaption class="lu lv et er es lw lx bd b be z dx">hello world template rendered result</figcaption></figure><p id="e920" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我知道。不是最漂亮的邮件，但我会把设计留给你。:)</p><p id="8ff0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我希望你喜欢这篇文章。如果你有任何反馈，请告诉我。不要忘记在<a class="ae ko" href="https://github.com/alediaferia/blog-examples/tree/master/webpack-react-email" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上查看完整的项目。</p></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><p id="464c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="mf">原载于</em> <a class="ae ko" href="https://alediaferia.com/2018/07/29/email-development-rendering-webpack/" rel="noopener ugc nofollow" target="_blank"> <em class="mf">一个dev的主线程</em> </a> <em class="mf">。</em></p></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><figure class="kp kq kr ks fd ij er es paragraph-image"><a href="https://medium.com/swlh"><div class="er es mg"><img src="../Images/308a8d84fb9b2fab43d66c117fcc4bb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YqDjlKFwScoQYQ62DWEdig.png"/></div></a></figure><h2 id="48f8" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">这篇文章发表在《初创企业》杂志上，这是Medium最大的创业刊物，有355，974人关注。</h2><h2 id="24b8" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">订阅接收<a class="ae ko" href="http://growthsupply.com/the-startup-newsletter/" rel="noopener ugc nofollow" target="_blank">我们的头条</a>。</h2><figure class="kp kq kr ks fd ij er es paragraph-image"><a href="https://medium.com/swlh"><div class="er es mg"><img src="../Images/b0164736ea17a63403e660de5dedf91a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ouK9XR4xuNWtCes-TIUNAw.png"/></div></a></figure></div></div>    
</body>
</html>